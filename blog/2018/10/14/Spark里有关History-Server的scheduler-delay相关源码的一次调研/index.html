<!DOCTYPE html>
<html lang="zh-Hans">
<head>

    <!--[if lt IE 9]>
        <style>body {display: none; background: none !important} </style>
        <meta http-equiv="Refresh" Content="0; url=//outdatedbrowser.com/" />
    <![endif]-->

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="format-detection" content="telephone=no" />
<meta name="author" content="Hazza Cheng" />



<meta name="description" content="版权声明：本文原创，转载请留意文尾，如有侵权请留言，谢谢 引言 　　 众所周知，在Spark里，History Server可以根据event log恢复application的日志来供我们查看，在一次查看history sever里日志的过程中，发现了一个不能理解的事情，如截图下面所示，为啥duration和scheduler delay相等了啊，不科学啊，于是展开了一次溯源之旅，本文涉及到的源">
<meta property="og:type" content="article">
<meta property="og:title" content="Spark里有关History Server的scheduler delay相关源码的一次调研">
<meta property="og:url" content="http://chengfeng96.com/blog/2018/10/14/Spark%E9%87%8C%E6%9C%89%E5%85%B3History-Server%E7%9A%84scheduler-delay%E7%9B%B8%E5%85%B3%E6%BA%90%E7%A0%81%E7%9A%84%E4%B8%80%E6%AC%A1%E8%B0%83%E7%A0%94/index.html">
<meta property="og:site_name" content="零一人生">
<meta property="og:description" content="版权声明：本文原创，转载请留意文尾，如有侵权请留言，谢谢 引言 　　 众所周知，在Spark里，History Server可以根据event log恢复application的日志来供我们查看，在一次查看history sever里日志的过程中，发现了一个不能理解的事情，如截图下面所示，为啥duration和scheduler delay相等了啊，不科学啊，于是展开了一次溯源之旅，本文涉及到的源">
<meta property="og:locale">
<meta property="og:image" content="http://chengfeng96.com/blog/2018/10/14/Spark%E9%87%8C%E6%9C%89%E5%85%B3History-Server%E7%9A%84scheduler-delay%E7%9B%B8%E5%85%B3%E6%BA%90%E7%A0%81%E7%9A%84%E4%B8%80%E6%AC%A1%E8%B0%83%E7%A0%94/1.png">
<meta property="og:image" content="http://chengfeng96.com/blog/2018/10/14/Spark%E9%87%8C%E6%9C%89%E5%85%B3History-Server%E7%9A%84scheduler-delay%E7%9B%B8%E5%85%B3%E6%BA%90%E7%A0%81%E7%9A%84%E4%B8%80%E6%AC%A1%E8%B0%83%E7%A0%94/2.png">
<meta property="og:image" content="http://chengfeng96.com/blog/2018/10/14/Spark%E9%87%8C%E6%9C%89%E5%85%B3History-Server%E7%9A%84scheduler-delay%E7%9B%B8%E5%85%B3%E6%BA%90%E7%A0%81%E7%9A%84%E4%B8%80%E6%AC%A1%E8%B0%83%E7%A0%94/3.png">
<meta property="og:image" content="http://chengfeng96.com/blog/2018/10/14/Spark%E9%87%8C%E6%9C%89%E5%85%B3History-Server%E7%9A%84scheduler-delay%E7%9B%B8%E5%85%B3%E6%BA%90%E7%A0%81%E7%9A%84%E4%B8%80%E6%AC%A1%E8%B0%83%E7%A0%94/4.png">
<meta property="og:image" content="http://chengfeng96.com/blog/2018/10/14/Spark%E9%87%8C%E6%9C%89%E5%85%B3History-Server%E7%9A%84scheduler-delay%E7%9B%B8%E5%85%B3%E6%BA%90%E7%A0%81%E7%9A%84%E4%B8%80%E6%AC%A1%E8%B0%83%E7%A0%94/5.png">
<meta property="og:image" content="http://chengfeng96.com/blog/2018/10/14/Spark%E9%87%8C%E6%9C%89%E5%85%B3History-Server%E7%9A%84scheduler-delay%E7%9B%B8%E5%85%B3%E6%BA%90%E7%A0%81%E7%9A%84%E4%B8%80%E6%AC%A1%E8%B0%83%E7%A0%94/6.png">
<meta property="article:published_time" content="2018-10-14T03:53:38.000Z">
<meta property="article:modified_time" content="2021-03-03T13:31:06.000Z">
<meta property="article:author" content="Hazza Cheng">
<meta property="article:tag" content="Spark">
<meta property="article:tag" content="history server">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://chengfeng96.com/blog/2018/10/14/Spark%E9%87%8C%E6%9C%89%E5%85%B3History-Server%E7%9A%84scheduler-delay%E7%9B%B8%E5%85%B3%E6%BA%90%E7%A0%81%E7%9A%84%E4%B8%80%E6%AC%A1%E8%B0%83%E7%A0%94/1.png">

<link rel="apple-touch-icon" href= "/apple-touch-icon.png">


    <link rel="alternate" href="/atom.xml" title="零一人生" type="application/atom+xml">



    <link rel="shortcut icon" href="/favicon.ico">



    <link href="//cdn.bootcss.com/animate.css/3.5.1/animate.min.css" rel="stylesheet">



    <link href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" rel="stylesheet">



    <script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
    <link href="//cdn.bootcss.com/pace/1.0.2/themes/blue/pace-theme-minimal.css" rel="stylesheet">



<link rel="stylesheet" href="/css/style.css">




<link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">


<title>Spark里有关History Server的scheduler delay相关源码的一次调研 | 零一人生</title>

<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
<script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>

<script>
    var yiliaConfig = {
        fancybox: true,
        animate: true,
        isHome: false,
        isPost: true,
        isArchive: false,
        isTag: false,
        isCategory: false,
        fancybox_js: "//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js",
        scrollreveal: "//cdn.bootcss.com/scrollReveal.js/3.1.4/scrollreveal.min.js",
        search: true
    }
</script>


    <script> yiliaConfig.jquery_ui = [false]; </script>



    <script> yiliaConfig.rootUrl = "\/";</script>






<meta name="generator" content="Hexo 6.3.0"></head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <a href="/" class="profilepic">
            <img src="/img/avatar.png" class="animated zoomIn">
        </a>
        <hgroup>
          <h1 class="header-author"><a href="/"></a></h1>
        </hgroup>

        

        
            <form id="search-form">
            <input type="text" id="local-search-input" name="q" placeholder="search..." class="search form-control" autocomplete="off" autocorrect="off" searchonload="false" />
            <i class="fa fa-times" onclick="resetSearch()"></i>
            </form>
            <div id="local-search-result"></div>
            <p class='no-result'>No results found <i class='fa fa-spinner fa-pulse'></i></p>
        


        
            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-ctn">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>
                        
                        <div class="icon-wrap icon-link hide" data-idx="2">
                            <div class="loopback_l"></div>
                            <div class="loopback_r"></div>
                        </div>
                        
                        
                        <div class="icon-wrap icon-me hide" data-idx="3">
                            <div class="user"></div>
                            <div class="shoulder"></div>
                        </div>
                        
                    </div>
                    
                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>菜单</li>
                        <li>标签</li>
                        
                        <li>友情链接</li>
                        
                        
                        <li>关于我</li>
                        
                    </ul>
                </div>
            </div>
        

        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a href="/">主页</a></li>
                        
                            <li><a href="/about/">关于我</a></li>
                        
                            <li><a href="/archives/">所有文章</a></li>
                        
                            <li><a href="/tags/">标签云</a></li>
                        
                            <li><a href="/categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0">读书笔记</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" href="mailto:hazzacheng@gmail.com" title="Email"></a>
                            
                                <a class="fa RSS" href="/atom.xml" title="RSS"></a>
                            
                                <a class="fa Github" target="_blank" rel="noopener" href="https://github.com/HazzaCheng" title="Github"></a>
                            
                                <a class="fa 知乎" target="_blank" rel="noopener" href="https://www.zhihu.com/people/hazzacheng" title="知乎"></a>
                            
                                <a class="fa 豆瓣" target="_blank" rel="noopener" href="https://www.douban.com/people/HazzaCheng/" title="豆瓣"></a>
                            
                        </ul>
                    </nav>
                </section>
                
                
                <section class="switch-part switch-part2">
                    <div class="widget tagcloud" id="js-tagcloud">
                        <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/A/" rel="tag">A*</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/AGNES/" rel="tag">AGNES</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/AQS/" rel="tag">AQS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/AUC/" rel="tag">AUC</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Abstract-Factory-Pattern/" rel="tag">Abstract Factory Pattern</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Accumulating-Trace/" rel="tag">Accumulating Trace</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Accuracy/" rel="tag">Accuracy</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Acquisition-function/" rel="tag">Acquisition function</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Action-Preference-Function/" rel="tag">Action Preference Function</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Active-Learning/" rel="tag">Active Learning</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Actor%E2%80%93Critic/" rel="tag">Actor–Critic</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/AdaBoost/" rel="tag">AdaBoost</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Adjoint/" rel="tag">Adjoint</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Advantage-Function/" rel="tag">Advantage Function</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Amdahl/" rel="tag">Amdahl</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Append-only-Tree/" rel="tag">Append-only Tree</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ArrayDeque/" rel="tag">ArrayDeque</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Atomic/" rel="tag">Atomic</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/AutoML/" rel="tag">AutoML</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/B-Tree/" rel="tag">B+ Tree</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/B-Tree/" rel="tag">B-Tree</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/BFS/" rel="tag">BFS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/BFT/" rel="tag">BFT</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/BGD/" rel="tag">BGD</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/BO/" rel="tag">BO</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/BOHB/" rel="tag">BOHB</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/BP/" rel="tag">BP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/BST/" rel="tag">BST</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Bagging/" rel="tag">Bagging</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Bandit-learning/" rel="tag">Bandit learning</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Barrier/" rel="tag">Barrier</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Baum-Welch/" rel="tag">Baum-Welch</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Bayes-Classifiers/" rel="tag">Bayes Classifiers</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Bayes-Rule/" rel="tag">Bayes Rule</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Bayesian-Estimation/" rel="tag">Bayesian Estimation</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Bayesian-Linear-Regression/" rel="tag">Bayesian Linear Regression</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Bayesian-Network/" rel="tag">Bayesian Network</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Bayesian-Statistical-Inference/" rel="tag">Bayesian Statistical Inference</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Bellman-Expectation-Equation/" rel="tag">Bellman Expectation Equation</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Bellman-Optimal-Equation/" rel="tag">Bellman Optimal Equation</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Bellman-Ford/" rel="tag">Bellman-Ford</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Bernoulli-Distribution/" rel="tag">Bernoulli Distribution</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Bernoulli-Process/" rel="tag">Bernoulli Process</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Bias-Variance-Decomposition/" rel="tag">Bias-Variance Decomposition</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Bias-Variance-Dilemma/" rel="tag">Bias-Variance Dilemma</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Big-Data/" rel="tag">Big Data</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/BigTable/" rel="tag">BigTable</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Binomial-Distribution/" rel="tag">Binomial Distribution</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/BlockingQueue/" rel="tag">BlockingQueue</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Boosting/" rel="tag">Boosting</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Boosting-Tree/" rel="tag">Boosting Tree</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/C/" rel="tag">C++</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/C-K-Equation/" rel="tag">C-K Equation</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/C4-5/" rel="tag">C4.5</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CAP/" rel="tag">CAP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CART/" rel="tag">CART</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CAS/" rel="tag">CAS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CASH/" rel="tag">CASH</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CDF/" rel="tag">CDF</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Calculus/" rel="tag">Calculus</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Callable/" rel="tag">Callable</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Central-Limit-Theorem/" rel="tag">Central Limit Theorem</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Chebyshev-s-Inequality/" rel="tag">Chebyshev&#39;s Inequality</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Chi-Squared-Test/" rel="tag">Chi-Squared Test</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Chi-squared-distribution/" rel="tag">Chi-squared distribution</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Chubby/" rel="tag">Chubby</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ClassTag/" rel="tag">ClassTag</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Classical-Statistical-Inference/" rel="tag">Classical Statistical Inference</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Clustering/" rel="tag">Clustering</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Co-training/" rel="tag">Co-training</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CompletionService/" rel="tag">CompletionService</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ConcurrentHashMap/" rel="tag">ConcurrentHashMap</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ConcurrentLinkedQueue/" rel="tag">ConcurrentLinkedQueue</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ConcurrentModificationException/" rel="tag">ConcurrentModificationException</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Condition-Queue/" rel="tag">Condition Queue</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Constrained-Seed-k-means/" rel="tag">Constrained Seed k-means</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Constrained-k-means/" rel="tag">Constrained k-means</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Context-Switching/" rel="tag">Context Switching</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CopyOnWriteArrayList/" rel="tag">CopyOnWriteArrayList</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CountDownLatch/" rel="tag">CountDownLatch</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Counting/" rel="tag">Counting</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DARTS/" rel="tag">DARTS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DARTS-PT/" rel="tag">DARTS+PT</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DBSCAN/" rel="tag">DBSCAN</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DCL/" rel="tag">DCL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DDPG/" rel="tag">DDPG</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DFS/" rel="tag">DFS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DL/" rel="tag">DL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DP/" rel="tag">DP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DPG/" rel="tag">DPG</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DPoS/" rel="tag">DPoS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DQN/" rel="tag">DQN</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Daemon-Thread/" rel="tag">Daemon Thread</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Deadlock/" rel="tag">Deadlock</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Decision-Tree/" rel="tag">Decision Tree</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Density-based-Clustering/" rel="tag">Density-based Clustering</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Deque/" rel="tag">Deque</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Derivative/" rel="tag">Derivative</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Dictionary-Learning/" rel="tag">Dictionary Learning</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Dijkstra/" rel="tag">Dijkstra</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Dimension-Reduction/" rel="tag">Dimension Reduction</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Directional-Derivative/" rel="tag">Directional Derivative</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Discrete-Uniform-Distribution/" rel="tag">Discrete Uniform Distribution</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Diversity-Enhance/" rel="tag">Diversity Enhance</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Diversity-Measure/" rel="tag">Diversity Measure</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Dockerfile/" rel="tag">Dockerfile</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Double-DQN/" rel="tag">Double DQN</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Double-Q-learning/" rel="tag">Double Q-learning</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Dueling-DQN/" rel="tag">Dueling DQN</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Dutch-Trace/" rel="tag">Dutch Trace</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/EI/" rel="tag">EI</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ENAS/" rel="tag">ENAS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ERM/" rel="tag">ERM</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Edmonds-Karp/" rel="tag">Edmonds-Karp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Eligibility-Trace/" rel="tag">Eligibility Trace</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Ensemble-Learning/" rel="tag">Ensemble Learning</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Ensemble-Selection/" rel="tag">Ensemble Selection</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/EnumMap/" rel="tag">EnumMap</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/EnumSet/" rel="tag">EnumSet</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Erlang-Distribution/" rel="tag">Erlang Distribution</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Error-Rate/" rel="tag">Error Rate</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Escape-Analysis/" rel="tag">Escape Analysis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Evolutionary-Algorithm/" rel="tag">Evolutionary Algorithm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Exclusive-Locks/" rel="tag">Exclusive Locks</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Executor/" rel="tag">Executor</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ExecutorService/" rel="tag">ExecutorService</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Expectation/" rel="tag">Expectation</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Exploration-Exploitation-dilemma/" rel="tag">Exploration-Exploitation dilemma</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Exponential-Distribution/" rel="tag">Exponential Distribution</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/F1-Measure/" rel="tag">F1 Measure</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/FLP/" rel="tag">FLP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Factory-Method-Pattern/" rel="tag">Factory Method Pattern</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Fair-DARTS/" rel="tag">Fair DARTS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Fair-Lock/" rel="tag">Fair Lock</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/FairNAS/" rel="tag">FairNAS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Feature-Selection/" rel="tag">Feature Selection</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/FetchFailedException/" rel="tag">FetchFailedException</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Floyd-Warshall/" rel="tag">Floyd-Warshall</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Ford-Fulkerson/" rel="tag">Ford-Fulkerson</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Future/" rel="tag">Future</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/FutureTask/" rel="tag">FutureTask</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GBDT/" rel="tag">GBDT</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GC/" rel="tag">GC</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GDBT-NAS/" rel="tag">GDBT-NAS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GFS/" rel="tag">GFS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GP/" rel="tag">GP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Geometric-Distribution/" rel="tag">Geometric Distribution</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Gibbs-Sampling/" rel="tag">Gibbs Sampling</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Gini-Index/" rel="tag">Gini Index</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Gradient/" rel="tag">Gradient</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Gradient-Descent/" rel="tag">Gradient Descent</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GreedyNAS/" rel="tag">GreedyNAS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HA/" rel="tag">HA</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HDFS/" rel="tag">HDFS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HMM/" rel="tag">HMM</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HPO/" rel="tag">HPO</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hadoop/" rel="tag">Hadoop</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Happens-Before/" rel="tag">Happens-Before</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hash-Based-Shuffle/" rel="tag">Hash-Based Shuffle</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hedged-Read/" rel="tag">Hedged Read</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hermitan-Matrix/" rel="tag">Hermitan Matrix</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hierarchical-Clustering/" rel="tag">Hierarchical Clustering</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hinge-Regression/" rel="tag">Hinge Regression</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hoeffding-s-Inequality/" rel="tag">Hoeffding&#39;s Inequality</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hot-Fields/" rel="tag">Hot Fields</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HuffmanCode/" rel="tag">HuffmanCode</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HyperNet/" rel="tag">HyperNet</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hyperband/" rel="tag">Hyperband</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hyperopt/" rel="tag">Hyperopt</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hypothesis-Test/" rel="tag">Hypothesis Test</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ID3/" rel="tag">ID3</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Imitation-Learning/" rel="tag">Imitation Learning</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Importance-Sampling/" rel="tag">Importance Sampling</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Independence/" rel="tag">Independence</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Information-Entropy/" rel="tag">Information Entropy</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Information-Gain/" rel="tag">Information Gain</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Information-Gain-Ratio/" rel="tag">Information Gain Ratio</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Interruptible-Lock/" rel="tag">Interruptible Lock</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Isometry/" rel="tag">Isometry</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JVM/" rel="tag">JVM</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/" rel="tag">Java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Jensen-s-Inequality/" rel="tag">Jensen&#39;s  Inequality</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Johnson/" rel="tag">Johnson</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/K-armed-bandit/" rel="tag">K-armed bandit</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/K-means/" rel="tag">K-means</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/KLDA/" rel="tag">KLDA</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/KMP/" rel="tag">KMP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/KPCA/" rel="tag">KPCA</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/KTT/" rel="tag">KTT</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Kernel-Function/" rel="tag">Kernel Function</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Kruskal/" rel="tag">Kruskal</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/LASSO/" rel="tag">LASSO</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/LATE/" rel="tag">LATE</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/LCS/" rel="tag">LCS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/LDA/" rel="tag">LDA</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/LLMS/" rel="tag">LLMS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/LMS/" rel="tag">LMS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/LSM/" rel="tag">LSM</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/LSTD/" rel="tag">LSTD</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/LSTM/" rel="tag">LSTM</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/LVQ/" rel="tag">LVQ</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/LVW/" rel="tag">LVW</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Lagrange-Multiplier/" rel="tag">Lagrange Multiplier</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Laplacian-Correction/" rel="tag">Laplacian Correction</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Lasso-Regression/" rel="tag">Lasso Regression</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Latch/" rel="tag">Latch</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Law-of-Large-Numbers/" rel="tag">Law of Large Numbers</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Least-Squares/" rel="tag">Least Squares</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/LightGBM/" rel="tag">LightGBM</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Likelihood-Ratio/" rel="tag">Likelihood Ratio</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linear-Algebra/" rel="tag">Linear Algebra</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linear-Regression/" rel="tag">Linear Regression</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/LinkedList/" rel="tag">LinkedList</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Livelock/" rel="tag">Livelock</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Lock-Coarsening/" rel="tag">Lock Coarsening</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Lock-Contention/" rel="tag">Lock Contention</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Lock-Granularity/" rel="tag">Lock Granularity</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Lock-Scope/" rel="tag">Lock Scope</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Lock-Striping/" rel="tag">Lock Striping</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Logistic-Regression/" rel="tag">Logistic Regression</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MAP/" rel="tag">MAP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MDP/" rel="tag">MDP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MDS/" rel="tag">MDS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ML/" rel="tag">ML</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MLE/" rel="tag">MLE</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MRv1/" rel="tag">MRv1</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MSE/" rel="tag">MSE</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MST/" rel="tag">MST</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Macro-Average/" rel="tag">Macro Average</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MapReduce/" rel="tag">MapReduce</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mark-Word/" rel="tag">Mark Word</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Markov-Chain/" rel="tag">Markov Chain</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Markov-chain/" rel="tag">Markov chain</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Markov-s-Inequality/" rel="tag">Markov&#39;s Inequality</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Math/" rel="tag">Math</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Matrix-Completion/" rel="tag">Matrix Completion</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mean/" rel="tag">Mean</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MemTable/" rel="tag">MemTable</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Memory-Synchronization/" rel="tag">Memory Synchronization</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Memory-Bank/" rel="tag">Memory-Bank</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Micro-Average/" rel="tag">Micro Average</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mixture-of-Gaussian/" rel="tag">Mixture-of-Gaussian</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Monte-Carlo-Learning/" rel="tag">Monte Carlo Learning</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Monte-Carlo-Methods/" rel="tag">Monte Carlo Methods</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Morris-Traversal/" rel="tag">Morris Traversal</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Multivariate-Decision-Tree/" rel="tag">Multivariate Decision Tree</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mysql/" rel="tag">Mysql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NAO/" rel="tag">NAO</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NAS/" rel="tag">NAS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NASNet/" rel="tag">NASNet</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NASP/" rel="tag">NASP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NSGA-II/" rel="tag">NSGA-II</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Naive-Bayes-Classifiers/" rel="tag">Naive Bayes Classifiers</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NoisyDARTS/" rel="tag">NoisyDARTS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Normal/" rel="tag">Normal</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Normal-Distribution/" rel="tag">Normal Distribution</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ODE/" rel="tag">ODE</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Observer-Pattern/" rel="tag">Observer Pattern</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/One-Shot/" rel="tag">One-Shot</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Open-Call/" rel="tag">Open Call</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Optimistic-Lock/" rel="tag">Optimistic Lock</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/P-DARTS/" rel="tag">P-DARTS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PAC/" rel="tag">PAC</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PBFT/" rel="tag">PBFT</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PC-DARTS/" rel="tag">PC-DARTS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PCA/" rel="tag">PCA</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PDF/" rel="tag">PDF</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PGD/" rel="tag">PGD</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PI/" rel="tag">PI</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PMF/" rel="tag">PMF</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PR/" rel="tag">PR</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Partial-Derivative/" rel="tag">Partial Derivative</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Pascal-Distribution/" rel="tag">Pascal Distribution</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Paxos/" rel="tag">Paxos</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Pessimistic-Lock/" rel="tag">Pessimistic Lock</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Piggyback/" rel="tag">Piggyback</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PoS/" rel="tag">PoS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PoW/" rel="tag">PoW</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Poison-Pill/" rel="tag">Poison Pill</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Poisson-Distribution/" rel="tag">Poisson Distribution</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Policy-Gradient/" rel="tag">Policy Gradient</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Polled-Lock/" rel="tag">Polled Lock</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Possion-Process/" rel="tag">Possion Process</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Precision/" rel="tag">Precision</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Prim/" rel="tag">Prim</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Probability/" rel="tag">Probability</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Protoytpe-based-Clustering/" rel="tag">Protoytpe-based Clustering</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ProxylessNAS/" rel="tag">ProxylessNAS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Publish-Subscribe-Pattern/" rel="tag">Publish-Subscribe Pattern</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Q-learning/" rel="tag">Q-learning</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/REINFORCE/" rel="tag">REINFORCE</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RIP/" rel="tag">RIP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RL/" rel="tag">RL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RMQ/" rel="tag">RMQ</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RNN/" rel="tag">RNN</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ROAR/" rel="tag">ROAR</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ROC/" rel="tag">ROC</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Raft/" rel="tag">Raft</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Random-Forest/" rel="tag">Random Forest</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Rayleigh-quotient/" rel="tag">Rayleigh quotient</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Read-Write-Lock/" rel="tag">Read-Write Lock</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Recall/" rel="tag">Recall</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ReenTrantLock/" rel="tag">ReenTrantLock</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Reentrant-Lock/" rel="tag">Reentrant Lock</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ReentrantReadWriteLock/" rel="tag">ReentrantReadWriteLock</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Reinforcement-Learning/" rel="tag">Reinforcement Learning</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Relief/" rel="tag">Relief</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Relief-F/" rel="tag">Relief-F</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Reordering/" rel="tag">Reordering</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Replacing-Trace/" rel="tag">Replacing Trace</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Robbins-Monro/" rel="tag">Robbins-Monro</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/S3VM/" rel="tag">S3VM</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SAMR/" rel="tag">SAMR</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SARSA/" rel="tag">SARSA</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SGD/" rel="tag">SGD</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SHAP/" rel="tag">SHAP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SMAC/" rel="tag">SMAC</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SMASH/" rel="tag">SMASH</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SMBO/" rel="tag">SMBO</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SMO/" rel="tag">SMO</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SNAS/" rel="tag">SNAS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SPFA/" rel="tag">SPFA</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SPOS/" rel="tag">SPOS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SRM/" rel="tag">SRM</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SSTable/" rel="tag">SSTable</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SVD/" rel="tag">SVD</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SVM/" rel="tag">SVM</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SVR/" rel="tag">SVR</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Sarsa/" rel="tag">Sarsa</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Saturation-Policies/" rel="tag">Saturation Policies</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Self-Adjont/" rel="tag">Self-Adjont</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Semaphore/" rel="tag">Semaphore</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Semi-Gradient-Descent/" rel="tag">Semi-Gradient Descent</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Semi-naive-Bayes-Classifiers/" rel="tag">Semi-naive Bayes Classifiers</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Semi-supervised-Learning/" rel="tag">Semi-supervised Learning</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SemiNAS/" rel="tag">SemiNAS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Sequential-Consistency/" rel="tag">Sequential Consistency</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Shuffle/" rel="tag">Shuffle</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Shutdown-Hock/" rel="tag">Shutdown Hock</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Significance-Test/" rel="tag">Significance Test</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Simple-Factory-Pattern/" rel="tag">Simple Factory Pattern</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Single-Path/" rel="tag">Single Path</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SinglePath/" rel="tag">SinglePath</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SnowFlake/" rel="tag">SnowFlake</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Softmax/" rel="tag">Softmax</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Sort-Based-Shuffle/" rel="tag">Sort-Based Shuffle</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Spark/" rel="tag">Spark</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Spark-SQL/" rel="tag">Spark SQL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Sparse-Coding/" rel="tag">Sparse Coding</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Sparse-Representation/" rel="tag">Sparse Representation</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Sparse-Table/" rel="tag">Sparse Table</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Spectral-Theorem/" rel="tag">Spectral Theorem</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Speculative-Task/" rel="tag">Speculative Task</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Stack/" rel="tag">Stack</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Starvation/" rel="tag">Starvation</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Statistics/" rel="tag">Statistics</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Stochastic-Process/" rel="tag">Stochastic Process</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Strategy-Pattern/" rel="tag">Strategy Pattern</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Strong-Law-of-Large-Numbers/" rel="tag">Strong Law of Large Numbers</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Student-s-t-distribution/" rel="tag">Student&#39;s t-distribution</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SuccessiveHalving/" rel="tag">SuccessiveHalving</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Supervised-Learning/" rel="tag">Supervised Learning</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Synchronizer/" rel="tag">Synchronizer</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TD3/" rel="tag">TD3</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TPE/" rel="tag">TPE</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TSVM/" rel="tag">TSVM</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Temporal-Difference-Learning/" rel="tag">Temporal Difference Learning</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Temporal-Difference-Learning/" rel="tag">Temporal-Difference Learning</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ThreadLocal/" rel="tag">ThreadLocal</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ThreadPoolExecutor/" rel="tag">ThreadPoolExecutor</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Timed-Lock/" rel="tag">Timed Lock</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Total-Derivative/" rel="tag">Total Derivative</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Total-Probability-Theorem/" rel="tag">Total Probability Theorem</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Tungsten-Sort-Shuffle/" rel="tag">Tungsten-Sort Shuffle</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/UCB/" rel="tag">UCB</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Uniform-Distribution/" rel="tag">Uniform Distribution</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Unitary-Matrix/" rel="tag">Unitary Matrix</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Univariate-Decision-Tree/" rel="tag">Univariate Decision Tree</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Unsupervised-Learning/" rel="tag">Unsupervised Learning</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Variance/" rel="tag">Variance</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/VisualVM/" rel="tag">VisualVM</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Viterbi/" rel="tag">Viterbi</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Weak-Law-of-Large-Numbers/" rel="tag">Weak Law of Large Numbers</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Weight-Sharing/" rel="tag">Weight Sharing</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Weights-Sharing/" rel="tag">Weights Sharing</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Work-Stealing/" rel="tag">Work Stealing</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/XGBoost/" rel="tag">XGBoost</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/YARN/" rel="tag">YARN</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/abstract-class/" rel="tag">abstract class</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/adjacency-matrix/" rel="tag">adjacency matrix</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/algorithms/" rel="tag">algorithms</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/augmenting-path/" rel="tag">augmenting path</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/big-data/" rel="tag">big data</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/big-integer/" rel="tag">big integer</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/bilevel-optimization/" rel="tag">bilevel optimization</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/bit-manipulation/" rel="tag">bit manipulation</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/blockchain/" rel="tag">blockchain</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/builder/" rel="tag">builder</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/char/" rel="tag">char*</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cloud-cmputing/" rel="tag">cloud cmputing</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cloud-computing/" rel="tag">cloud computing</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/column-key/" rel="tag">column key</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/constructor/" rel="tag">constructor</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/context-bounds/" rel="tag">context bounds</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/contravariance/" rel="tag">contravariance</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/covariance/" rel="tag">covariance</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/data-structure/" rel="tag">data structure</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/decoder/" rel="tag">decoder</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/deserializing/" rel="tag">deserializing</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/direct-memory/" rel="tag">direct memory</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/divide-and-conquer/" rel="tag">divide and conquer</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/" rel="tag">docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/encoder/" rel="tag">encoder</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/epectation-Maximization-Algorithm/" rel="tag">epectation-Maximization Algorithm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/epsilon-Greedy/" rel="tag">epsilon-Greedy</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/equals/" rel="tag">equals</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/every-visit-Monte-Carlo-update/" rel="tag">every visit Monte Carlo update</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/existential-type/" rel="tag">existential type</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/experience-repaly/" rel="tag">experience repaly</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/exploring-start/" rel="tag">exploring start</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/fast-matrix-exponentiation/" rel="tag">fast matrix exponentiation</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/first-visit-Monte-Carlo-update/" rel="tag">first visit Monte Carlo update</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/function-approximation/" rel="tag">function approximation</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/functional-programming/" rel="tag">functional programming</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/generalized-suffix-tree/" rel="tag">generalized suffix tree</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/go/" rel="tag">go</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/graph/" rel="tag">graph</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/graph-database/" rel="tag">graph database</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/greedy/" rel="tag">greedy</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/handle/" rel="tag">handle</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/heuristic-approaches/" rel="tag">heuristic approaches</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/higher-kinded-types/" rel="tag">higher kinded types</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/history-server/" rel="tag">history server</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/history-sever/" rel="tag">history sever</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/id/" rel="tag">id</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/images/" rel="tag">images</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/immutable/" rel="tag">immutable</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/implicit/" rel="tag">implicit</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/inorder/" rel="tag">inorder</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/interrupt/" rel="tag">interrupt</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/invariance/" rel="tag">invariance</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/invokeAll/" rel="tag">invokeAll</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java/" rel="tag">java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java-bean/" rel="tag">java bean</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jinfo/" rel="tag">jinfo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jmao/" rel="tag">jmao</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jps/" rel="tag">jps</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jstack/" rel="tag">jstack</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jstat/" rel="tag">jstat</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/leveldb/" rel="tag">leveldb</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/" rel="tag">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/log4j/" rel="tag">log4j</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/manifest/" rel="tag">manifest</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/maximum-bipartite-matching/" rel="tag">maximum bipartite matching</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/maxium-flow/" rel="tag">maxium flow</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mutiply-inheritance/" rel="tag">mutiply inheritance</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/newTaskFor/" rel="tag">newTaskFor</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/object-pool/" rel="tag">object pool</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/object-serialization/" rel="tag">object serialization</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/off-policy/" rel="tag">off-policy</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/on-policy/" rel="tag">on-policy</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/override/" rel="tag">override</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/path-dependent-type/" rel="tag">path-dependent type</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/policy-evaluation/" rel="tag">policy evaluation</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/policy-gradient/" rel="tag">policy gradient</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/policy-improvement/" rel="tag">policy improvement</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/policy-iteration/" rel="tag">policy iteration</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/postorder/" rel="tag">postorder</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/preorder/" rel="tag">preorder</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/" rel="tag">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/reachability-analysis/" rel="tag">reachability analysis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/readObject/" rel="tag">readObject</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/readResolve/" rel="tag">readResolve</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/reference-chain/" rel="tag">reference chain</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/reference-counting/" rel="tag">reference counting</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/reflect/" rel="tag">reflect</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rm/" rel="tag">rm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/row-key/" rel="tag">row key</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/scala/" rel="tag">scala</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/segment-tree/" rel="tag">segment tree</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/semaphore/" rel="tag">semaphore</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sequence-to-sequence/" rel="tag">sequence-to-sequence</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/serialization-proxy-pattern/" rel="tag">serialization proxy pattern</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/serializing/" rel="tag">serializing</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/singleton/" rel="tag">singleton</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/skiplist/" rel="tag">skiplist</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/soft-policy/" rel="tag">soft policy</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sort/" rel="tag">sort</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/specialized-method/" rel="tag">specialized method</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/static-factory-method/" rel="tag">static factory method</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/string/" rel="tag">string</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/structural-type/" rel="tag">structural type</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sudo/" rel="tag">sudo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tail-recursion/" rel="tag">tail recursion</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/target-network/" rel="tag">target network</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tee/" rel="tag">tee</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/telescoping-Constructor/" rel="tag">telescoping Constructor</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/trait/" rel="tag">trait</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tree/" rel="tag">tree</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/type/" rel="tag">type</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/type-projection/" rel="tag">type projection</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/unconfigurableExecutorService/" rel="tag">unconfigurableExecutorService</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/value-iteration/" rel="tag">value iteration</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/variable-length-code/" rel="tag">variable-length code</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/variance/" rel="tag">variance</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/view-bounds/" rel="tag">view bounds</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vim/" rel="tag">vim</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/writeObject/" rel="tag">writeObject</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/writeReplace/" rel="tag">writeReplace</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/yum/" rel="tag">yum</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%B8%8D%E5%BF%85%E8%A6%81%E5%AF%B9%E8%B1%A1/" rel="tag">不必要对象</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BC%AA%E5%AD%97%E8%8A%82%E6%B5%81%E6%94%BB%E5%87%BB/" rel="tag">伪字节流攻击</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%86%85%E9%83%A8%E5%9F%9F%E7%9B%97%E7%94%A8%E6%94%BB%E5%87%BB/" rel="tag">内部域盗用攻击</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8F%AF%E4%BC%B8%E7%BC%A9/" rel="tag">可伸缩</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AE%89%E5%85%A8%E5%8F%91%E5%B8%83/" rel="tag">安全发布</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B9%B6%E5%8F%91/" rel="tag">并发</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%9E%9A%E4%B8%BE/" rel="tag">枚举</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%A0%88%E5%B0%81%E9%97%AD/" rel="tag">栈封闭</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%AD%96%E7%95%A5%E6%9E%9A%E4%B8%BE/" rel="tag">策略枚举</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%B4%A2%E5%BC%95/" rel="tag">索引</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%99%9A%E6%8B%9F%E5%8C%96/" rel="tag">虚拟化</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%BF%87%E6%9C%9F%E5%AF%B9%E8%B1%A1/" rel="tag">过期对象</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%80%B8%E5%87%BA/" rel="tag">逸出</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%87%8D%E5%85%A5/" rel="tag">重入</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%87%8D%E6%8E%92%E5%BA%8F/" rel="tag">重排序</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9A%90%E5%BC%8F%E4%BD%9C%E7%94%A8%E5%9F%9F/" rel="tag">隐式作用域</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9A%90%E5%BC%8F%E5%8F%82%E6%95%B0/" rel="tag">隐式参数</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9A%90%E5%BC%8F%E8%A7%86%E5%9B%BE/" rel="tag">隐式视图</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9A%90%E5%BC%8F%E8%BD%AC%E6%8D%A2/" rel="tag">隐式转换</a></li></ul>
                    </div>
                </section>
                
                
                
                <section class="switch-part switch-part3">
                    <div id="js-friends">
                    
                      <a class="main-nav-link switch-friends-link" target="_blank" rel="noopener" href="https://github.com/">GitHub</a>
                    
                      <a class="main-nav-link switch-friends-link" target="_blank" rel="noopener" href="https://www.google.com/">Google</a>
                    
                      <a class="main-nav-link switch-friends-link" target="_blank" rel="noopener" href="https://stackoverflow.com/">StackOverflow</a>
                    
                      <a class="main-nav-link switch-friends-link" target="_blank" rel="noopener" href="https://leetcode.com/problemset/algorithms/">LeetCode</a>
                    
                      <a class="main-nav-link switch-friends-link" target="_blank" rel="noopener" href="https://www.youtube.com/">YouTube</a>
                    
                    </div>
                </section>
                

                
                
                <section class="switch-part switch-part4">
                
                    <div id="js-aboutme">什么都想学，什么都学不会。</div>
                </section>
                
            </div>
        </div>
    </header>                
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="回到主页"></a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                <img src="/img/avatar.png" class="animated zoomIn">
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="回到主页"></a></h1>
            </hgroup>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="/">主页</a></li>
                
                    <li><a href="/about/">关于我</a></li>
                
                    <li><a href="/archives/">所有文章</a></li>
                
                    <li><a href="/tags/">标签云</a></li>
                
                    <li><a href="/categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0">读书笔记</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" target="_blank" href="mailto:hazzacheng@gmail.com" title="Email"></a>
                            
                                <a class="fa RSS" target="_blank" href="/atom.xml" title="RSS"></a>
                            
                                <a class="fa Github" target="_blank" href="https://github.com/HazzaCheng" title="Github"></a>
                            
                                <a class="fa 知乎" target="_blank" href="https://www.zhihu.com/people/hazzacheng" title="知乎"></a>
                            
                                <a class="fa 豆瓣" target="_blank" href="https://www.douban.com/people/HazzaCheng/" title="豆瓣"></a>
                            
                        </ul>
            </nav>
        </header>                
    </div>
    <link class="menu-list" tags="标签" friends="友情链接" about="关于我"/>
</nav>
      <div class="body-wrap"><article id="post-Spark里有关History-Server的scheduler-delay相关源码的一次调研" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/blog/2018/10/14/Spark%E9%87%8C%E6%9C%89%E5%85%B3History-Server%E7%9A%84scheduler-delay%E7%9B%B8%E5%85%B3%E6%BA%90%E7%A0%81%E7%9A%84%E4%B8%80%E6%AC%A1%E8%B0%83%E7%A0%94/" class="article-date">
      <time datetime="2018-10-14T03:53:38.000Z" itemprop="datePublished">2018-10-14</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Spark里有关History Server的scheduler delay相关源码的一次调研
    </h1>
  

        <div style="margin-top:10px;">
    <span class="post-time">
      <span class="post-meta-item-icon">
        <i class="fa fa-keyboard-o"></i>
        <span class="post-meta-item-text">  字数统计: </span>
        <span class="post-count">10.7k 字</span>
      </span>
    </span>

    <span class="post-time">
      &nbsp; | &nbsp;
      <span class="post-meta-item-icon">
        <i class="fa fa-hourglass-half"></i>
        <span class="post-meta-item-text">  阅读时长: </span>
        <span class="post-count">62 分</span>
      </span>
    </span>

    
        <span id="busuanzi_container_page_pv">
          &nbsp; | &nbsp;  本文总阅读量: <span id="busuanzi_value_page_pv"></span> 次
        </span>
    
</div>

        <br>
      </header>
      
      <div class="article-info article-info-post">
        
        
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/Big-Data/">Big Data</a><a class="article-category-link" href="/categories/Big-Data/Spark/">Spark</a>
    </div>


        
    <div class="article-tag tagcloud">
        <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Spark/" rel="tag">Spark</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/history-server/" rel="tag">history server</a></li></ul>
    </div>

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p><strong><em>版权声明：本文原创，转载请留意文尾，如有侵权请留言，谢谢</em></strong></p>
<h1 id="引言">引言</h1>
<p>　　 众所周知，在Spark里，History Server可以根据event
log恢复application的日志来供我们查看，在一次查看history
sever里日志的过程中，发现了一个不能理解的事情，如截图下面所示，为啥duration和scheduler
delay相等了啊，不科学啊，于是展开了一次溯源之旅，本文涉及到的源码来自Spark
2.3，截取代码只截取关键代码。</p>
<p><img src="/blog/2018/10/14/Spark%E9%87%8C%E6%9C%89%E5%85%B3History-Server%E7%9A%84scheduler-delay%E7%9B%B8%E5%85%B3%E6%BA%90%E7%A0%81%E7%9A%84%E4%B8%80%E6%AC%A1%E8%B0%83%E7%A0%94/1.png"> <img src="/blog/2018/10/14/Spark%E9%87%8C%E6%9C%89%E5%85%B3History-Server%E7%9A%84scheduler-delay%E7%9B%B8%E5%85%B3%E6%BA%90%E7%A0%81%E7%9A%84%E4%B8%80%E6%AC%A1%E8%B0%83%E7%A0%94/2.png"> <img src="/blog/2018/10/14/Spark%E9%87%8C%E6%9C%89%E5%85%B3History-Server%E7%9A%84scheduler-delay%E7%9B%B8%E5%85%B3%E6%BA%90%E7%A0%81%E7%9A%84%E4%B8%80%E6%AC%A1%E8%B0%83%E7%A0%94/3.png"></p>
<blockquote>
<p>这里贴了三张比较关键的截图，至于为啥贴这三张，先埋个伏笔。</p>
</blockquote>
<span id="more"></span>
<h1 id="task-state">Task State</h1>
<p>　　首先我们介绍下Spark里Task不同的states，我们查看源码：
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">TaskState</span>.scala</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>[spark] <span class="class"><span class="keyword">object</span> <span class="title">TaskState</span> <span class="keyword">extends</span> <span class="title">Enumeration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">val</span> <span class="type">LAUNCHING</span>, <span class="type">RUNNING</span>, <span class="type">FINISHED</span>, <span class="type">FAILED</span>, <span class="type">KILLED</span>, <span class="type">LOST</span> = <span class="type">Value</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">val</span> <span class="type">FINISHED_STATES</span> = <span class="type">Set</span>(<span class="type">FINISHED</span>, <span class="type">FAILED</span>, <span class="type">KILLED</span>, <span class="type">LOST</span>)</span><br><span class="line"></span><br><span class="line">  <span class="class"><span class="keyword">type</span> <span class="title">TaskState</span> </span>= <span class="type">Value</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">isFailed</span></span>(state: <span class="type">TaskState</span>): <span class="type">Boolean</span> = (<span class="type">LOST</span> == state) || (<span class="type">FAILED</span> == state)</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">isFinished</span></span>(state: <span class="type">TaskState</span>): <span class="type">Boolean</span> = <span class="type">FINISHED_STATES</span>.contains(state)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
　　源码写的很清晰，主要分为6种状态，<code>FINISHED_STATES</code>包括四种状态。</p>
<h1 id="duration">duration</h1>
<p>　　要想搞清楚为啥为啥duration和scheduler
delay相等了，首先要搞清楚duration和scheduler
delay是啥吧，duration很好理解，在源码里是这么定义的： <figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">TaskInfo</span>.scala</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * The time when the task has completed successfully (including the time to remotely fetch</span></span><br><span class="line"><span class="comment">   * results, if necessary).</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">var</span> finishTime: <span class="type">Long</span> = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">duration</span></span>: <span class="type">Long</span> = &#123;</span><br><span class="line">    <span class="keyword">if</span> (!finished) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="type">UnsupportedOperationException</span>(<span class="string">&quot;duration() called on unfinished task&quot;</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      finishTime - launchTime</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
　　这个定义是在<code>TaskInfo.scala</code>里的，<code>TaskInfo</code>这个类主要是描述Task的一些信息的，主要包含以下信息：
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">TaskInfo</span>.scala</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * :: DeveloperApi ::</span></span><br><span class="line"><span class="comment"> * Information about a running task attempt inside a TaskSet.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@DeveloperApi</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TaskInfo</span>(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="class">    val taskId: <span class="type">Long</span>,</span></span></span><br><span class="line"><span class="params"><span class="class">    /**</span></span></span><br><span class="line"><span class="params"><span class="class">     * <span class="type">The</span> index of this task within its task set. <span class="type">Not</span> necessarily the same as the <span class="type">ID</span> of the <span class="type">RDD</span></span></span></span><br><span class="line"><span class="params"><span class="class">     * partition that the task is computing.</span></span></span><br><span class="line"><span class="params"><span class="class">     */</span></span></span><br><span class="line"><span class="params"><span class="class">    val index: <span class="type">Int</span>,</span></span></span><br><span class="line"><span class="params"><span class="class">    val attemptNumber: <span class="type">Int</span>,</span></span></span><br><span class="line"><span class="params"><span class="class">    val launchTime: <span class="type">Long</span>,</span></span></span><br><span class="line"><span class="params"><span class="class">    val executorId: <span class="type">String</span>,</span></span></span><br><span class="line"><span class="params"><span class="class">    val host: <span class="type">String</span>,</span></span></span><br><span class="line"><span class="params"><span class="class">    val taskLocality: <span class="type">TaskLocality</span>.<span class="type">TaskLocality</span>,</span></span></span><br><span class="line"><span class="params"><span class="class">    val speculative: <span class="type">Boolean</span></span>)</span></span><br></pre></td></tr></table></figure></p>
<h1 id="scheduler-delay">Scheduler delay</h1>
<p>　　知道了duration是如何计算的，我们来看看scheduler
delay是如何计算的，官方给的定义是这样的：</p>
<blockquote>
<p>Scheduler delay includes time to ship the task from the scheduler to
the executor, and time to send the task result from the executor to the
scheduler. If scheduler delay is large, consider decreasing the size of
tasks or decreasing the size of task results.</p>
</blockquote>
<p>　　通过定义我们知道它主要由两部分构成，我们需要到<code>StagePage.scala</code>里查看，这个类主要是用作在Spark
UI里为显示Stage那个页面提供一些支持，通过阅读源码，我也发现了scheduler
delay是在“前端”计算出来的，找到源码： <figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">StagePage</span>.scala</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> schedulerDelay = <span class="type">AppStatusUtils</span>.schedulerDelay(taskInfo)</span><br></pre></td></tr></table></figure>
　　这边taskInfo的类型已经不是前面说的<code>taskInfo</code>类了，变成了<code>TaskData</code>类，多了一些东西，我比较关系是里面<code>taskMetrics</code>那个字段感兴趣，后面会说。
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">TaskData</span>.scala</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TaskData</span> <span class="title">private</span>[spark](<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="class">    val taskId: <span class="type">Long</span>,</span></span></span><br><span class="line"><span class="params"><span class="class">    val index: <span class="type">Int</span>,</span></span></span><br><span class="line"><span class="params"><span class="class">    val attempt: <span class="type">Int</span>,</span></span></span><br><span class="line"><span class="params"><span class="class">    val launchTime: <span class="type">Date</span>,</span></span></span><br><span class="line"><span class="params"><span class="class">    val resultFetchStart: <span class="type">Option</span>[<span class="type">Date</span>],</span></span></span><br><span class="line"><span class="params"><span class="class">    @<span class="type">JsonDeserialize</span>(contentAs = classOf[<span class="type">JLong</span>]</span>)</span></span><br><span class="line">    <span class="keyword">val</span> duration: <span class="type">Option</span>[<span class="type">Long</span>],</span><br><span class="line">    <span class="keyword">val</span> executorId: <span class="type">String</span>,</span><br><span class="line">    <span class="keyword">val</span> host: <span class="type">String</span>,</span><br><span class="line">    <span class="keyword">val</span> status: <span class="type">String</span>,</span><br><span class="line">    <span class="keyword">val</span> taskLocality: <span class="type">String</span>,</span><br><span class="line">    <span class="keyword">val</span> speculative: <span class="type">Boolean</span>,</span><br><span class="line">    <span class="keyword">val</span> accumulatorUpdates: <span class="type">Seq</span>[<span class="type">AccumulableInfo</span>],</span><br><span class="line">    <span class="keyword">val</span> errorMessage: <span class="type">Option</span>[<span class="type">String</span>] = <span class="type">None</span>,</span><br><span class="line">    <span class="keyword">val</span> taskMetrics: <span class="type">Option</span>[<span class="type">TaskMetrics</span>] = <span class="type">None</span>)</span><br></pre></td></tr></table></figure>
　　按照调用路径，我们需要前往<code>AppStatusUtils.scala</code>，找到相关源码：
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">AppStatusUtils</span>.scala</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">schedulerDelay</span></span>(task: <span class="type">TaskData</span>): <span class="type">Long</span> = &#123;</span><br><span class="line">    <span class="keyword">if</span> (isTaskFinished(task) &amp;&amp; task.taskMetrics.isDefined &amp;&amp; task.duration.isDefined) &#123;</span><br><span class="line">      <span class="keyword">val</span> m = task.taskMetrics.get</span><br><span class="line">      schedulerDelay(task.launchTime.getTime(), fetchStart(task), task.duration.get,</span><br><span class="line">        m.executorDeserializeTime, m.resultSerializationTime, m.executorRunTime)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// The task is still running and the metrics like executorRunTime are not available.</span></span><br><span class="line">      <span class="number">0</span>L</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">gettingResultTime</span></span>(task: <span class="type">TaskData</span>): <span class="type">Long</span> = &#123;</span><br><span class="line">    gettingResultTime(task.launchTime.getTime(), fetchStart(task), task.duration.getOrElse(<span class="number">-1</span>L))</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">schedulerDelay</span></span>(</span><br><span class="line">      launchTime: <span class="type">Long</span>,</span><br><span class="line">      fetchStart: <span class="type">Long</span>,</span><br><span class="line">      duration: <span class="type">Long</span>,</span><br><span class="line">      deserializeTime: <span class="type">Long</span>,</span><br><span class="line">      serializeTime: <span class="type">Long</span>,</span><br><span class="line">      runTime: <span class="type">Long</span>): <span class="type">Long</span> = &#123;</span><br><span class="line">    math.max(<span class="number">0</span>, duration - runTime - deserializeTime - serializeTime -</span><br><span class="line">      gettingResultTime(launchTime, fetchStart, duration))</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">gettingResultTime</span></span>(launchTime: <span class="type">Long</span>, fetchStart: <span class="type">Long</span>, duration: <span class="type">Long</span>): <span class="type">Long</span> = &#123;</span><br><span class="line">    <span class="keyword">if</span> (fetchStart &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (duration &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        launchTime + duration - fetchStart</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="type">System</span>.currentTimeMillis() - fetchStart</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="number">0</span>L</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="function"><span class="keyword">def</span> <span class="title">fetchStart</span></span>(task: <span class="type">TaskData</span>): <span class="type">Long</span> = &#123;</span><br><span class="line">    <span class="keyword">if</span> (task.resultFetchStart.isDefined) &#123;</span><br><span class="line">      task.resultFetchStart.get.getTime()</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="number">-1</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure> 　　可以看到是通过下面这行代码计算出scheduler delay的：
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">math.max(<span class="number">0</span>, duration - runTime - deserializeTime - serializeTime - gettingResultTime(launchTime, fetchStart, duration))</span><br></pre></td></tr></table></figure>
　　分析一下<code>gettingResultTime</code>拿到的时间对于这个task应该是0，因为我们例举的task被kill掉了，也没有开始fetch，所以直接就返回0了，那么scheduler
delay等于duration的情况就是runTime，deserializeTime，serializeTime等于0，但是我通过查看日志发现这个task实际上是已经跑了一段时间的了，只不过在跑的时候报错挂掉了，runtime照理说应该是有值的。<br>
　　所以怀疑是不是history sever读event
log时出了问题，没有把一些metric读出来，那么下一步调研的地方就是eventlog里有没有写这些metric。</p>
<h1 id="eventlog">eventlog</h1>
<p>　　eventlog里存的基本都是josn，我们查看刚刚那个task在eventlog里的相关记录：
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;Event&quot;:&quot;SparkListenerTaskStart&quot;,&quot;Stage ID&quot;:2,&quot;Stage Attempt ID&quot;:0,&quot;Task Info&quot;:&#123;&quot;Task ID&quot;:73449,&quot;Index&quot;:44132,&quot;Attempt&quot;:0,&quot;Launch Time&quot;:1538980751807,&quot;Executor ID&quot;:&quot;1887&quot;,&quot;Host&quot;:&quot;n20-169-012.byted.org&quot;,&quot;Locality&quot;:&quot;ANY&quot;,&quot;Speculative&quot;:false,&quot;Getting Result Time&quot;:0,&quot;Finish Time&quot;:0,&quot;Failed&quot;:false,&quot;Killed&quot;:false,&quot;Accumulables&quot;:[]&#125;&#125;</span><br><span class="line"></span><br><span class="line">&#123;&quot;Event&quot;:&quot;SparkListenerTaskEnd&quot;,&quot;Stage ID&quot;:2,&quot;Stage Attempt ID&quot;:0,&quot;Task Type&quot;:&quot;ShuffleMapTask&quot;,&quot;Task End Reason&quot;:&#123;&quot;Reason&quot;:&quot;ExecutorLostFailure&quot;,&quot;Executor ID&quot;:&quot;1887&quot;,&quot;Exit Caused By App&quot;:true,&quot;Loss Reason&quot;:&quot;Container marked as failed: container_e58_1537853739253_724343_01_002668 on host: n20-169-012.byted.org. Exit status: 137. Diagnostics: Container killed on request. Exit code is 137\nContainer exited with a non-zero exit code 137\nKilled by external signal\n&quot;&#125;,&quot;Task Info&quot;:&#123;&quot;Task ID&quot;:73449,&quot;Index&quot;:44132,&quot;Attempt&quot;:0,&quot;Launch Time&quot;:1538980751807,&quot;Executor ID&quot;:&quot;1887&quot;,&quot;Host&quot;:&quot;n20-169-012.byted.org&quot;,&quot;Locality&quot;:&quot;ANY&quot;,&quot;Speculative&quot;:false,&quot;Getting Result Time&quot;:0,&quot;Finish Time&quot;:1538982792494,&quot;Failed&quot;:true,&quot;Killed&quot;:false,&quot;Accumulables&quot;:[]&#125;&#125;</span><br></pre></td></tr></table></figure> 　　我们可以看到有两条，一个是task start的时候，一个是task
end的时候，我们可以发现它们没有出现gctime，runtime相关的信息，并且它们的<code>Accumulables"</code>都是空的，我们再来看看一个正常执行的task的eventlog：
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;Event&quot;:&quot;SparkListenerTaskStart&quot;,&quot;Stage ID&quot;:2,&quot;Stage Attempt ID&quot;:0,&quot;Task Info&quot;:&#123;&quot;Task ID&quot;:96167,&quot;Index&quot;:71751,&quot;Attempt&quot;:0,&quot;Launch Time&quot;:1538981799849,&quot;Executor ID&quot;:&quot;47&quot;,&quot;Host&quot;:&quot;n20-169-034.byted.org&quot;,&quot;Locality&quot;:&quot;ANY&quot;,&quot;Speculative&quot;:false,&quot;Getting Result Time&quot;:0,&quot;Finish Time&quot;:0,&quot;Failed&quot;:false,&quot;Killed&quot;:false,&quot;Accumulables&quot;:[]&#125;&#125;</span><br><span class="line"></span><br><span class="line">&#123;&quot;Event&quot;:&quot;SparkListenerTaskEnd&quot;,&quot;Stage ID&quot;:2,&quot;Stage Attempt ID&quot;:0,&quot;Task Type&quot;:&quot;ShuffleMapTask&quot;,&quot;Task End Reason&quot;:&#123;&quot;Reason&quot;:&quot;Success&quot;&#125;,&quot;Task Info&quot;:&#123;&quot;Task ID&quot;:96167,&quot;Index&quot;:71751,&quot;Attempt&quot;:0,&quot;Launch Time&quot;:1538981799849,&quot;Executor ID&quot;:&quot;47&quot;,&quot;Host&quot;:&quot;n20-169-034.byted.org&quot;,&quot;Locality&quot;:&quot;ANY&quot;,&quot;Speculative&quot;:false,&quot;Getting Result Time&quot;:0,&quot;Finish Time&quot;:1538982857308,&quot;Failed&quot;:false,&quot;Killed&quot;:false,&quot;Accumulables&quot;:[&#123;&quot;ID&quot;:0,&quot;Name&quot;:&quot;number of output rows&quot;,&quot;Update&quot;:&quot;3144257&quot;,&quot;Value&quot;:&quot;193001569046&quot;,&quot;Internal&quot;:true,&quot;Count Failed Values&quot;:true,&quot;Metadata&quot;:&quot;sql&quot;&#125;,&#123;&quot;ID&quot;:1,&quot;Name&quot;:&quot;duration total (min, med, max)&quot;,&quot;Update&quot;:&quot;296739&quot;,&quot;Value&quot;:&quot;20574282506&quot;,&quot;Internal&quot;:true,&quot;Count Failed Values&quot;:true,&quot;Metadata&quot;:&quot;sql&quot;&#125;,&#123;&quot;ID&quot;:2,&quot;Name&quot;:&quot;number of output rows&quot;,&quot;Update&quot;:&quot;3144257&quot;,&quot;Value&quot;:&quot;193001569046&quot;,&quot;Internal&quot;:true,&quot;Count Failed Values&quot;:true,&quot;Metadata&quot;:&quot;sql&quot;&#125;,&#123;&quot;ID&quot;:97,&quot;Name&quot;:&quot;internal.metrics.input.readTime&quot;,&quot;Update&quot;:55015209823,&quot;Value&quot;:3788643412534097,&quot;Internal&quot;:true,&quot;Count Failed Values&quot;:true&#125;,&#123;&quot;ID&quot;:96,&quot;Name&quot;:&quot;internal.metrics.input.recordsRead&quot;,&quot;Update&quot;:3144257,&quot;Value&quot;:194036789396,&quot;Internal&quot;:true,&quot;Count Failed Values&quot;:true&#125;,&#123;&quot;ID&quot;:95,&quot;Name&quot;:&quot;internal.metrics.input.bytesRead&quot;,&quot;Update&quot;:157355874,&quot;Value&quot;:9776658919771,&quot;Internal&quot;:true,&quot;Count Failed Values&quot;:true&#125;,&#123;&quot;ID&quot;:94,&quot;Name&quot;:&quot;internal.metrics.shuffle.write.writeTime&quot;,&quot;Update&quot;:851762781,&quot;Value&quot;:60526120166751,&quot;Internal&quot;:true,&quot;Count Failed Values&quot;:true&#125;,&#123;&quot;ID&quot;:93,&quot;Name&quot;:&quot;internal.metrics.shuffle.write.recordsWritten&quot;,&quot;Update&quot;:60694,&quot;Value&quot;:3381196990,&quot;Internal&quot;:true,&quot;Count Failed Values&quot;:true&#125;,&#123;&quot;ID&quot;:92,&quot;Name&quot;:&quot;internal.metrics.shuffle.write.bytesWritten&quot;,&quot;Update&quot;:414699805,&quot;Value&quot;:23437561541959,&quot;Internal&quot;:true,&quot;Count Failed Values&quot;:true&#125;,&#123;&quot;ID&quot;:83,&quot;Name&quot;:&quot;internal.metrics.peakExecutionMemory&quot;,&quot;Update&quot;:4920588528,&quot;Value&quot;:357713831688139,&quot;Internal&quot;:true,&quot;Count Failed Values&quot;:true&#125;,&#123;&quot;ID&quot;:82,&quot;Name&quot;:&quot;internal.metrics.diskBytesSpilled&quot;,&quot;Update&quot;:0,&quot;Value&quot;:4989021671965,&quot;Internal&quot;:true,&quot;Count Failed Values&quot;:true&#125;,&#123;&quot;ID&quot;:81,&quot;Name&quot;:&quot;internal.metrics.memoryBytesSpilled&quot;,&quot;Update&quot;:0,&quot;Value&quot;:108828367227114,&quot;Internal&quot;:true,&quot;Count Failed Values&quot;:true&#125;,&#123;&quot;ID&quot;:79,&quot;Name&quot;:&quot;internal.metrics.jvmGCTime&quot;,&quot;Update&quot;:9419,&quot;Value&quot;:1895361835,&quot;Internal&quot;:true,&quot;Count Failed Values&quot;:true&#125;,&#123;&quot;ID&quot;:78,&quot;Name&quot;:&quot;internal.metrics.resultSize&quot;,&quot;Update&quot;:11299,&quot;Value&quot;:1051775802,&quot;Internal&quot;:true,&quot;Count Failed Values&quot;:true&#125;,&#123;&quot;ID&quot;:77,&quot;Name&quot;:&quot;internal.metrics.executorCpuTime&quot;,&quot;Update&quot;:303834483953,&quot;Value&quot;:20217755709982523,&quot;Internal&quot;:true,&quot;Count Failed Values&quot;:true&#125;,&#123;&quot;ID&quot;:76,&quot;Name&quot;:&quot;internal.metrics.executorRunTime&quot;,&quot;Update&quot;:314501,&quot;Value&quot;:22499830665,&quot;Internal&quot;:true,&quot;Count Failed Values&quot;:true&#125;,&#123;&quot;ID&quot;:75,&quot;Name&quot;:&quot;internal.metrics.executorDeserializeCpuTime&quot;,&quot;Update&quot;:13373759,&quot;Value&quot;:3815858758196,&quot;Internal&quot;:true,&quot;Count Failed Values&quot;:true&#125;,&#123;&quot;ID&quot;:74,&quot;Name&quot;:&quot;internal.metrics.executorDeserializeTime&quot;,&quot;Update&quot;:12,&quot;Value&quot;:9852624,&quot;Internal&quot;:true,&quot;Count Failed Values&quot;:true&#125;]&#125;,&quot;Task Metrics&quot;:&#123;&quot;Executor Deserialize Time&quot;:12,&quot;Executor Deserialize CPU Time&quot;:13373759,&quot;Executor Run Time&quot;:314501,&quot;Executor CPU Time&quot;:303834483953,&quot;Result Size&quot;:11299,&quot;JVM GC Time&quot;:9419,&quot;Result Serialization Time&quot;:0,&quot;Memory Bytes Spilled&quot;:0,&quot;Disk Bytes Spilled&quot;:0,&quot;Shuffle Read Metrics&quot;:&#123;&quot;Remote Blocks Fetched&quot;:0,&quot;Local Blocks Fetched&quot;:0,&quot;Fetch Wait Time&quot;:0,&quot;Remote Bytes Read&quot;:0,&quot;Remote Bytes Read To Disk&quot;:0,&quot;Local Bytes Read&quot;:0,&quot;Total Records Read&quot;:0&#125;,&quot;Shuffle Write Metrics&quot;:&#123;&quot;Shuffle Bytes Written&quot;:414699805,&quot;Shuffle Write Time&quot;:851762781,&quot;Shuffle Records Written&quot;:60694&#125;,&quot;Input Metrics&quot;:&#123;&quot;Bytes Read&quot;:157355874,&quot;Records Read&quot;:3144257&#125;,&quot;Output Metrics&quot;:&#123;&quot;Bytes Written&quot;:0,&quot;Records Written&quot;:0&#125;,&quot;Updated Blocks&quot;:[]&#125;&#125;</span><br></pre></td></tr></table></figure>
　　可以看到，多了许多信息，许多metric的信息，并且都是保存在<code>Accumulables</code>和<code>TaskMetrics</code>下的，因此我们基本可以判断出History
Sever里没显示那些metric是因为eventlog中根本就没有写的原因，我们再来看看相关这部分的源码，是`<code>里解析json的，我们只挑选解析task end的部分： <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br></pre></td><td class="code"><pre><span class="line">JsonProtocol.scala</span><br><span class="line"></span><br><span class="line">  def taskEndFromJson(json: JValue): SparkListenerTaskEnd = &#123;</span><br><span class="line">    val stageId = (json \ &quot;Stage ID&quot;).extract[Int]</span><br><span class="line">    val stageAttemptId =</span><br><span class="line">      Utils.jsonOption(json \ &quot;Stage Attempt ID&quot;).map(_.extract[Int]).getOrElse(0)</span><br><span class="line">    val taskType = (json \ &quot;Task Type&quot;).extract[String]</span><br><span class="line">    val taskEndReason = taskEndReasonFromJson(json \ &quot;Task End Reason&quot;)</span><br><span class="line">    val taskInfo = taskInfoFromJson(json \ &quot;Task Info&quot;)</span><br><span class="line">    val taskMetrics = taskMetricsFromJson(json \ &quot;Task Metrics&quot;)</span><br><span class="line">    SparkListenerTaskEnd(stageId, stageAttemptId, taskType, taskEndReason, taskInfo, taskMetrics)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  def taskMetricsFromJson(json: JValue): TaskMetrics = &#123;</span><br><span class="line">    val metrics = TaskMetrics.empty</span><br><span class="line">    if (json == JNothing) &#123;</span><br><span class="line">      return metrics</span><br><span class="line">    &#125;</span><br><span class="line">    metrics.setExecutorDeserializeTime((json \ &quot;Executor Deserialize Time&quot;).extract[Long])</span><br><span class="line">    metrics.setExecutorDeserializeCpuTime((json \ &quot;Executor Deserialize CPU Time&quot;) match &#123;</span><br><span class="line">      case JNothing =&gt; 0</span><br><span class="line">      case x =&gt; x.extract[Long]</span><br><span class="line">    &#125;)</span><br><span class="line">    metrics.setExecutorRunTime((json \ &quot;Executor Run Time&quot;).extract[Long])</span><br><span class="line">    metrics.setExecutorCpuTime((json \ &quot;Executor CPU Time&quot;) match &#123;</span><br><span class="line">      case JNothing =&gt; 0</span><br><span class="line">      case x =&gt; x.extract[Long]</span><br><span class="line">    &#125;)</span><br><span class="line">    metrics.setResultSize((json \ &quot;Result Size&quot;).extract[Long])</span><br><span class="line">    metrics.setJvmGCTime((json \ &quot;JVM GC Time&quot;).extract[Long])</span><br><span class="line">    metrics.setResultSerializationTime((json \ &quot;Result Serialization Time&quot;).extract[Long])</span><br><span class="line">    metrics.incMemoryBytesSpilled((json \ &quot;Memory Bytes Spilled&quot;).extract[Long])</span><br><span class="line">    metrics.incDiskBytesSpilled((json \ &quot;Disk Bytes Spilled&quot;).extract[Long])</span><br><span class="line"></span><br><span class="line">    // Shuffle read metrics</span><br><span class="line">    Utils.jsonOption(json \ &quot;Shuffle Read Metrics&quot;).foreach &#123; readJson =&gt;</span><br><span class="line">      val readMetrics = metrics.createTempShuffleReadMetrics()</span><br><span class="line">      readMetrics.incRemoteBlocksFetched((readJson \ &quot;Remote Blocks Fetched&quot;).extract[Int])</span><br><span class="line">      readMetrics.incLocalBlocksFetched((readJson \ &quot;Local Blocks Fetched&quot;).extract[Int])</span><br><span class="line">      readMetrics.incRemoteBytesRead((readJson \ &quot;Remote Bytes Read&quot;).extract[Long])</span><br><span class="line">      Utils.jsonOption(readJson \ &quot;Remote Bytes Read To Disk&quot;)</span><br><span class="line">        .foreach &#123; v =&gt; readMetrics.incRemoteBytesReadToDisk(v.extract[Long])&#125;</span><br><span class="line">      readMetrics.incLocalBytesRead(</span><br><span class="line">        Utils.jsonOption(readJson \ &quot;Local Bytes Read&quot;).map(_.extract[Long]).getOrElse(0L))</span><br><span class="line">      readMetrics.incFetchWaitTime((readJson \ &quot;Fetch Wait Time&quot;).extract[Long])</span><br><span class="line">      readMetrics.incRecordsRead(</span><br><span class="line">        Utils.jsonOption(readJson \ &quot;Total Records Read&quot;).map(_.extract[Long]).getOrElse(0L))</span><br><span class="line">      metrics.mergeShuffleReadMetrics()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // Shuffle write metrics</span><br><span class="line">    // TODO: Drop the redundant &quot;Shuffle&quot; since it&#x27;s inconsistent with related classes.</span><br><span class="line">    Utils.jsonOption(json \ &quot;Shuffle Write Metrics&quot;).foreach &#123; writeJson =&gt;</span><br><span class="line">      val writeMetrics = metrics.shuffleWriteMetrics</span><br><span class="line">      writeMetrics.incBytesWritten((writeJson \ &quot;Shuffle Bytes Written&quot;).extract[Long])</span><br><span class="line">      writeMetrics.incRecordsWritten(</span><br><span class="line">        Utils.jsonOption(writeJson \ &quot;Shuffle Records Written&quot;).map(_.extract[Long]).getOrElse(0L))</span><br><span class="line">      writeMetrics.incWriteTime((writeJson \ &quot;Shuffle Write Time&quot;).extract[Long])</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // Output metrics</span><br><span class="line">    Utils.jsonOption(json \ &quot;Output Metrics&quot;).foreach &#123; outJson =&gt;</span><br><span class="line">      val outputMetrics = metrics.outputMetrics</span><br><span class="line">      outputMetrics.setBytesWritten((outJson \ &quot;Bytes Written&quot;).extract[Long])</span><br><span class="line">      outputMetrics.setRecordsWritten(</span><br><span class="line">        Utils.jsonOption(outJson \ &quot;Records Written&quot;).map(_.extract[Long]).getOrElse(0L))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // Input metrics</span><br><span class="line">    Utils.jsonOption(json \ &quot;Input Metrics&quot;).foreach &#123; inJson =&gt;</span><br><span class="line">      val inputMetrics = metrics.inputMetrics</span><br><span class="line">      inputMetrics.incBytesRead((inJson \ &quot;Bytes Read&quot;).extract[Long])</span><br><span class="line">      inputMetrics.incRecordsRead(</span><br><span class="line">        Utils.jsonOption(inJson \ &quot;Records Read&quot;).map(_.extract[Long]).getOrElse(0L))</span><br><span class="line">      inputMetrics.incReadTime(</span><br><span class="line">        Utils.jsonOption(inJson \ &quot;Read Time&quot;).map(_.extract[Long]).getOrElse(0L))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // Updated blocks</span><br><span class="line">    Utils.jsonOption(json \ &quot;Updated Blocks&quot;).foreach &#123; blocksJson =&gt;</span><br><span class="line">      metrics.setUpdatedBlockStatuses(blocksJson.extract[List[JValue]].map &#123; blockJson =&gt;</span><br><span class="line">        val id = BlockId((blockJson \ &quot;Block ID&quot;).extract[String])</span><br><span class="line">        val status = blockStatusFromJson(blockJson \ &quot;Status&quot;)</span><br><span class="line">        (id, status)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    metrics</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">  def taskEndReasonFromJson(json: JValue): TaskEndReason = &#123;</span><br><span class="line">    import TASK_END_REASON_FORMATTED_CLASS_NAMES._</span><br><span class="line"></span><br><span class="line">    (json \ &quot;Reason&quot;).extract[String] match &#123;</span><br><span class="line">      case `success` =&gt; Success</span><br><span class="line">      case `resubmitted` =&gt; Resubmitted</span><br><span class="line">      case `fetchFailed` =&gt;</span><br><span class="line">        val blockManagerAddress = blockManagerIdFromJson(json \ &quot;Block Manager Address&quot;)</span><br><span class="line">        val shuffleId = (json \ &quot;Shuffle ID&quot;).extract[Int]</span><br><span class="line">        val mapId = (json \ &quot;Map ID&quot;).extract[Int]</span><br><span class="line">        val reduceId = (json \ &quot;Reduce ID&quot;).extract[Int]</span><br><span class="line">        val message = Utils.jsonOption(json \ &quot;Message&quot;).map(_.extract[String])</span><br><span class="line">        new FetchFailed(blockManagerAddress, shuffleId, mapId, reduceId,</span><br><span class="line">          message.getOrElse(&quot;Unknown reason&quot;))</span><br><span class="line">      case `exceptionFailure` =&gt;</span><br><span class="line">        val className = (json \ &quot;Class Name&quot;).extract[String]</span><br><span class="line">        val description = (json \ &quot;Description&quot;).extract[String]</span><br><span class="line">        val stackTrace = stackTraceFromJson(json \ &quot;Stack Trace&quot;)</span><br><span class="line">        val fullStackTrace =</span><br><span class="line">          Utils.jsonOption(json \ &quot;Full Stack Trace&quot;).map(_.extract[String]).orNull</span><br><span class="line">        // Fallback on getting accumulator updates from TaskMetrics, which was logged in Spark 1.x</span><br><span class="line">        val accumUpdates = Utils.jsonOption(json \ &quot;Accumulator Updates&quot;)</span><br><span class="line">          .map(_.extract[List[JValue]].map(accumulableInfoFromJson))</span><br><span class="line">          .getOrElse(taskMetricsFromJson(json \ &quot;Metrics&quot;).accumulators().map(acc =&gt; &#123;</span><br><span class="line">            acc.toInfo(Some(acc.value), None)</span><br><span class="line">          &#125;))</span><br><span class="line">        ExceptionFailure(className, description, stackTrace, fullStackTrace, None, accumUpdates)</span><br><span class="line">      case `taskResultLost` =&gt; TaskResultLost</span><br><span class="line">      case `taskKilled` =&gt;</span><br><span class="line">        val killReason = Utils.jsonOption(json \ &quot;Kill Reason&quot;)</span><br><span class="line">          .map(_.extract[String]).getOrElse(&quot;unknown reason&quot;)</span><br><span class="line">        TaskKilled(killReason)</span><br><span class="line">      case `taskCommitDenied` =&gt;</span><br><span class="line">        // Unfortunately, the `TaskCommitDenied` message was introduced in 1.3.0 but the JSON</span><br><span class="line">        // de/serialization logic was not added until 1.5.1. To provide backward compatibility</span><br><span class="line">        // for reading those logs, we need to provide default values for all the fields.</span><br><span class="line">        val jobId = Utils.jsonOption(json \ &quot;Job ID&quot;).map(_.extract[Int]).getOrElse(-1)</span><br><span class="line">        val partitionId = Utils.jsonOption(json \ &quot;Partition ID&quot;).map(_.extract[Int]).getOrElse(-1)</span><br><span class="line">        val attemptNo = Utils.jsonOption(json \ &quot;Attempt Number&quot;).map(_.extract[Int]).getOrElse(-1)</span><br><span class="line">        TaskCommitDenied(jobId, partitionId, attemptNo)</span><br><span class="line">      case `executorLostFailure` =&gt;</span><br><span class="line">        val exitCausedByApp = Utils.jsonOption(json \ &quot;Exit Caused By App&quot;).map(_.extract[Boolean])</span><br><span class="line">        val executorId = Utils.jsonOption(json \ &quot;Executor ID&quot;).map(_.extract[String])</span><br><span class="line">        val reason = Utils.jsonOption(json \ &quot;Loss Reason&quot;).map(_.extract[String])</span><br><span class="line">        ExecutorLostFailure(</span><br><span class="line">          executorId.getOrElse(&quot;Unknown&quot;),</span><br><span class="line">          exitCausedByApp.getOrElse(true),</span><br><span class="line">          reason)</span><br><span class="line">      case `unknownReason` =&gt; UnknownReason</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  def taskInfoFromJson(json: JValue): TaskInfo = &#123;</span><br><span class="line">    val taskId = (json \ &quot;Task ID&quot;).extract[Long]</span><br><span class="line">    val index = (json \ &quot;Index&quot;).extract[Int]</span><br><span class="line">    val attempt = Utils.jsonOption(json \ &quot;Attempt&quot;).map(_.extract[Int]).getOrElse(1)</span><br><span class="line">    val launchTime = (json \ &quot;Launch Time&quot;).extract[Long]</span><br><span class="line">    val executorId = (json \ &quot;Executor ID&quot;).extract[String].intern()</span><br><span class="line">    val host = (json \ &quot;Host&quot;).extract[String].intern()</span><br><span class="line">    val taskLocality = TaskLocality.withName((json \ &quot;Locality&quot;).extract[String])</span><br><span class="line">    val speculative = Utils.jsonOption(json \ &quot;Speculative&quot;).exists(_.extract[Boolean])</span><br><span class="line">    val gettingResultTime = (json \ &quot;Getting Result Time&quot;).extract[Long]</span><br><span class="line">    val finishTime = (json \ &quot;Finish Time&quot;).extract[Long]</span><br><span class="line">    val failed = (json \ &quot;Failed&quot;).extract[Boolean]</span><br><span class="line">    val killed = Utils.jsonOption(json \ &quot;Killed&quot;).exists(_.extract[Boolean])</span><br><span class="line">    val accumulables = Utils.jsonOption(json \ &quot;Accumulables&quot;).map(_.extract[Seq[JValue]]) match &#123;</span><br><span class="line">      case Some(values) =&gt; values.map(accumulableInfoFromJson)</span><br><span class="line">      case None =&gt; Seq.empty[AccumulableInfo]</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    val taskInfo =</span><br><span class="line">      new TaskInfo(taskId, index, attempt, launchTime, executorId, host, taskLocality, speculative)</span><br><span class="line">    taskInfo.gettingResultTime = gettingResultTime</span><br><span class="line">    taskInfo.finishTime = finishTime</span><br><span class="line">    taskInfo.failed = failed</span><br><span class="line">    taskInfo.killed = killed</span><br><span class="line">    taskInfo.setAccumulables(accumulables)</span><br><span class="line"></span><br><span class="line">    taskInfo</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  def accumulableInfoFromJson(json: JValue): AccumulableInfo = &#123;</span><br><span class="line">    val id = (json \ &quot;ID&quot;).extract[Long]</span><br><span class="line">    val name = Utils.jsonOption(json \ &quot;Name&quot;).map(_.extract[String])</span><br><span class="line">    val update = Utils.jsonOption(json \ &quot;Update&quot;).map &#123; v =&gt; accumValueFromJson(name, v) &#125;</span><br><span class="line">    val value = Utils.jsonOption(json \ &quot;Value&quot;).map &#123; v =&gt; accumValueFromJson(name, v) &#125;</span><br><span class="line">    val internal = Utils.jsonOption(json \ &quot;Internal&quot;).exists(_.extract[Boolean])</span><br><span class="line">    val countFailedValues =</span><br><span class="line">      Utils.jsonOption(json \ &quot;Count Failed Values&quot;).exists(_.extract[Boolean])</span><br><span class="line">    val metadata = Utils.jsonOption(json \ &quot;Metadata&quot;).map(_.extract[String])</span><br><span class="line">    new AccumulableInfo(id, name, update, value, internal, countFailedValues, metadata)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * Deserialize the value of an accumulator from JSON.</span><br><span class="line">   *</span><br><span class="line">   * For accumulators representing internal task metrics, this looks up the relevant</span><br><span class="line">   * [[AccumulatorParam]] to deserialize the value accordingly. For all other</span><br><span class="line">   * accumulators, this will simply deserialize the value as a string.</span><br><span class="line">   *</span><br><span class="line">   * The behavior here must match that of [[accumValueToJson]]. Exposed for testing.</span><br><span class="line">   */</span><br><span class="line">  private[util] def accumValueFromJson(name: Option[String], value: JValue): Any = &#123;</span><br><span class="line">    if (name.exists(_.startsWith(InternalAccumulator.METRICS_PREFIX))) &#123;</span><br><span class="line">      value match &#123;</span><br><span class="line">        case JInt(v) =&gt; v.toLong</span><br><span class="line">        case JArray(v) =&gt;</span><br><span class="line">          v.map &#123; blockJson =&gt;</span><br><span class="line">            val id = BlockId((blockJson \ &quot;Block ID&quot;).extract[String])</span><br><span class="line">            val status = blockStatusFromJson(blockJson \ &quot;Status&quot;)</span><br><span class="line">            (id, status)</span><br><span class="line">          &#125;.asJava</span><br><span class="line">        case _ =&gt; throw new IllegalArgumentException(s&quot;unexpected json value $value for &quot; +</span><br><span class="line">          &quot;accumulator &quot; + name.get)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      value.extract[String]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  def taskMetricsFromJson(json: JValue): TaskMetrics = &#123;</span><br><span class="line">    val metrics = TaskMetrics.empty</span><br><span class="line">    if (json == JNothing) &#123;</span><br><span class="line">      return metrics</span><br><span class="line">    &#125;</span><br><span class="line">    metrics.setExecutorDeserializeTime((json \ &quot;Executor Deserialize Time&quot;).extract[Long])</span><br><span class="line">    metrics.setExecutorDeserializeCpuTime((json \ &quot;Executor Deserialize CPU Time&quot;) match &#123;</span><br><span class="line">      case JNothing =&gt; 0</span><br><span class="line">      case x =&gt; x.extract[Long]</span><br><span class="line">    &#125;)</span><br><span class="line">    metrics.setExecutorRunTime((json \ &quot;Executor Run Time&quot;).extract[Long])</span><br><span class="line">    metrics.setExecutorCpuTime((json \ &quot;Executor CPU Time&quot;) match &#123;</span><br><span class="line">      case JNothing =&gt; 0</span><br><span class="line">      case x =&gt; x.extract[Long]</span><br><span class="line">    &#125;)</span><br><span class="line">    metrics.setResultSize((json \ &quot;Result Size&quot;).extract[Long])</span><br><span class="line">    metrics.setJvmGCTime((json \ &quot;JVM GC Time&quot;).extract[Long])</span><br><span class="line">    metrics.setResultSerializationTime((json \ &quot;Result Serialization Time&quot;).extract[Long])</span><br><span class="line">    metrics.incMemoryBytesSpilled((json \ &quot;Memory Bytes Spilled&quot;).extract[Long])</span><br><span class="line">    metrics.incDiskBytesSpilled((json \ &quot;Disk Bytes Spilled&quot;).extract[Long])</span><br><span class="line"></span><br><span class="line">    // Shuffle read metrics</span><br><span class="line">    Utils.jsonOption(json \ &quot;Shuffle Read Metrics&quot;).foreach &#123; readJson =&gt;</span><br><span class="line">      val readMetrics = metrics.createTempShuffleReadMetrics()</span><br><span class="line">      readMetrics.incRemoteBlocksFetched((readJson \ &quot;Remote Blocks Fetched&quot;).extract[Int])</span><br><span class="line">      readMetrics.incLocalBlocksFetched((readJson \ &quot;Local Blocks Fetched&quot;).extract[Int])</span><br><span class="line">      readMetrics.incRemoteBytesRead((readJson \ &quot;Remote Bytes Read&quot;).extract[Long])</span><br><span class="line">      Utils.jsonOption(readJson \ &quot;Remote Bytes Read To Disk&quot;)</span><br><span class="line">        .foreach &#123; v =&gt; readMetrics.incRemoteBytesReadToDisk(v.extract[Long])&#125;</span><br><span class="line">      readMetrics.incLocalBytesRead(</span><br><span class="line">        Utils.jsonOption(readJson \ &quot;Local Bytes Read&quot;).map(_.extract[Long]).getOrElse(0L))</span><br><span class="line">      readMetrics.incFetchWaitTime((readJson \ &quot;Fetch Wait Time&quot;).extract[Long])</span><br><span class="line">      readMetrics.incRecordsRead(</span><br><span class="line">        Utils.jsonOption(readJson \ &quot;Total Records Read&quot;).map(_.extract[Long]).getOrElse(0L))</span><br><span class="line">      metrics.mergeShuffleReadMetrics()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // Shuffle write metrics</span><br><span class="line">    // TODO: Drop the redundant &quot;Shuffle&quot; since it&#x27;s inconsistent with related classes.</span><br><span class="line">    Utils.jsonOption(json \ &quot;Shuffle Write Metrics&quot;).foreach &#123; writeJson =&gt;</span><br><span class="line">      val writeMetrics = metrics.shuffleWriteMetrics</span><br><span class="line">      writeMetrics.incBytesWritten((writeJson \ &quot;Shuffle Bytes Written&quot;).extract[Long])</span><br><span class="line">      writeMetrics.incRecordsWritten(</span><br><span class="line">        Utils.jsonOption(writeJson \ &quot;Shuffle Records Written&quot;).map(_.extract[Long]).getOrElse(0L))</span><br><span class="line">      writeMetrics.incWriteTime((writeJson \ &quot;Shuffle Write Time&quot;).extract[Long])</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // Output metrics</span><br><span class="line">    Utils.jsonOption(json \ &quot;Output Metrics&quot;).foreach &#123; outJson =&gt;</span><br><span class="line">      val outputMetrics = metrics.outputMetrics</span><br><span class="line">      outputMetrics.setBytesWritten((outJson \ &quot;Bytes Written&quot;).extract[Long])</span><br><span class="line">      outputMetrics.setRecordsWritten(</span><br><span class="line">        Utils.jsonOption(outJson \ &quot;Records Written&quot;).map(_.extract[Long]).getOrElse(0L))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // Input metrics</span><br><span class="line">    Utils.jsonOption(json \ &quot;Input Metrics&quot;).foreach &#123; inJson =&gt;</span><br><span class="line">      val inputMetrics = metrics.inputMetrics</span><br><span class="line">      inputMetrics.incBytesRead((inJson \ &quot;Bytes Read&quot;).extract[Long])</span><br><span class="line">      inputMetrics.incRecordsRead(</span><br><span class="line">        Utils.jsonOption(inJson \ &quot;Records Read&quot;).map(_.extract[Long]).getOrElse(0L))</span><br><span class="line">      inputMetrics.incReadTime(</span><br><span class="line">        Utils.jsonOption(inJson \ &quot;Read Time&quot;).map(_.extract[Long]).getOrElse(0L))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // Updated blocks</span><br><span class="line">    Utils.jsonOption(json \ &quot;Updated Blocks&quot;).foreach &#123; blocksJson =&gt;</span><br><span class="line">      metrics.setUpdatedBlockStatuses(blocksJson.extract[List[JValue]].map &#123; blockJson =&gt;</span><br><span class="line">        val id = BlockId((blockJson \ &quot;Block ID&quot;).extract[String])</span><br><span class="line">        val status = blockStatusFromJson(blockJson \ &quot;Status&quot;)</span><br><span class="line">        (id, status)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    metrics</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  private object TASK_END_REASON_FORMATTED_CLASS_NAMES &#123;</span><br><span class="line">    val success = Utils.getFormattedClassName(Success)</span><br><span class="line">    val resubmitted = Utils.getFormattedClassName(Resubmitted)</span><br><span class="line">    val fetchFailed = Utils.getFormattedClassName(FetchFailed)</span><br><span class="line">    val exceptionFailure = Utils.getFormattedClassName(ExceptionFailure)</span><br><span class="line">    val taskResultLost = Utils.getFormattedClassName(TaskResultLost)</span><br><span class="line">    val taskKilled = Utils.getFormattedClassName(TaskKilled)</span><br><span class="line">    val taskCommitDenied = Utils.getFormattedClassName(TaskCommitDenied)</span><br><span class="line">    val executorLostFailure = Utils.getFormattedClassName(ExecutorLostFailure)</span><br><span class="line">    val unknownReason = Utils.getFormattedClassName(UnknownReason)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  def taskEndReasonFromJson(json: JValue): TaskEndReason = &#123;</span><br><span class="line">    import TASK_END_REASON_FORMATTED_CLASS_NAMES._</span><br><span class="line"></span><br><span class="line">    (json \ &quot;Reason&quot;).extract[String] match &#123;</span><br><span class="line">      case `success` =&gt; Success</span><br><span class="line">      case `resubmitted` =&gt; Resubmitted</span><br><span class="line">      case `fetchFailed` =&gt;</span><br><span class="line">        val blockManagerAddress = blockManagerIdFromJson(json \ &quot;Block Manager Address&quot;)</span><br><span class="line">        val shuffleId = (json \ &quot;Shuffle ID&quot;).extract[Int]</span><br><span class="line">        val mapId = (json \ &quot;Map ID&quot;).extract[Int]</span><br><span class="line">        val reduceId = (json \ &quot;Reduce ID&quot;).extract[Int]</span><br><span class="line">        val message = Utils.jsonOption(json \ &quot;Message&quot;).map(_.extract[String])</span><br><span class="line">        new FetchFailed(blockManagerAddress, shuffleId, mapId, reduceId,</span><br><span class="line">          message.getOrElse(&quot;Unknown reason&quot;))</span><br><span class="line">      case `exceptionFailure` =&gt;</span><br><span class="line">        val className = (json \ &quot;Class Name&quot;).extract[String]</span><br><span class="line">        val description = (json \ &quot;Description&quot;).extract[String]</span><br><span class="line">        val stackTrace = stackTraceFromJson(json \ &quot;Stack Trace&quot;)</span><br><span class="line">        val fullStackTrace =</span><br><span class="line">          Utils.jsonOption(json \ &quot;Full Stack Trace&quot;).map(_.extract[String]).orNull</span><br><span class="line">        // Fallback on getting accumulator updates from TaskMetrics, which was logged in Spark 1.x</span><br><span class="line">        val accumUpdates = Utils.jsonOption(json \ &quot;Accumulator Updates&quot;)</span><br><span class="line">          .map(_.extract[List[JValue]].map(accumulableInfoFromJson))</span><br><span class="line">          .getOrElse(taskMetricsFromJson(json \ &quot;Metrics&quot;).accumulators().map(acc =&gt; &#123;</span><br><span class="line">            acc.toInfo(Some(acc.value), None)</span><br><span class="line">          &#125;))</span><br><span class="line">        ExceptionFailure(className, description, stackTrace, fullStackTrace, None, accumUpdates)</span><br><span class="line">      case `taskResultLost` =&gt; TaskResultLost</span><br><span class="line">      case `taskKilled` =&gt;</span><br><span class="line">        val killReason = Utils.jsonOption(json \ &quot;Kill Reason&quot;)</span><br><span class="line">          .map(_.extract[String]).getOrElse(&quot;unknown reason&quot;)</span><br><span class="line">        TaskKilled(killReason)</span><br><span class="line">      case `taskCommitDenied` =&gt;</span><br><span class="line">        // Unfortunately, the `TaskCommitDenied` message was introduced in 1.3.0 but the JSON</span><br><span class="line">        // de/serialization logic was not added until 1.5.1. To provide backward compatibility</span><br><span class="line">        // for reading those logs, we need to provide default values for all the fields.</span><br><span class="line">        val jobId = Utils.jsonOption(json \ &quot;Job ID&quot;).map(_.extract[Int]).getOrElse(-1)</span><br><span class="line">        val partitionId = Utils.jsonOption(json \ &quot;Partition ID&quot;).map(_.extract[Int]).getOrElse(-1)</span><br><span class="line">        val attemptNo = Utils.jsonOption(json \ &quot;Attempt Number&quot;).map(_.extract[Int]).getOrElse(-1)</span><br><span class="line">        TaskCommitDenied(jobId, partitionId, attemptNo)</span><br><span class="line">      case `executorLostFailure` =&gt;</span><br><span class="line">        val exitCausedByApp = Utils.jsonOption(json \ &quot;Exit Caused By App&quot;).map(_.extract[Boolean])</span><br><span class="line">        val executorId = Utils.jsonOption(json \ &quot;Executor ID&quot;).map(_.extract[String])</span><br><span class="line">        val reason = Utils.jsonOption(json \ &quot;Loss Reason&quot;).map(_.extract[String])</span><br><span class="line">        ExecutorLostFailure(</span><br><span class="line">          executorId.getOrElse(&quot;Unknown&quot;),</span><br><span class="line">          exitCausedByApp.getOrElse(true),</span><br><span class="line">          reason)</span><br><span class="line">      case `unknownReason` =&gt; UnknownReason</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure> 　　我们可以看出确实需要解析</code>Accumulables<code>和</code>TaskMetrics`的。</p>
<h2 id="accumulatbles"><code>Accumulatbles</code></h2>
<p>　　<code>Accumulatbles</code>主要是用来保存task和stage的一些信息的，采取递增的方式保存，我们看看它的定义：
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">AccumulablesInfo.scala</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * :: DeveloperApi ::</span><br><span class="line"> * Information about an [[org.apache.spark.Accumulable]] modified during a task or stage.</span><br><span class="line"> *</span><br><span class="line"> * @param id accumulator ID</span><br><span class="line"> * @param name accumulator name</span><br><span class="line"> * @param update partial value from a task, may be None if used on driver to describe a stage</span><br><span class="line"> * @param value total accumulated value so far, maybe None if used on executors to describe a task</span><br><span class="line"> * @param internal whether this accumulator was internal</span><br><span class="line"> * @param countFailedValues whether to count this accumulator&#x27;s partial value if the task failed</span><br><span class="line"> * @param metadata internal metadata associated with this accumulator, if any</span><br><span class="line"> *</span><br><span class="line"> * @note Once this is JSON serialized the types of `update` and `value` will be lost and be</span><br><span class="line"> * cast to strings. This is because the user can define an accumulator of any type and it will</span><br><span class="line"> * be difficult to preserve the type in consumers of the event log. This does not apply to</span><br><span class="line"> * internal accumulators that represent task level metrics.</span><br><span class="line"> */</span><br><span class="line">@DeveloperApi</span><br><span class="line">case class AccumulableInfo private[spark] (</span><br><span class="line">    id: Long,</span><br><span class="line">    name: Option[String],</span><br><span class="line">    update: Option[Any], // represents a partial update within a task</span><br><span class="line">    value: Option[Any],</span><br><span class="line">    private[spark] val internal: Boolean,</span><br><span class="line">    private[spark] val countFailedValues: Boolean,</span><br><span class="line">    // TODO: use this to identify internal task metrics instead of encoding it in the name</span><br><span class="line">    private[spark] val metadata: Option[String] = None)</span><br></pre></td></tr></table></figure></p>
<h2 id="taskmetrics"><code>TaskMetrics</code></h2>
<p>　　<code>TaskMetric</code>保存了一些internal的Metrics：
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">api.scala</span><br><span class="line"></span><br><span class="line">class TaskMetrics private[spark](</span><br><span class="line">    val executorDeserializeTime: Long,</span><br><span class="line">    val executorDeserializeCpuTime: Long,</span><br><span class="line">    val executorRunTime: Long,</span><br><span class="line">    val executorCpuTime: Long,</span><br><span class="line">    val resultSize: Long,</span><br><span class="line">    val jvmGcTime: Long,</span><br><span class="line">    val resultSerializationTime: Long,</span><br><span class="line">    val memoryBytesSpilled: Long,</span><br><span class="line">    val diskBytesSpilled: Long,</span><br><span class="line">    val peakExecutionMemory: Long,</span><br><span class="line">    val inputMetrics: InputMetrics,</span><br><span class="line">    val outputMetrics: OutputMetrics,</span><br><span class="line">    val shuffleReadMetrics: ShuffleReadMetrics,</span><br><span class="line">    val shuffleWriteMetrics: ShuffleWriteMetrics)</span><br></pre></td></tr></table></figure></p>
<h1 id="sparklistenertaskend">SparkListenerTaskEnd</h1>
<p>　　那么接下来我们要来寻找的就是为啥那个task的metric信息没有写到日志里了，我们从后往前推，一步一步的挖掘到它产生消息的路径，首先是task
end的时候，会触发一个<code>SparkListenerTaskEnd</code>的envet：
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">SparkListener</span>.scala</span><br><span class="line"></span><br><span class="line"><span class="meta">@DeveloperApi</span></span><br><span class="line"><span class="keyword">case</span> <span class="class"><span class="keyword">class</span> <span class="title">SparkListenerTaskEnd</span>(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="class">    stageId: <span class="type">Int</span>,</span></span></span><br><span class="line"><span class="params"><span class="class">    stageAttemptId: <span class="type">Int</span>,</span></span></span><br><span class="line"><span class="params"><span class="class">    taskType: <span class="type">String</span>,</span></span></span><br><span class="line"><span class="params"><span class="class">    reason: <span class="type">TaskEndReason</span>,</span></span></span><br><span class="line"><span class="params"><span class="class">    taskInfo: <span class="type">TaskInfo</span>,</span></span></span><br><span class="line"><span class="params"><span class="class">    // may be null if the task has failed</span></span></span><br><span class="line"><span class="params"><span class="class">    @<span class="type">Nullable</span> taskMetrics: <span class="type">TaskMetrics</span></span>)</span></span><br><span class="line">  <span class="keyword">extends</span> <span class="type">SparkListenerEvent</span></span><br></pre></td></tr></table></figure> 　　我们从注释可以看出，一个taks
failed的话，是有可能没有taskMetrics，注意它用的是may
be，也就是说也是有可能有task
metrics，那么我们下一步就是要找到<code>SparkListenerTaskEnd</code>是在哪触发的。</p>
<h2 id="appstatuslistener"><code>AppStatusListener</code></h2>
<p>　　在查看<code>SparkListenerTaskEnd</code>的上游前，我们看看它的一个下游<code>AppStatusListener</code>，它会监听<code>SparkListener</code>的event，更新信息系后并写到data
store中 <figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">AppStatusListener</span>.scala</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * A Spark listener that writes application information to a data store. The types written to the</span></span><br><span class="line"><span class="comment"> * store are defined in the `storeTypes.scala` file and are based on the public REST API.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @param lastUpdateTime When replaying logs, the log&#x27;s last update time, so that the duration of</span></span><br><span class="line"><span class="comment"> *                       unfinished tasks can be more accurately calculated (see SPARK-21922).</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span>[spark] <span class="class"><span class="keyword">class</span> <span class="title">AppStatusListener</span>(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="class">    kvstore: <span class="type">ElementTrackingStore</span>,</span></span></span><br><span class="line"><span class="params"><span class="class">    conf: <span class="type">SparkConf</span>,</span></span></span><br><span class="line"><span class="params"><span class="class">    live: <span class="type">Boolean</span>,</span></span></span><br><span class="line"><span class="params"><span class="class">    lastUpdateTime: <span class="type">Option</span>[<span class="type">Long</span>] = <span class="type">None</span></span>) <span class="keyword">extends</span> <span class="title">SparkListener</span> <span class="keyword">with</span> <span class="title">Logging</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">onTaskEnd</span></span>(event: <span class="type">SparkListenerTaskEnd</span>): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> can this really happen?</span></span><br><span class="line">    <span class="keyword">if</span> (event.taskInfo == <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> now = <span class="type">System</span>.nanoTime()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> metricsDelta = liveTasks.remove(event.taskInfo.taskId).map &#123; task =&gt;</span><br><span class="line">      task.info = event.taskInfo</span><br><span class="line"></span><br><span class="line">      <span class="keyword">val</span> errorMessage = event.reason <span class="keyword">match</span> &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="type">Success</span> =&gt;</span><br><span class="line">          <span class="type">None</span></span><br><span class="line">        <span class="keyword">case</span> k: <span class="type">TaskKilled</span> =&gt;</span><br><span class="line">          <span class="type">Some</span>(k.reason)</span><br><span class="line">        <span class="keyword">case</span> e: <span class="type">ExceptionFailure</span> =&gt; <span class="comment">// Handle ExceptionFailure because we might have accumUpdates</span></span><br><span class="line">          <span class="type">Some</span>(e.toErrorString)</span><br><span class="line">        <span class="keyword">case</span> e: <span class="type">TaskFailedReason</span> =&gt; <span class="comment">// All other failure cases</span></span><br><span class="line">          <span class="type">Some</span>(e.toErrorString)</span><br><span class="line">        <span class="keyword">case</span> other =&gt;</span><br><span class="line">          logInfo(<span class="string">s&quot;Unhandled task end reason: <span class="subst">$other</span>&quot;</span>)</span><br><span class="line">          <span class="type">None</span></span><br><span class="line">      &#125;</span><br><span class="line">      task.errorMessage = errorMessage</span><br><span class="line">      <span class="keyword">val</span> delta = task.updateMetrics(event.taskMetrics)</span><br><span class="line">      update(task, now, last = <span class="literal">true</span>)</span><br><span class="line">      delta</span><br><span class="line">    &#125;.orNull</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> (completedDelta, failedDelta, killedDelta) = event.reason <span class="keyword">match</span> &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="type">Success</span> =&gt;</span><br><span class="line">        (<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">      <span class="keyword">case</span> _: <span class="type">TaskKilled</span> =&gt;</span><br><span class="line">        (<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">      <span class="keyword">case</span> _: <span class="type">TaskCommitDenied</span> =&gt;</span><br><span class="line">        (<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">      <span class="keyword">case</span> _ =&gt;</span><br><span class="line">        (<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">Option</span>(liveStages.get((event.stageId, event.stageAttemptId))).foreach &#123; stage =&gt;</span><br><span class="line">      <span class="keyword">if</span> (metricsDelta != <span class="literal">null</span>) &#123;</span><br><span class="line">        stage.metrics = <span class="type">LiveEntityHelpers</span>.addMetrics(stage.metrics, metricsDelta)</span><br><span class="line">      &#125;</span><br><span class="line">      stage.activeTasks -= <span class="number">1</span></span><br><span class="line">      stage.completedTasks += completedDelta</span><br><span class="line">      <span class="keyword">if</span> (completedDelta &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        stage.completedIndices.add(event.taskInfo.index)</span><br><span class="line">      &#125;</span><br><span class="line">      stage.failedTasks += failedDelta</span><br><span class="line">      stage.killedTasks += killedDelta</span><br><span class="line">      <span class="keyword">if</span> (killedDelta &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        stage.killedSummary = killedTasksSummary(event.reason, stage.killedSummary)</span><br><span class="line">      &#125;</span><br><span class="line">      maybeUpdate(stage, now)</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Store both stage ID and task index in a single long variable for tracking at job level.</span></span><br><span class="line">      <span class="keyword">val</span> taskIndex = (event.stageId.toLong &lt;&lt; <span class="type">Integer</span>.<span class="type">SIZE</span>) | event.taskInfo.index</span><br><span class="line">      stage.jobs.foreach &#123; job =&gt;</span><br><span class="line">        job.activeTasks -= <span class="number">1</span></span><br><span class="line">        job.completedTasks += completedDelta</span><br><span class="line">        <span class="keyword">if</span> (completedDelta &gt; <span class="number">0</span>) &#123;</span><br><span class="line">          job.completedIndices.add(taskIndex)</span><br><span class="line">        &#125;</span><br><span class="line">        job.failedTasks += failedDelta</span><br><span class="line">        job.killedTasks += killedDelta</span><br><span class="line">        <span class="keyword">if</span> (killedDelta &gt; <span class="number">0</span>) &#123;</span><br><span class="line">          job.killedSummary = killedTasksSummary(event.reason, job.killedSummary)</span><br><span class="line">        &#125;</span><br><span class="line">        maybeUpdate(job, now)</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">val</span> esummary = stage.executorSummary(event.taskInfo.executorId)</span><br><span class="line">      esummary.taskTime += event.taskInfo.duration</span><br><span class="line">      esummary.succeededTasks += completedDelta</span><br><span class="line">      esummary.failedTasks += failedDelta</span><br><span class="line">      esummary.killedTasks += killedDelta</span><br><span class="line">      <span class="keyword">if</span> (metricsDelta != <span class="literal">null</span>) &#123;</span><br><span class="line">        esummary.metrics = <span class="type">LiveEntityHelpers</span>.addMetrics(esummary.metrics, metricsDelta)</span><br><span class="line">      &#125;</span><br><span class="line">      maybeUpdate(esummary, now)</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (!stage.cleaning &amp;&amp; stage.savedTasks.get() &gt; maxTasksPerStage) &#123;</span><br><span class="line">        stage.cleaning = <span class="literal">true</span></span><br><span class="line">        kvstore.doAsync &#123;</span><br><span class="line">          cleanupTasks(stage)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    liveExecutors.get(event.taskInfo.executorId).foreach &#123; exec =&gt;</span><br><span class="line">      exec.activeTasks -= <span class="number">1</span></span><br><span class="line">      exec.completedTasks += completedDelta</span><br><span class="line">      exec.failedTasks += failedDelta</span><br><span class="line">      exec.totalDuration += event.taskInfo.duration</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Note: For resubmitted tasks, we continue to use the metrics that belong to the</span></span><br><span class="line">      <span class="comment">// first attempt of this task. This may not be 100% accurate because the first attempt</span></span><br><span class="line">      <span class="comment">// could have failed half-way through. The correct fix would be to keep track of the</span></span><br><span class="line">      <span class="comment">// metrics added by each attempt, but this is much more complicated.</span></span><br><span class="line">      <span class="keyword">if</span> (event.reason != <span class="type">Resubmitted</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (event.taskMetrics != <span class="literal">null</span>) &#123;</span><br><span class="line">          <span class="keyword">val</span> readMetrics = event.taskMetrics.shuffleReadMetrics</span><br><span class="line">          exec.totalGcTime += event.taskMetrics.jvmGCTime</span><br><span class="line">          exec.totalInputBytes += event.taskMetrics.inputMetrics.bytesRead</span><br><span class="line">          exec.totalShuffleRead += readMetrics.localBytesRead + readMetrics.remoteBytesRead</span><br><span class="line">          exec.totalShuffleWrite += event.taskMetrics.shuffleWriteMetrics.bytesWritten</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Force an update on live applications when the number of active tasks reaches 0. This is</span></span><br><span class="line">      <span class="comment">// checked in some tests (e.g. SQLTestUtilsBase) so it needs to be reliably up to date.</span></span><br><span class="line">      <span class="keyword">if</span> (exec.activeTasks == <span class="number">0</span>) &#123;</span><br><span class="line">        liveUpdate(exec, now)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        maybeUpdate(exec, now)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p>
<h1 id="dagschuduler">DAGSchuduler</h1>
<p>　　我们发现DAGScheduler里有对task end的相关处理： <figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">DAGScheduler</span>.scala</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Responds to a task finishing. This is called inside the event loop so it assumes that it can</span></span><br><span class="line"><span class="comment">   * modify the scheduler&#x27;s internal state. Use taskEnded() to post a task end event from outside.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">private</span>[scheduler] <span class="function"><span class="keyword">def</span> <span class="title">handleTaskCompletion</span></span>(event: <span class="type">CompletionEvent</span>) &#123;</span><br><span class="line">    <span class="keyword">val</span> task = event.task</span><br><span class="line">    <span class="keyword">val</span> taskId = event.taskInfo.id</span><br><span class="line">    <span class="keyword">val</span> stageId = task.stageId</span><br><span class="line">    <span class="keyword">val</span> taskType = <span class="type">Utils</span>.getFormattedClassName(task)</span><br><span class="line"></span><br><span class="line">    outputCommitCoordinator.taskCompleted(</span><br><span class="line">      stageId,</span><br><span class="line">      task.partitionId,</span><br><span class="line">      event.taskInfo.attemptNumber, <span class="comment">// this is a task attempt number</span></span><br><span class="line">      event.reason)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!stageIdToStage.contains(task.stageId)) &#123;</span><br><span class="line">      <span class="comment">// The stage may have already finished when we get this event -- eg. maybe it was a</span></span><br><span class="line">      <span class="comment">// speculative task. It is important that we send the TaskEnd event in any case, so listeners</span></span><br><span class="line">      <span class="comment">// are properly notified and can chose to handle it. For instance, some listeners are</span></span><br><span class="line">      <span class="comment">// doing their own accounting and if they don&#x27;t get the task end event they think</span></span><br><span class="line">      <span class="comment">// tasks are still running when they really aren&#x27;t.</span></span><br><span class="line">      postTaskEnd(event)</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Skip all the actions if the stage has been cancelled.</span></span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> stage = stageIdToStage(task.stageId)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Make sure the task&#x27;s accumulators are updated before any other processing happens, so that</span></span><br><span class="line">    <span class="comment">// we can post a task end event before any jobs or stages are updated. The accumulators are</span></span><br><span class="line">    <span class="comment">// only updated in certain cases.</span></span><br><span class="line">    event.reason <span class="keyword">match</span> &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="type">Success</span> =&gt;</span><br><span class="line">        task <span class="keyword">match</span> &#123;</span><br><span class="line">          <span class="keyword">case</span> rt: <span class="type">ResultTask</span>[_, _] =&gt;</span><br><span class="line">            <span class="keyword">val</span> resultStage = stage.asInstanceOf[<span class="type">ResultStage</span>]</span><br><span class="line">            resultStage.activeJob <span class="keyword">match</span> &#123;</span><br><span class="line">              <span class="keyword">case</span> <span class="type">Some</span>(job) =&gt;</span><br><span class="line">                <span class="comment">// Only update the accumulator once for each result task.</span></span><br><span class="line">                <span class="keyword">if</span> (!job.finished(rt.outputId)) &#123;</span><br><span class="line">                  updateAccumulators(event)</span><br><span class="line">                &#125;</span><br><span class="line">              <span class="keyword">case</span> <span class="type">None</span> =&gt; <span class="comment">// Ignore update if task&#x27;s job has finished.</span></span><br><span class="line">            &#125;</span><br><span class="line">          <span class="keyword">case</span> _ =&gt;</span><br><span class="line">            updateAccumulators(event)</span><br><span class="line">        &#125;</span><br><span class="line">      <span class="keyword">case</span> _: <span class="type">ExceptionFailure</span> =&gt; updateAccumulators(event)</span><br><span class="line">      <span class="keyword">case</span> _ =&gt;</span><br><span class="line">    &#125;</span><br><span class="line">    postTaskEnd(event)</span><br><span class="line"></span><br><span class="line">    event.reason <span class="keyword">match</span> &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="type">Success</span> =&gt;</span><br><span class="line">        task <span class="keyword">match</span> &#123;</span><br><span class="line">          <span class="keyword">case</span> rt: <span class="type">ResultTask</span>[_, _] =&gt;</span><br><span class="line">            <span class="comment">// Cast to ResultStage here because it&#x27;s part of the ResultTask</span></span><br><span class="line">            <span class="comment">// TODO Refactor this out to a function that accepts a ResultStage</span></span><br><span class="line">            <span class="keyword">val</span> resultStage = stage.asInstanceOf[<span class="type">ResultStage</span>]</span><br><span class="line">            resultStage.activeJob <span class="keyword">match</span> &#123;</span><br><span class="line">              <span class="keyword">case</span> <span class="type">Some</span>(job) =&gt;</span><br><span class="line">                <span class="keyword">if</span> (!job.finished(rt.outputId)) &#123;</span><br><span class="line">                  job.finished(rt.outputId) = <span class="literal">true</span></span><br><span class="line">                  job.numFinished += <span class="number">1</span></span><br><span class="line">                  <span class="comment">// If the whole job has finished, remove it</span></span><br><span class="line">                  <span class="keyword">if</span> (job.numFinished == job.numPartitions) &#123;</span><br><span class="line">                    markStageAsFinished(resultStage)</span><br><span class="line">                    cleanupStateForJobAndIndependentStages(job)</span><br><span class="line">                    listenerBus.post(</span><br><span class="line">                      <span class="type">SparkListenerJobEnd</span>(job.jobId, clock.getTimeMillis(), <span class="type">JobSucceeded</span>))</span><br><span class="line">                  &#125;</span><br><span class="line"></span><br><span class="line">                  <span class="comment">// taskSucceeded runs some user code that might throw an exception. Make sure</span></span><br><span class="line">                  <span class="comment">// we are resilient against that.</span></span><br><span class="line">                  <span class="keyword">try</span> &#123;</span><br><span class="line">                    job.listener.taskSucceeded(rt.outputId, event.result)</span><br><span class="line">                  &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">                    <span class="keyword">case</span> e: <span class="type">Exception</span> =&gt;</span><br><span class="line">                      <span class="comment">// <span class="doctag">TODO:</span> Perhaps we want to mark the resultStage as failed?</span></span><br><span class="line">                      job.listener.jobFailed(<span class="keyword">new</span> <span class="type">SparkDriverExecutionException</span>(e))</span><br><span class="line">                  &#125;</span><br><span class="line">                &#125;</span><br><span class="line">              <span class="keyword">case</span> <span class="type">None</span> =&gt;</span><br><span class="line">                logInfo(<span class="string">&quot;Ignoring result from &quot;</span> + rt + <span class="string">&quot; because its job has finished&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">case</span> smt: <span class="type">ShuffleMapTask</span> =&gt;</span><br><span class="line">            <span class="keyword">val</span> shuffleStage = stage.asInstanceOf[<span class="type">ShuffleMapStage</span>]</span><br><span class="line">            <span class="keyword">val</span> status = event.result.asInstanceOf[<span class="type">MapStatus</span>]</span><br><span class="line">            <span class="keyword">val</span> execId = status.location.executorId</span><br><span class="line">            logDebug(<span class="string">&quot;ShuffleMapTask finished on &quot;</span> + execId)</span><br><span class="line">            <span class="keyword">if</span> (stageIdToStage(task.stageId).latestInfo.attemptNumber == task.stageAttemptId) &#123;</span><br><span class="line">              <span class="comment">// This task was for the currently running attempt of the stage. Since the task</span></span><br><span class="line">              <span class="comment">// completed successfully from the perspective of the TaskSetManager, mark it as</span></span><br><span class="line">              <span class="comment">// no longer pending (the TaskSetManager may consider the task complete even</span></span><br><span class="line">              <span class="comment">// when the output needs to be ignored because the task&#x27;s epoch is too small below.</span></span><br><span class="line">              <span class="comment">// In this case, when pending partitions is empty, there will still be missing</span></span><br><span class="line">              <span class="comment">// output locations, which will cause the DAGScheduler to resubmit the stage below.)</span></span><br><span class="line">              shuffleStage.pendingPartitions -= task.partitionId</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (failedEpoch.contains(execId) &amp;&amp; smt.epoch &lt;= failedEpoch(execId)) &#123;</span><br><span class="line">              logInfo(<span class="string">s&quot;Ignoring possibly bogus <span class="subst">$smt</span> completion from executor <span class="subst">$execId</span>&quot;</span>)</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">              <span class="comment">// The epoch of the task is acceptable (i.e., the task was launched after the most</span></span><br><span class="line">              <span class="comment">// recent failure we&#x27;re aware of for the executor), so mark the task&#x27;s output as</span></span><br><span class="line">              <span class="comment">// available.</span></span><br><span class="line">              mapOutputTracker.registerMapOutput(</span><br><span class="line">                shuffleStage.shuffleDep.shuffleId, smt.partitionId, status)</span><br><span class="line">              <span class="comment">// Remove the task&#x27;s partition from pending partitions. This may have already been</span></span><br><span class="line">              <span class="comment">// done above, but will not have been done yet in cases where the task attempt was</span></span><br><span class="line">              <span class="comment">// from an earlier attempt of the stage (i.e., not the attempt that&#x27;s currently</span></span><br><span class="line">              <span class="comment">// running).  This allows the DAGScheduler to mark the stage as complete when one</span></span><br><span class="line">              <span class="comment">// copy of each task has finished successfully, even if the currently active stage</span></span><br><span class="line">              <span class="comment">// still has tasks running.</span></span><br><span class="line">              shuffleStage.pendingPartitions -= task.partitionId</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (runningStages.contains(shuffleStage) &amp;&amp; shuffleStage.pendingPartitions.isEmpty) &#123;</span><br><span class="line">              markStageAsFinished(shuffleStage)</span><br><span class="line">              logInfo(<span class="string">&quot;looking for newly runnable stages&quot;</span>)</span><br><span class="line">              logInfo(<span class="string">&quot;running: &quot;</span> + runningStages)</span><br><span class="line">              logInfo(<span class="string">&quot;waiting: &quot;</span> + waitingStages)</span><br><span class="line">              logInfo(<span class="string">&quot;failed: &quot;</span> + failedStages)</span><br><span class="line"></span><br><span class="line">              <span class="comment">// This call to increment the epoch may not be strictly necessary, but it is retained</span></span><br><span class="line">              <span class="comment">// for now in order to minimize the changes in behavior from an earlier version of the</span></span><br><span class="line">              <span class="comment">// code. This existing behavior of always incrementing the epoch following any</span></span><br><span class="line">              <span class="comment">// successful shuffle map stage completion may have benefits by causing unneeded</span></span><br><span class="line">              <span class="comment">// cached map outputs to be cleaned up earlier on executors. In the future we can</span></span><br><span class="line">              <span class="comment">// consider removing this call, but this will require some extra investigation.</span></span><br><span class="line">              <span class="comment">// See https://github.com/apache/spark/pull/17955/files#r117385673 for more details.</span></span><br><span class="line">              mapOutputTracker.incrementEpoch()</span><br><span class="line"></span><br><span class="line">              clearCacheLocs()</span><br><span class="line"></span><br><span class="line">              <span class="keyword">if</span> (!shuffleStage.isAvailable) &#123;</span><br><span class="line">                <span class="comment">// Some tasks had failed; let&#x27;s resubmit this shuffleStage.</span></span><br><span class="line">                <span class="comment">// <span class="doctag">TODO:</span> Lower-level scheduler should also deal with this</span></span><br><span class="line">                logInfo(<span class="string">&quot;Resubmitting &quot;</span> + shuffleStage + <span class="string">&quot; (&quot;</span> + shuffleStage.name +</span><br><span class="line">                  <span class="string">&quot;) because some of its tasks had failed: &quot;</span> +</span><br><span class="line">                  shuffleStage.findMissingPartitions().mkString(<span class="string">&quot;, &quot;</span>))</span><br><span class="line">                submitStage(shuffleStage)</span><br><span class="line">              &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                markMapStageJobsAsFinished(shuffleStage)</span><br><span class="line">                submitWaitingChildStages(shuffleStage)</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">case</span> <span class="type">Resubmitted</span> =&gt;</span><br><span class="line">        logInfo(<span class="string">&quot;Resubmitted &quot;</span> + task + <span class="string">&quot;, so marking it as still running&quot;</span>)</span><br><span class="line">        stage <span class="keyword">match</span> &#123;</span><br><span class="line">          <span class="keyword">case</span> sms: <span class="type">ShuffleMapStage</span> =&gt;</span><br><span class="line">            sms.pendingPartitions += task.partitionId</span><br><span class="line"></span><br><span class="line">          <span class="keyword">case</span> _ =&gt;</span><br><span class="line">            assert(<span class="literal">false</span>, <span class="string">&quot;TaskSetManagers should only send Resubmitted task statuses for &quot;</span> +</span><br><span class="line">              <span class="string">&quot;tasks in ShuffleMapStages.&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">case</span> <span class="type">FetchFailed</span>(bmAddress, shuffleId, mapId, reduceId, failureMessage) =&gt;</span><br><span class="line">        <span class="keyword">val</span> failedStage = stageIdToStage(task.stageId)</span><br><span class="line">        <span class="keyword">val</span> mapStage = shuffleIdToMapStage(shuffleId)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (failedStage.latestInfo.attemptNumber != task.stageAttemptId) &#123;</span><br><span class="line">          logInfo(<span class="string">s&quot;Ignoring fetch failure from <span class="subst">$task</span> as it&#x27;s from <span class="subst">$failedStage</span> attempt&quot;</span> +</span><br><span class="line">            <span class="string">s&quot; <span class="subst">$&#123;task.stageAttemptId&#125;</span> and there is a more recent attempt for that stage &quot;</span> +</span><br><span class="line">            <span class="string">s&quot;(attempt <span class="subst">$&#123;failedStage.latestInfo.attemptNumber&#125;</span>) running&quot;</span>)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="comment">// It is likely that we receive multiple FetchFailed for a single stage (because we have</span></span><br><span class="line">          <span class="comment">// multiple tasks running concurrently on different executors). In that case, it is</span></span><br><span class="line">          <span class="comment">// possible the fetch failure has already been handled by the scheduler.</span></span><br><span class="line">          <span class="keyword">if</span> (runningStages.contains(failedStage)) &#123;</span><br><span class="line">            logInfo(<span class="string">s&quot;Marking <span class="subst">$failedStage</span> (<span class="subst">$&#123;failedStage.name&#125;</span>) as failed &quot;</span> +</span><br><span class="line">              <span class="string">s&quot;due to a fetch failure from <span class="subst">$mapStage</span> (<span class="subst">$&#123;mapStage.name&#125;</span>)&quot;</span>)</span><br><span class="line">            markStageAsFinished(failedStage, <span class="type">Some</span>(failureMessage))</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            logDebug(<span class="string">s&quot;Received fetch failure from <span class="subst">$task</span>, but its from <span class="subst">$failedStage</span> which is no &quot;</span> +</span><br><span class="line">              <span class="string">s&quot;longer running&quot;</span>)</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          failedStage.fetchFailedAttemptIds.add(task.stageAttemptId)</span><br><span class="line">          <span class="keyword">val</span> shouldAbortStage =</span><br><span class="line">            failedStage.fetchFailedAttemptIds.size &gt;= maxConsecutiveStageAttempts ||</span><br><span class="line">            disallowStageRetryForTest</span><br><span class="line"></span><br><span class="line">          <span class="keyword">if</span> (shouldAbortStage) &#123;</span><br><span class="line">            <span class="keyword">val</span> abortMessage = <span class="keyword">if</span> (disallowStageRetryForTest) &#123;</span><br><span class="line">              <span class="string">&quot;Fetch failure will not retry stage due to testing config&quot;</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">              <span class="string">s&quot;&quot;</span><span class="string">&quot;$failedStage ($&#123;failedStage.name&#125;)</span></span><br><span class="line"><span class="string">                 |has failed the maximum allowable number of</span></span><br><span class="line"><span class="string">                 |times: $maxConsecutiveStageAttempts.</span></span><br><span class="line"><span class="string">                 |Most recent failure reason: $failureMessage&quot;</span><span class="string">&quot;&quot;</span>.stripMargin.replaceAll(<span class="string">&quot;\n&quot;</span>, <span class="string">&quot; &quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            abortStage(failedStage, abortMessage, <span class="type">None</span>)</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123; <span class="comment">// update failedStages and make sure a ResubmitFailedStages event is enqueued</span></span><br><span class="line">            <span class="comment">// <span class="doctag">TODO:</span> Cancel running tasks in the failed stage -- cf. SPARK-17064</span></span><br><span class="line">            <span class="keyword">val</span> noResubmitEnqueued = !failedStages.contains(failedStage)</span><br><span class="line">            failedStages += failedStage</span><br><span class="line">            failedStages += mapStage</span><br><span class="line">            <span class="keyword">if</span> (noResubmitEnqueued) &#123;</span><br><span class="line">              <span class="comment">// We expect one executor failure to trigger many FetchFailures in rapid succession,</span></span><br><span class="line">              <span class="comment">// but all of those task failures can typically be handled by a single resubmission of</span></span><br><span class="line">              <span class="comment">// the failed stage.  We avoid flooding the scheduler&#x27;s event queue with resubmit</span></span><br><span class="line">              <span class="comment">// messages by checking whether a resubmit is already in the event queue for the</span></span><br><span class="line">              <span class="comment">// failed stage.  If there is already a resubmit enqueued for a different failed</span></span><br><span class="line">              <span class="comment">// stage, that event would also be sufficient to handle the current failed stage, but</span></span><br><span class="line">              <span class="comment">// producing a resubmit for each failed stage makes debugging and logging a little</span></span><br><span class="line">              <span class="comment">// simpler while not producing an overwhelming number of scheduler events.</span></span><br><span class="line">              logInfo(</span><br><span class="line">                <span class="string">s&quot;Resubmitting <span class="subst">$mapStage</span> (<span class="subst">$&#123;mapStage.name&#125;</span>) and &quot;</span> +</span><br><span class="line">                <span class="string">s&quot;<span class="subst">$failedStage</span> (<span class="subst">$&#123;failedStage.name&#125;</span>) due to fetch failure&quot;</span></span><br><span class="line">              )</span><br><span class="line">              messageScheduler.schedule(</span><br><span class="line">                <span class="keyword">new</span> <span class="type">Runnable</span> &#123;</span><br><span class="line">                  <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">run</span></span>(): <span class="type">Unit</span> = eventProcessLoop.post(<span class="type">ResubmitFailedStages</span>)</span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="type">DAGScheduler</span>.<span class="type">RESUBMIT_TIMEOUT</span>,</span><br><span class="line">                <span class="type">TimeUnit</span>.<span class="type">MILLISECONDS</span></span><br><span class="line">              )</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="comment">// Mark the map whose fetch failed as broken in the map stage</span></span><br><span class="line">          <span class="keyword">if</span> (mapId != <span class="number">-1</span>) &#123;</span><br><span class="line">            mapOutputTracker.unregisterMapOutput(shuffleId, mapId, bmAddress)</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          <span class="comment">// <span class="doctag">TODO:</span> mark the executor as failed only if there were lots of fetch failures on it</span></span><br><span class="line">          <span class="keyword">if</span> (bmAddress != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">val</span> hostToUnregisterOutputs = <span class="keyword">if</span> (env.blockManager.externalShuffleServiceEnabled &amp;&amp;</span><br><span class="line">              unRegisterOutputOnHostOnFetchFailure) &#123;</span><br><span class="line">              <span class="comment">// We had a fetch failure with the external shuffle service, so we</span></span><br><span class="line">              <span class="comment">// assume all shuffle data on the node is bad.</span></span><br><span class="line">              <span class="type">Some</span>(bmAddress.host)</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">              <span class="comment">// Unregister shuffle data just for one executor (we don&#x27;t have any</span></span><br><span class="line">              <span class="comment">// reason to believe shuffle data has been lost for the entire host).</span></span><br><span class="line">              <span class="type">None</span></span><br><span class="line">            &#125;</span><br><span class="line">            removeExecutorAndUnregisterOutputs(</span><br><span class="line">              execId = bmAddress.executorId,</span><br><span class="line">              fileLost = <span class="literal">true</span>,</span><br><span class="line">              hostToUnregisterOutputs = hostToUnregisterOutputs,</span><br><span class="line">              maybeEpoch = <span class="type">Some</span>(task.epoch))</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">case</span> commitDenied: <span class="type">TaskCommitDenied</span> =&gt;</span><br><span class="line">        <span class="comment">// Do nothing here, left up to the TaskScheduler to decide how to handle denied commits</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">case</span> exceptionFailure: <span class="type">ExceptionFailure</span> =&gt;</span><br><span class="line">        <span class="comment">// Nothing left to do, already handled above for accumulator updates.</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">case</span> <span class="type">TaskResultLost</span> =&gt;</span><br><span class="line">        <span class="comment">// Do nothing here; the TaskScheduler handles these failures and resubmits the task.</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">case</span> _: <span class="type">ExecutorLostFailure</span> | _: <span class="type">TaskKilled</span> | <span class="type">UnknownReason</span> =&gt;</span><br><span class="line">        <span class="comment">// Unrecognized failure - also do nothing. If the task fails repeatedly, the TaskScheduler</span></span><br><span class="line">        <span class="comment">// will abort the job.</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="function"><span class="keyword">def</span> <span class="title">postTaskEnd</span></span>(event: <span class="type">CompletionEvent</span>): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="keyword">val</span> taskMetrics: <span class="type">TaskMetrics</span> =</span><br><span class="line">      <span class="keyword">if</span> (event.accumUpdates.nonEmpty) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">          <span class="type">TaskMetrics</span>.fromAccumulators(event.accumUpdates)</span><br><span class="line">        &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">          <span class="keyword">case</span> <span class="type">NonFatal</span>(e) =&gt;</span><br><span class="line">            <span class="keyword">val</span> taskId = event.taskInfo.taskId</span><br><span class="line">            logError(<span class="string">s&quot;Error when attempting to reconstruct metrics for task <span class="subst">$taskId</span>&quot;</span>, e)</span><br><span class="line">            <span class="literal">null</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="literal">null</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">    listenerBus.post(<span class="type">SparkListenerTaskEnd</span>(event.task.stageId, event.task.stageAttemptId,</span><br><span class="line">      <span class="type">Utils</span>.getFormattedClassName(event.task), event.reason, event.taskInfo, taskMetrics))</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
　　可以发现，<code>DAGScheduler</code>会将task的执行结果用case区分然后做不同的处理，最后主要是通过<code>postTaskEnd</code>去触发<code>SparkListenerTaskEnd</code>的，那么<code>CompletionEvent</code>又是在哪里触发的呢？通过注释上面提示，主要是由<code>taskEnded</code>这个方法触发的：
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">DAGScheduler</span>.scala</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Called by the TaskSetManager to report task completions or failures.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">taskEnded</span></span>(</span><br><span class="line">      task: <span class="type">Task</span>[_],</span><br><span class="line">      reason: <span class="type">TaskEndReason</span>,</span><br><span class="line">      result: <span class="type">Any</span>,</span><br><span class="line">      accumUpdates: <span class="type">Seq</span>[<span class="type">AccumulatorV2</span>[_, _]],</span><br><span class="line">      taskInfo: <span class="type">TaskInfo</span>): <span class="type">Unit</span> = &#123;</span><br><span class="line">    eventProcessLoop.post(</span><br><span class="line">      <span class="type">CompletionEvent</span>(task, reason, result, accumUpdates, taskInfo))</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
　　从上面我们也可发现<code>CompletionEvent</code>是包含<code>accumUpdates</code>的。</p>
<h1 id="tasksetmanager">TaskSetManager</h1>
<p>　　根据注释的提示，我们去查看<code>TaskSetManager</code>里的相关源码，它是用来执行taskset里的task的一个类：
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">TaskSetManager</span>.scala</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Schedules the tasks within a single TaskSet in the TaskSchedulerImpl. This class keeps track of</span></span><br><span class="line"><span class="comment"> * each task, retries tasks if they fail (up to a limited number of times), and</span></span><br><span class="line"><span class="comment"> * handles locality-aware scheduling for this TaskSet via delay scheduling. The main interfaces</span></span><br><span class="line"><span class="comment"> * to it are resourceOffer, which asks the TaskSet whether it wants to run a task on one node,</span></span><br><span class="line"><span class="comment"> * and statusUpdate, which tells it that one of its tasks changed state (e.g. finished).</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * THREADING: This class is designed to only be called from code with a lock on the</span></span><br><span class="line"><span class="comment"> * TaskScheduler (e.g. its event handlers). It should not be called from other threads.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @param sched           the TaskSchedulerImpl associated with the TaskSetManager</span></span><br><span class="line"><span class="comment"> * @param taskSet         the TaskSet to manage scheduling for</span></span><br><span class="line"><span class="comment"> * @param maxTaskFailures if any particular task fails this number of times, the entire</span></span><br><span class="line"><span class="comment"> *                        task set will be aborted</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span>[spark] <span class="class"><span class="keyword">class</span> <span class="title">TaskSetManager</span>(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="class">    sched: <span class="type">TaskSchedulerImpl</span>,</span></span></span><br><span class="line"><span class="params"><span class="class">    val taskSet: <span class="type">TaskSet</span>,</span></span></span><br><span class="line"><span class="params"><span class="class">    val maxTaskFailures: <span class="type">Int</span>,</span></span></span><br><span class="line"><span class="params"><span class="class">    blacklistTracker: <span class="type">Option</span>[<span class="type">BlacklistTracker</span>] = <span class="type">None</span>,</span></span></span><br><span class="line"><span class="params"><span class="class">    clock: <span class="type">Clock</span> = new <span class="type">SystemClock</span>(</span>)) <span class="keyword">extends</span> <span class="title">Schedulable</span> <span class="keyword">with</span> <span class="title">Logging</span></span></span><br></pre></td></tr></table></figure>
　　我们来查看与task相关的方法，果不其然，分为了两种方法，一种处理成功的task，一种处理失败的task。</p>
<h2 id="handlesuccessfultask">handleSuccessfulTask</h2>
<p>　　<code>handleSuccessfulTask</code>用来处理成功执行的task。</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">TaskSetManager</span>.scala</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Marks a task as successful and notifies the DAGScheduler that the task has ended.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">handleSuccessfulTask</span></span>(tid: <span class="type">Long</span>, result: <span class="type">DirectTaskResult</span>[_]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="keyword">val</span> info = taskInfos(tid)</span><br><span class="line">    <span class="keyword">val</span> index = info.index</span><br><span class="line">    info.markFinished(<span class="type">TaskState</span>.<span class="type">FINISHED</span>, clock.getTimeMillis())</span><br><span class="line">    <span class="keyword">if</span> (speculationEnabled) &#123;</span><br><span class="line">      successfulTaskDurations.insert(info.duration)</span><br><span class="line">    &#125;</span><br><span class="line">    removeRunningTask(tid)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Kill any other attempts for the same task (since those are unnecessary now that one</span></span><br><span class="line">    <span class="comment">// attempt completed successfully).</span></span><br><span class="line">    <span class="keyword">for</span> (attemptInfo &lt;- taskAttempts(index) <span class="keyword">if</span> attemptInfo.running) &#123;</span><br><span class="line">      logInfo(<span class="string">s&quot;Killing attempt <span class="subst">$&#123;attemptInfo.attemptNumber&#125;</span> for task <span class="subst">$&#123;attemptInfo.id&#125;</span> &quot;</span> +</span><br><span class="line">        <span class="string">s&quot;in stage <span class="subst">$&#123;taskSet.id&#125;</span> (TID <span class="subst">$&#123;attemptInfo.taskId&#125;</span>) on <span class="subst">$&#123;attemptInfo.host&#125;</span> &quot;</span> +</span><br><span class="line">        <span class="string">s&quot;as the attempt <span class="subst">$&#123;info.attemptNumber&#125;</span> succeeded on <span class="subst">$&#123;info.host&#125;</span>&quot;</span>)</span><br><span class="line">      killedByOtherAttempt(index) = <span class="literal">true</span></span><br><span class="line">      sched.backend.killTask(</span><br><span class="line">        attemptInfo.taskId,</span><br><span class="line">        attemptInfo.executorId,</span><br><span class="line">        interruptThread = <span class="literal">true</span>,</span><br><span class="line">        reason = <span class="string">&quot;another attempt succeeded&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!successful(index)) &#123;</span><br><span class="line">      tasksSuccessful += <span class="number">1</span></span><br><span class="line">      logInfo(<span class="string">s&quot;Finished task <span class="subst">$&#123;info.id&#125;</span> in stage <span class="subst">$&#123;taskSet.id&#125;</span> (TID <span class="subst">$&#123;info.taskId&#125;</span>) in&quot;</span> +</span><br><span class="line">        <span class="string">s&quot; <span class="subst">$&#123;info.duration&#125;</span> ms on <span class="subst">$&#123;info.host&#125;</span> (executor <span class="subst">$&#123;info.executorId&#125;</span>)&quot;</span> +</span><br><span class="line">        <span class="string">s&quot; (<span class="subst">$tasksSuccessful</span>/<span class="subst">$numTasks</span>)&quot;</span>)</span><br><span class="line">      <span class="comment">// Mark successful and stop if all the tasks have succeeded.</span></span><br><span class="line">      successful(index) = <span class="literal">true</span></span><br><span class="line">      <span class="keyword">if</span> (tasksSuccessful == numTasks) &#123;</span><br><span class="line">        isZombie = <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      logInfo(<span class="string">&quot;Ignoring task-finished event for &quot;</span> + info.id + <span class="string">&quot; in stage &quot;</span> + taskSet.id +</span><br><span class="line">        <span class="string">&quot; because task &quot;</span> + index + <span class="string">&quot; has already completed successfully&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// There may be multiple tasksets for this stage -- we let all of them know that the partition</span></span><br><span class="line">    <span class="comment">// was completed.  This may result in some of the tasksets getting completed.</span></span><br><span class="line">    sched.markPartitionCompletedInAllTaskSets(stageId, tasks(index).partitionId, info)</span><br><span class="line">    <span class="comment">// This method is called by &quot;TaskSchedulerImpl.handleSuccessfulTask&quot; which holds the</span></span><br><span class="line">    <span class="comment">// &quot;TaskSchedulerImpl&quot; lock until exiting. To avoid the SPARK-7655 issue, we should not</span></span><br><span class="line">    <span class="comment">// &quot;deserialize&quot; the value when holding a lock to avoid blocking other threads. So we call</span></span><br><span class="line">    <span class="comment">// &quot;result.value()&quot; in &quot;TaskResultGetter.enqueueSuccessfulTask&quot; before reaching here.</span></span><br><span class="line">    <span class="comment">// Note: &quot;result.value()&quot; only deserializes the value when it&#x27;s called at the first time, so</span></span><br><span class="line">    <span class="comment">// here &quot;result.value()&quot; just returns the value and won&#x27;t block other threads.</span></span><br><span class="line">    sched.dagScheduler.taskEnded(tasks(index), <span class="type">Success</span>, result.value(), result.accumUpdates, info)</span><br><span class="line">    maybeFinishTaskSet()</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>　　注意观察最后返回给<code>taskEnded</code>里的<code>accumUpdates</code>是<code>result.accumUpdates</code>。</p>
<h2 id="handlefailedtask">handleFailedTask</h2>
<p>　　<code>handleFailedTask</code>用来处理失败的task。</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">TaskSetManager</span>.scala</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Marks the task as failed, re-adds it to the list of pending tasks, and notifies the</span></span><br><span class="line"><span class="comment">   * DAG Scheduler.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">handleFailedTask</span></span>(tid: <span class="type">Long</span>, state: <span class="type">TaskState</span>, reason: <span class="type">TaskFailedReason</span>) &#123;</span><br><span class="line">    <span class="keyword">val</span> info = taskInfos(tid)</span><br><span class="line">    <span class="keyword">if</span> (info.failed || info.killed) &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    removeRunningTask(tid)</span><br><span class="line">    info.markFinished(state, clock.getTimeMillis())</span><br><span class="line">    <span class="keyword">val</span> index = info.index</span><br><span class="line">    copiesRunning(index) -= <span class="number">1</span></span><br><span class="line">    <span class="keyword">var</span> accumUpdates: <span class="type">Seq</span>[<span class="type">AccumulatorV2</span>[_, _]] = <span class="type">Seq</span>.empty</span><br><span class="line">    <span class="keyword">val</span> failureReason = <span class="string">s&quot;Lost task <span class="subst">$&#123;info.id&#125;</span> in stage <span class="subst">$&#123;taskSet.id&#125;</span> (TID <span class="subst">$tid</span>, <span class="subst">$&#123;info.host&#125;</span>,&quot;</span> +</span><br><span class="line">      <span class="string">s&quot; executor <span class="subst">$&#123;info.executorId&#125;</span>): <span class="subst">$&#123;reason.toErrorString&#125;</span>&quot;</span></span><br><span class="line">    <span class="keyword">val</span> failureException: <span class="type">Option</span>[<span class="type">Throwable</span>] = reason <span class="keyword">match</span> &#123;</span><br><span class="line">      <span class="keyword">case</span> fetchFailed: <span class="type">FetchFailed</span> =&gt;</span><br><span class="line">        logWarning(failureReason)</span><br><span class="line">        <span class="keyword">if</span> (!successful(index)) &#123;</span><br><span class="line">          successful(index) = <span class="literal">true</span></span><br><span class="line">          tasksSuccessful += <span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">        isZombie = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (fetchFailed.bmAddress != <span class="literal">null</span>) &#123;</span><br><span class="line">          blacklistTracker.foreach(_.updateBlacklistForFetchFailure(</span><br><span class="line">            fetchFailed.bmAddress.host, fetchFailed.bmAddress.executorId))</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">None</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">case</span> ef: <span class="type">ExceptionFailure</span> =&gt;</span><br><span class="line">        <span class="comment">// ExceptionFailure&#x27;s might have accumulator updates</span></span><br><span class="line">        accumUpdates = ef.accums</span><br><span class="line">        <span class="keyword">if</span> (ef.className == classOf[<span class="type">NotSerializableException</span>].getName) &#123;</span><br><span class="line">          <span class="comment">// If the task result wasn&#x27;t serializable, there&#x27;s no point in trying to re-execute it.</span></span><br><span class="line">          logError(<span class="string">&quot;Task %s in stage %s (TID %d) had a not serializable result: %s; not retrying&quot;</span></span><br><span class="line">            .format(info.id, taskSet.id, tid, ef.description))</span><br><span class="line">          abort(<span class="string">&quot;Task %s in stage %s (TID %d) had a not serializable result: %s&quot;</span>.format(</span><br><span class="line">            info.id, taskSet.id, tid, ef.description))</span><br><span class="line">          <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">val</span> key = ef.description</span><br><span class="line">        <span class="keyword">val</span> now = clock.getTimeMillis()</span><br><span class="line">        <span class="keyword">val</span> (printFull, dupCount) = &#123;</span><br><span class="line">          <span class="keyword">if</span> (recentExceptions.contains(key)) &#123;</span><br><span class="line">            <span class="keyword">val</span> (dupCount, printTime) = recentExceptions(key)</span><br><span class="line">            <span class="keyword">if</span> (now - printTime &gt; <span class="type">EXCEPTION_PRINT_INTERVAL</span>) &#123;</span><br><span class="line">              recentExceptions(key) = (<span class="number">0</span>, now)</span><br><span class="line">              (<span class="literal">true</span>, <span class="number">0</span>)</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">              recentExceptions(key) = (dupCount + <span class="number">1</span>, printTime)</span><br><span class="line">              (<span class="literal">false</span>, dupCount + <span class="number">1</span>)</span><br><span class="line">            &#125;</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            recentExceptions(key) = (<span class="number">0</span>, now)</span><br><span class="line">            (<span class="literal">true</span>, <span class="number">0</span>)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (printFull) &#123;</span><br><span class="line">          logWarning(failureReason)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          logInfo(</span><br><span class="line">            <span class="string">s&quot;Lost task <span class="subst">$&#123;info.id&#125;</span> in stage <span class="subst">$&#123;taskSet.id&#125;</span> (TID <span class="subst">$tid</span>) on <span class="subst">$&#123;info.host&#125;</span>, executor&quot;</span> +</span><br><span class="line">              <span class="string">s&quot; <span class="subst">$&#123;info.executorId&#125;</span>: <span class="subst">$&#123;ef.className&#125;</span> (<span class="subst">$&#123;ef.description&#125;</span>) [duplicate <span class="subst">$dupCount</span>]&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        ef.exception</span><br><span class="line"></span><br><span class="line">      <span class="keyword">case</span> e: <span class="type">ExecutorLostFailure</span> <span class="keyword">if</span> !e.exitCausedByApp =&gt;</span><br><span class="line">        logInfo(<span class="string">s&quot;Task <span class="subst">$tid</span> failed because while it was being computed, its executor &quot;</span> +</span><br><span class="line">          <span class="string">&quot;exited for a reason unrelated to the task. Not counting this failure towards the &quot;</span> +</span><br><span class="line">          <span class="string">&quot;maximum number of failures for the task.&quot;</span>)</span><br><span class="line">        <span class="type">None</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">case</span> e: <span class="type">TaskFailedReason</span> =&gt;  <span class="comment">// TaskResultLost, TaskKilled, and others</span></span><br><span class="line">        logWarning(failureReason)</span><br><span class="line">        <span class="type">None</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    sched.dagScheduler.taskEnded(tasks(index), reason, <span class="literal">null</span>, accumUpdates, info)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!isZombie &amp;&amp; reason.countTowardsTaskFailures) &#123;</span><br><span class="line">      assert (<span class="literal">null</span> != failureReason)</span><br><span class="line">      taskSetBlacklistHelperOpt.foreach(_.updateBlacklistForFailedTask(</span><br><span class="line">        info.host, info.executorId, index, failureReason))</span><br><span class="line">      numFailures(index) += <span class="number">1</span></span><br><span class="line">      <span class="keyword">if</span> (numFailures(index) &gt;= maxTaskFailures) &#123;</span><br><span class="line">        logError(<span class="string">&quot;Task %d in stage %s failed %d times; aborting job&quot;</span>.format(</span><br><span class="line">          index, taskSet.id, maxTaskFailures))</span><br><span class="line">        abort(<span class="string">&quot;Task %d in stage %s failed %d times, most recent failure: %s\nDriver stacktrace:&quot;</span></span><br><span class="line">          .format(index, taskSet.id, maxTaskFailures, failureReason), failureException)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (successful(index)) &#123;</span><br><span class="line">      logInfo(<span class="string">s&quot;Task <span class="subst">$&#123;info.id&#125;</span> in stage <span class="subst">$&#123;taskSet.id&#125;</span> (TID <span class="subst">$tid</span>) failed, but the task will not&quot;</span> +</span><br><span class="line">        <span class="string">s&quot; be re-executed (either because the task failed with a shuffle data fetch failure,&quot;</span> +</span><br><span class="line">        <span class="string">s&quot; so the previous stage needs to be re-run, or because a different copy of the task&quot;</span> +</span><br><span class="line">        <span class="string">s&quot; has already succeeded).&quot;</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      addPendingTask(index)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    maybeFinishTaskSet()</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>　　
我们可以看出<code>handleFailedTask</code>的传参和<code>handleSuccessfulTask</code>是不同的，并且最后传给<code>taksEnded</code>的<code>accumUpdates</code>也是不同的，不是通过<code>result</code>，而是自己定义的<code>var accumUpdates: Seq[AccumulatorV2[_, _]] = Seq.empty</code>，然后根据多个case来给它填充值，只有<code>ExceptionFailure</code>这种情况是有值的，我们之前的task是<code>ExecutorLostFailuer</code>，所以理所当然的没有那些metrics，这下终于就可以解释的通了。<br>
　　
而且按照代码的逻辑，因为<code>ExceptionFailure</code>而fail的task是有metric的，我们去ui里看一下，截图，与引言里的截图相对应。</p>
<p><img src="/blog/2018/10/14/Spark%E9%87%8C%E6%9C%89%E5%85%B3History-Server%E7%9A%84scheduler-delay%E7%9B%B8%E5%85%B3%E6%BA%90%E7%A0%81%E7%9A%84%E4%B8%80%E6%AC%A1%E8%B0%83%E7%A0%94/4.png"> <img src="/blog/2018/10/14/Spark%E9%87%8C%E6%9C%89%E5%85%B3History-Server%E7%9A%84scheduler-delay%E7%9B%B8%E5%85%B3%E6%BA%90%E7%A0%81%E7%9A%84%E4%B8%80%E6%AC%A1%E8%B0%83%E7%A0%94/5.png"> <img src="/blog/2018/10/14/Spark%E9%87%8C%E6%9C%89%E5%85%B3History-Server%E7%9A%84scheduler-delay%E7%9B%B8%E5%85%B3%E6%BA%90%E7%A0%81%E7%9A%84%E4%B8%80%E6%AC%A1%E8%B0%83%E7%A0%94/6.png"></p>
<p>　　我们找了一个因为<code>SparkException</code>fail的task，的确有gcTime的metric，那么就可以解释的通了。</p>
<h1 id="executor">Executor</h1>
<p>　　你肯定会好奇，为啥之前<code>handleSuccessfulTask</code>和<code>handleFailedTask</code>不同，<code>handleFailedTask</code>似乎从传参开始就丢掉了task的部分信息，我们继续向底层挖掘，到执行task的每个Executor上的代码看看，它们主要在<code>Executor.scala</code>里：
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Executor</span>.scala</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Spark executor, backed by a threadpool to run tasks.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * This can be used with Mesos, YARN, and the standalone scheduler.</span></span><br><span class="line"><span class="comment"> * An internal RPC interface is used for communication with the driver,</span></span><br><span class="line"><span class="comment"> * except in the case of Mesos fine-grained mode.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span>[spark] <span class="class"><span class="keyword">class</span> <span class="title">Executor</span>(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="class">    executorId: <span class="type">String</span>,</span></span></span><br><span class="line"><span class="params"><span class="class">    executorHostname: <span class="type">String</span>,</span></span></span><br><span class="line"><span class="params"><span class="class">    env: <span class="type">SparkEnv</span>,</span></span></span><br><span class="line"><span class="params"><span class="class">    userClassPath: <span class="type">Seq</span>[<span class="type">URL</span>] = <span class="type">Nil</span>,</span></span></span><br><span class="line"><span class="params"><span class="class">    isLocal: <span class="type">Boolean</span> = false,</span></span></span><br><span class="line"><span class="params"><span class="class">    uncaughtExceptionHandler: <span class="type">UncaughtExceptionHandler</span> = new <span class="type">SparkUncaughtExceptionHandler</span></span>)</span></span><br><span class="line">  <span class="keyword">extends</span> <span class="type">Logging</span></span><br></pre></td></tr></table></figure> 　　它主要集中在<code>run</code>方法中： <figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">run</span></span>(): <span class="type">Unit</span> = &#123;</span><br><span class="line">    threadId = <span class="type">Thread</span>.currentThread.getId</span><br><span class="line">    <span class="type">Thread</span>.currentThread.setName(threadName)</span><br><span class="line">    <span class="keyword">val</span> threadMXBean = <span class="type">ManagementFactory</span>.getThreadMXBean</span><br><span class="line">    <span class="keyword">val</span> taskMemoryManager = <span class="keyword">new</span> <span class="type">TaskMemoryManager</span>(env.memoryManager, taskId)</span><br><span class="line">    <span class="keyword">val</span> deserializeStartTime = <span class="type">System</span>.currentTimeMillis()</span><br><span class="line">    <span class="keyword">val</span> deserializeStartCpuTime = <span class="keyword">if</span> (threadMXBean.isCurrentThreadCpuTimeSupported) &#123;</span><br><span class="line">      threadMXBean.getCurrentThreadCpuTime</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="number">0</span>L</span><br><span class="line">    <span class="type">Thread</span>.currentThread.setContextClassLoader(replClassLoader)</span><br><span class="line">    <span class="keyword">val</span> ser = env.closureSerializer.newInstance()</span><br><span class="line">    logInfo(<span class="string">s&quot;Running <span class="subst">$taskName</span> (TID <span class="subst">$taskId</span>)&quot;</span>)</span><br><span class="line">    execBackend.statusUpdate(taskId, <span class="type">TaskState</span>.<span class="type">RUNNING</span>, <span class="type">EMPTY_BYTE_BUFFER</span>)</span><br><span class="line">    <span class="keyword">var</span> taskStart: <span class="type">Long</span> = <span class="number">0</span></span><br><span class="line">    <span class="keyword">var</span> taskStartCpu: <span class="type">Long</span> = <span class="number">0</span></span><br><span class="line">    startGCTime = computeTotalGcTime()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="comment">// Must be set before updateDependencies() is called, in case fetching dependencies</span></span><br><span class="line">      <span class="comment">// requires access to properties contained within (e.g. for access control).</span></span><br><span class="line">      <span class="type">Executor</span>.taskDeserializationProps.set(taskDescription.properties)</span><br><span class="line"></span><br><span class="line">      updateDependencies(taskDescription.addedFiles, taskDescription.addedJars)</span><br><span class="line">      task = ser.deserialize[<span class="type">Task</span>[<span class="type">Any</span>]](</span><br><span class="line">        taskDescription.serializedTask, <span class="type">Thread</span>.currentThread.getContextClassLoader)</span><br><span class="line">      task.localProperties = taskDescription.properties</span><br><span class="line">      task.setTaskMemoryManager(taskMemoryManager)</span><br><span class="line"></span><br><span class="line">      <span class="comment">// If this task has been killed before we deserialized it, let&#x27;s quit now. Otherwise,</span></span><br><span class="line">      <span class="comment">// continue executing the task.</span></span><br><span class="line">      <span class="keyword">val</span> killReason = reasonIfKilled</span><br><span class="line">      <span class="keyword">if</span> (killReason.isDefined) &#123;</span><br><span class="line">        <span class="comment">// Throw an exception rather than returning, because returning within a try&#123;&#125; block</span></span><br><span class="line">        <span class="comment">// causes a NonLocalReturnControl exception to be thrown. The NonLocalReturnControl</span></span><br><span class="line">        <span class="comment">// exception will be caught by the catch block, leading to an incorrect ExceptionFailure</span></span><br><span class="line">        <span class="comment">// for the task.</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="type">TaskKilledException</span>(killReason.get)</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// The purpose of updating the epoch here is to invalidate executor map output status cache</span></span><br><span class="line">      <span class="comment">// in case FetchFailures have occurred. In local mode `env.mapOutputTracker` will be</span></span><br><span class="line">      <span class="comment">// MapOutputTrackerMaster and its cache invalidation is not based on epoch numbers so</span></span><br><span class="line">      <span class="comment">// we don&#x27;t need to make any special calls here.</span></span><br><span class="line">      <span class="keyword">if</span> (!isLocal) &#123;</span><br><span class="line">        logDebug(<span class="string">&quot;Task &quot;</span> + taskId + <span class="string">&quot;&#x27;s epoch is &quot;</span> + task.epoch)</span><br><span class="line">        env.mapOutputTracker.asInstanceOf[<span class="type">MapOutputTrackerWorker</span>].updateEpoch(task.epoch)</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Run the actual task and measure its runtime.</span></span><br><span class="line">      taskStart = <span class="type">System</span>.currentTimeMillis()</span><br><span class="line">      taskStartCpu = <span class="keyword">if</span> (threadMXBean.isCurrentThreadCpuTimeSupported) &#123;</span><br><span class="line">        threadMXBean.getCurrentThreadCpuTime</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="number">0</span>L</span><br><span class="line">      <span class="keyword">var</span> threwException = <span class="literal">true</span></span><br><span class="line">      <span class="keyword">val</span> value = <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">val</span> res = task.run(</span><br><span class="line">          taskAttemptId = taskId,</span><br><span class="line">          attemptNumber = taskDescription.attemptNumber,</span><br><span class="line">          metricsSystem = env.metricsSystem)</span><br><span class="line">        threwException = <span class="literal">false</span></span><br><span class="line">        res</span><br><span class="line">      &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">val</span> releasedLocks = env.blockManager.releaseAllLocksForTask(taskId)</span><br><span class="line">        <span class="keyword">val</span> freedMemory = taskMemoryManager.cleanUpAllAllocatedMemory()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (freedMemory &gt; <span class="number">0</span> &amp;&amp; !threwException) &#123;</span><br><span class="line">          <span class="keyword">val</span> errMsg = <span class="string">s&quot;Managed memory leak detected; size = <span class="subst">$freedMemory</span> bytes, TID = <span class="subst">$taskId</span>&quot;</span></span><br><span class="line">          <span class="keyword">if</span> (conf.getBoolean(<span class="string">&quot;spark.unsafe.exceptionOnMemoryLeak&quot;</span>, <span class="literal">false</span>)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="type">SparkException</span>(errMsg)</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            logWarning(errMsg)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (releasedLocks.nonEmpty &amp;&amp; !threwException) &#123;</span><br><span class="line">          <span class="keyword">val</span> errMsg =</span><br><span class="line">            <span class="string">s&quot;<span class="subst">$&#123;releasedLocks.size&#125;</span> block locks were not released by TID = <span class="subst">$taskId</span>:\n&quot;</span> +</span><br><span class="line">              releasedLocks.mkString(<span class="string">&quot;[&quot;</span>, <span class="string">&quot;, &quot;</span>, <span class="string">&quot;]&quot;</span>)</span><br><span class="line">          <span class="keyword">if</span> (conf.getBoolean(<span class="string">&quot;spark.storage.exceptionOnPinLeak&quot;</span>, <span class="literal">false</span>)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="type">SparkException</span>(errMsg)</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            logInfo(errMsg)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      task.context.fetchFailed.foreach &#123; fetchFailure =&gt;</span><br><span class="line">        <span class="comment">// uh-oh.  it appears the user code has caught the fetch-failure without throwing any</span></span><br><span class="line">        <span class="comment">// other exceptions.  Its *possible* this is what the user meant to do (though highly</span></span><br><span class="line">        <span class="comment">// unlikely).  So we will log an error and keep going.</span></span><br><span class="line">        logError(<span class="string">s&quot;TID <span class="subst">$&#123;taskId&#125;</span> completed successfully though internally it encountered &quot;</span> +</span><br><span class="line">          <span class="string">s&quot;unrecoverable fetch failures!  Most likely this means user code is incorrectly &quot;</span> +</span><br><span class="line">          <span class="string">s&quot;swallowing Spark&#x27;s internal <span class="subst">$&#123;classOf[FetchFailedException]&#125;</span>&quot;</span>, fetchFailure)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">val</span> taskFinish = <span class="type">System</span>.currentTimeMillis()</span><br><span class="line">      <span class="keyword">val</span> taskFinishCpu = <span class="keyword">if</span> (threadMXBean.isCurrentThreadCpuTimeSupported) &#123;</span><br><span class="line">        threadMXBean.getCurrentThreadCpuTime</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="number">0</span>L</span><br><span class="line"></span><br><span class="line">      <span class="comment">// If the task has been killed, let&#x27;s fail it.</span></span><br><span class="line">      task.context.killTaskIfInterrupted()</span><br><span class="line"></span><br><span class="line">      <span class="keyword">val</span> resultSer = env.serializer.newInstance()</span><br><span class="line">      <span class="keyword">val</span> beforeSerialization = <span class="type">System</span>.currentTimeMillis()</span><br><span class="line">      <span class="keyword">val</span> valueBytes = resultSer.serialize(value)</span><br><span class="line">      <span class="keyword">val</span> afterSerialization = <span class="type">System</span>.currentTimeMillis()</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Deserialization happens in two parts: first, we deserialize a Task object, which</span></span><br><span class="line">      <span class="comment">// includes the Partition. Second, Task.run() deserializes the RDD and function to be run.</span></span><br><span class="line">      task.metrics.setExecutorDeserializeTime(</span><br><span class="line">        (taskStart - deserializeStartTime) + task.executorDeserializeTime)</span><br><span class="line">      task.metrics.setExecutorDeserializeCpuTime(</span><br><span class="line">        (taskStartCpu - deserializeStartCpuTime) + task.executorDeserializeCpuTime)</span><br><span class="line">      <span class="comment">// We need to subtract Task.run()&#x27;s deserialization time to avoid double-counting</span></span><br><span class="line">      task.metrics.setExecutorRunTime((taskFinish - taskStart) - task.executorDeserializeTime)</span><br><span class="line">      task.metrics.setExecutorCpuTime(</span><br><span class="line">        (taskFinishCpu - taskStartCpu) - task.executorDeserializeCpuTime)</span><br><span class="line">      task.metrics.setJvmGCTime(computeTotalGcTime() - startGCTime)</span><br><span class="line">      task.metrics.setResultSerializationTime(afterSerialization - beforeSerialization)</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Expose task metrics using the Dropwizard metrics system.</span></span><br><span class="line">      <span class="comment">// Update task metrics counters</span></span><br><span class="line">      executorSource.<span class="type">METRIC_CPU_TIME</span>.inc(task.metrics.executorCpuTime)</span><br><span class="line">      executorSource.<span class="type">METRIC_RUN_TIME</span>.inc(task.metrics.executorRunTime)</span><br><span class="line">      executorSource.<span class="type">METRIC_JVM_GC_TIME</span>.inc(task.metrics.jvmGCTime)</span><br><span class="line">      executorSource.<span class="type">METRIC_DESERIALIZE_TIME</span>.inc(task.metrics.executorDeserializeTime)</span><br><span class="line">      executorSource.<span class="type">METRIC_DESERIALIZE_CPU_TIME</span>.inc(task.metrics.executorDeserializeCpuTime)</span><br><span class="line">      executorSource.<span class="type">METRIC_RESULT_SERIALIZE_TIME</span>.inc(task.metrics.resultSerializationTime)</span><br><span class="line">      executorSource.<span class="type">METRIC_SHUFFLE_FETCH_WAIT_TIME</span></span><br><span class="line">        .inc(task.metrics.shuffleReadMetrics.fetchWaitTime)</span><br><span class="line">      executorSource.<span class="type">METRIC_SHUFFLE_WRITE_TIME</span>.inc(task.metrics.shuffleWriteMetrics.writeTime)</span><br><span class="line">      executorSource.<span class="type">METRIC_SHUFFLE_TOTAL_BYTES_READ</span></span><br><span class="line">        .inc(task.metrics.shuffleReadMetrics.totalBytesRead)</span><br><span class="line">      executorSource.<span class="type">METRIC_SHUFFLE_REMOTE_BYTES_READ</span></span><br><span class="line">        .inc(task.metrics.shuffleReadMetrics.remoteBytesRead)</span><br><span class="line">      executorSource.<span class="type">METRIC_SHUFFLE_REMOTE_BYTES_READ_TO_DISK</span></span><br><span class="line">        .inc(task.metrics.shuffleReadMetrics.remoteBytesReadToDisk)</span><br><span class="line">      executorSource.<span class="type">METRIC_SHUFFLE_LOCAL_BYTES_READ</span></span><br><span class="line">        .inc(task.metrics.shuffleReadMetrics.localBytesRead)</span><br><span class="line">      executorSource.<span class="type">METRIC_SHUFFLE_RECORDS_READ</span></span><br><span class="line">        .inc(task.metrics.shuffleReadMetrics.recordsRead)</span><br><span class="line">      executorSource.<span class="type">METRIC_SHUFFLE_REMOTE_BLOCKS_FETCHED</span></span><br><span class="line">        .inc(task.metrics.shuffleReadMetrics.remoteBlocksFetched)</span><br><span class="line">      executorSource.<span class="type">METRIC_SHUFFLE_LOCAL_BLOCKS_FETCHED</span></span><br><span class="line">        .inc(task.metrics.shuffleReadMetrics.localBlocksFetched)</span><br><span class="line">      executorSource.<span class="type">METRIC_SHUFFLE_BYTES_WRITTEN</span></span><br><span class="line">        .inc(task.metrics.shuffleWriteMetrics.bytesWritten)</span><br><span class="line">      executorSource.<span class="type">METRIC_SHUFFLE_RECORDS_WRITTEN</span></span><br><span class="line">        .inc(task.metrics.shuffleWriteMetrics.recordsWritten)</span><br><span class="line">      executorSource.<span class="type">METRIC_INPUT_BYTES_READ</span></span><br><span class="line">        .inc(task.metrics.inputMetrics.bytesRead)</span><br><span class="line">      executorSource.<span class="type">METRIC_INPUT_RECORDS_READ</span></span><br><span class="line">        .inc(task.metrics.inputMetrics.recordsRead)</span><br><span class="line">      executorSource.<span class="type">METRIC_OUTPUT_BYTES_WRITTEN</span></span><br><span class="line">        .inc(task.metrics.outputMetrics.bytesWritten)</span><br><span class="line">      executorSource.<span class="type">METRIC_OUTPUT_RECORDS_WRITTEN</span></span><br><span class="line">        .inc(task.metrics.outputMetrics.recordsWritten)</span><br><span class="line">      executorSource.<span class="type">METRIC_RESULT_SIZE</span>.inc(task.metrics.resultSize)</span><br><span class="line">      executorSource.<span class="type">METRIC_DISK_BYTES_SPILLED</span>.inc(task.metrics.diskBytesSpilled)</span><br><span class="line">      executorSource.<span class="type">METRIC_MEMORY_BYTES_SPILLED</span>.inc(task.metrics.memoryBytesSpilled)</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Note: accumulator updates must be collected after TaskMetrics is updated</span></span><br><span class="line">      <span class="keyword">val</span> accumUpdates = task.collectAccumulatorUpdates()</span><br><span class="line">      <span class="comment">// <span class="doctag">TODO:</span> do not serialize value twice</span></span><br><span class="line">      <span class="keyword">val</span> directResult = <span class="keyword">new</span> <span class="type">DirectTaskResult</span>(valueBytes, accumUpdates)</span><br><span class="line">      <span class="keyword">val</span> serializedDirectResult = ser.serialize(directResult)</span><br><span class="line">      <span class="keyword">val</span> resultSize = serializedDirectResult.limit()</span><br><span class="line"></span><br><span class="line">      <span class="comment">// directSend = sending directly back to the driver</span></span><br><span class="line">      <span class="keyword">val</span> serializedResult: <span class="type">ByteBuffer</span> = &#123;</span><br><span class="line">        <span class="keyword">if</span> (maxResultSize &gt; <span class="number">0</span> &amp;&amp; resultSize &gt; maxResultSize) &#123;</span><br><span class="line">          logWarning(<span class="string">s&quot;Finished <span class="subst">$taskName</span> (TID <span class="subst">$taskId</span>). Result is larger than maxResultSize &quot;</span> +</span><br><span class="line">            <span class="string">s&quot;(<span class="subst">$&#123;Utils.bytesToString(resultSize)&#125;</span> &gt; <span class="subst">$&#123;Utils.bytesToString(maxResultSize)&#125;</span>), &quot;</span> +</span><br><span class="line">            <span class="string">s&quot;dropping it.&quot;</span>)</span><br><span class="line">          ser.serialize(<span class="keyword">new</span> <span class="type">IndirectTaskResult</span>[<span class="type">Any</span>](<span class="type">TaskResultBlockId</span>(taskId), resultSize))</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (resultSize &gt; maxDirectResultSize) &#123;</span><br><span class="line">          <span class="keyword">val</span> blockId = <span class="type">TaskResultBlockId</span>(taskId)</span><br><span class="line">          env.blockManager.putBytes(</span><br><span class="line">            blockId,</span><br><span class="line">            <span class="keyword">new</span> <span class="type">ChunkedByteBuffer</span>(serializedDirectResult.duplicate()),</span><br><span class="line">            <span class="type">StorageLevel</span>.<span class="type">MEMORY_AND_DISK_SER</span>)</span><br><span class="line">          logInfo(</span><br><span class="line">            <span class="string">s&quot;Finished <span class="subst">$taskName</span> (TID <span class="subst">$taskId</span>). <span class="subst">$resultSize</span> bytes result sent via BlockManager)&quot;</span>)</span><br><span class="line">          ser.serialize(<span class="keyword">new</span> <span class="type">IndirectTaskResult</span>[<span class="type">Any</span>](blockId, resultSize))</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          logInfo(<span class="string">s&quot;Finished <span class="subst">$taskName</span> (TID <span class="subst">$taskId</span>). <span class="subst">$resultSize</span> bytes result sent to driver&quot;</span>)</span><br><span class="line">          serializedDirectResult</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      setTaskFinishedAndClearInterruptStatus()</span><br><span class="line">      execBackend.statusUpdate(taskId, <span class="type">TaskState</span>.<span class="type">FINISHED</span>, serializedResult)</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">      <span class="keyword">case</span> t: <span class="type">TaskKilledException</span> =&gt;</span><br><span class="line">        logInfo(<span class="string">s&quot;Executor killed <span class="subst">$taskName</span> (TID <span class="subst">$taskId</span>), reason: <span class="subst">$&#123;t.reason&#125;</span>&quot;</span>)</span><br><span class="line">        setTaskFinishedAndClearInterruptStatus()</span><br><span class="line">        execBackend.statusUpdate(taskId, <span class="type">TaskState</span>.<span class="type">KILLED</span>, ser.serialize(<span class="type">TaskKilled</span>(t.reason)))</span><br><span class="line"></span><br><span class="line">      <span class="keyword">case</span> _: <span class="type">InterruptedException</span> | <span class="type">NonFatal</span>(_) <span class="keyword">if</span></span><br><span class="line">          task != <span class="literal">null</span> &amp;&amp; task.reasonIfKilled.isDefined =&gt;</span><br><span class="line">        <span class="keyword">val</span> killReason = task.reasonIfKilled.getOrElse(<span class="string">&quot;unknown reason&quot;</span>)</span><br><span class="line">        logInfo(<span class="string">s&quot;Executor interrupted and killed <span class="subst">$taskName</span> (TID <span class="subst">$taskId</span>), reason: <span class="subst">$killReason</span>&quot;</span>)</span><br><span class="line">        setTaskFinishedAndClearInterruptStatus()</span><br><span class="line">        execBackend.statusUpdate(</span><br><span class="line">          taskId, <span class="type">TaskState</span>.<span class="type">KILLED</span>, ser.serialize(<span class="type">TaskKilled</span>(killReason)))</span><br><span class="line"></span><br><span class="line">      <span class="keyword">case</span> t: <span class="type">Throwable</span> <span class="keyword">if</span> hasFetchFailure &amp;&amp; !<span class="type">Utils</span>.isFatalError(t) =&gt;</span><br><span class="line">        <span class="keyword">val</span> reason = task.context.fetchFailed.get.toTaskFailedReason</span><br><span class="line">        <span class="keyword">if</span> (!t.isInstanceOf[<span class="type">FetchFailedException</span>]) &#123;</span><br><span class="line">          <span class="comment">// there was a fetch failure in the task, but some user code wrapped that exception</span></span><br><span class="line">          <span class="comment">// and threw something else.  Regardless, we treat it as a fetch failure.</span></span><br><span class="line">          <span class="keyword">val</span> fetchFailedCls = classOf[<span class="type">FetchFailedException</span>].getName</span><br><span class="line">          logWarning(<span class="string">s&quot;TID <span class="subst">$&#123;taskId&#125;</span> encountered a <span class="subst">$&#123;fetchFailedCls&#125;</span> and &quot;</span> +</span><br><span class="line">            <span class="string">s&quot;failed, but the <span class="subst">$&#123;fetchFailedCls&#125;</span> was hidden by another &quot;</span> +</span><br><span class="line">            <span class="string">s&quot;exception.  Spark is handling this like a fetch failure and ignoring the &quot;</span> +</span><br><span class="line">            <span class="string">s&quot;other exception: <span class="subst">$t</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        setTaskFinishedAndClearInterruptStatus()</span><br><span class="line">        execBackend.statusUpdate(taskId, <span class="type">TaskState</span>.<span class="type">FAILED</span>, ser.serialize(reason))</span><br><span class="line"></span><br><span class="line">      <span class="keyword">case</span> <span class="type">CausedBy</span>(cDE: <span class="type">CommitDeniedException</span>) =&gt;</span><br><span class="line">        <span class="keyword">val</span> reason = cDE.toTaskCommitDeniedReason</span><br><span class="line">        setTaskFinishedAndClearInterruptStatus()</span><br><span class="line">        execBackend.statusUpdate(taskId, <span class="type">TaskState</span>.<span class="type">KILLED</span>, ser.serialize(reason))</span><br><span class="line"></span><br><span class="line">      <span class="keyword">case</span> t: <span class="type">Throwable</span> =&gt;</span><br><span class="line">        <span class="comment">// Attempt to exit cleanly by informing the driver of our failure.</span></span><br><span class="line">        <span class="comment">// If anything goes wrong (or this was a fatal exception), we will delegate to</span></span><br><span class="line">        <span class="comment">// the default uncaught exception handler, which will terminate the Executor.</span></span><br><span class="line">        logError(<span class="string">s&quot;Exception in <span class="subst">$taskName</span> (TID <span class="subst">$taskId</span>)&quot;</span>, t)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// SPARK-20904: Do not report failure to driver if if happened during shut down. Because</span></span><br><span class="line">        <span class="comment">// libraries may set up shutdown hooks that race with running tasks during shutdown,</span></span><br><span class="line">        <span class="comment">// spurious failures may occur and can result in improper accounting in the driver (e.g.</span></span><br><span class="line">        <span class="comment">// the task failure would not be ignored if the shutdown happened because of premption,</span></span><br><span class="line">        <span class="comment">// instead of an app issue).</span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="type">ShutdownHookManager</span>.inShutdown()) &#123;</span><br><span class="line">          <span class="comment">// Collect latest accumulator values to report back to the driver</span></span><br><span class="line">          <span class="keyword">val</span> accums: <span class="type">Seq</span>[<span class="type">AccumulatorV2</span>[_, _]] =</span><br><span class="line">            <span class="keyword">if</span> (task != <span class="literal">null</span>) &#123;</span><br><span class="line">              task.metrics.setExecutorRunTime(<span class="type">System</span>.currentTimeMillis() - taskStart)</span><br><span class="line">              task.metrics.setJvmGCTime(computeTotalGcTime() - startGCTime)</span><br><span class="line">              task.collectAccumulatorUpdates(taskFailed = <span class="literal">true</span>)</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">              <span class="type">Seq</span>.empty</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">val</span> accUpdates = accums.map(acc =&gt; acc.toInfo(<span class="type">Some</span>(acc.value), <span class="type">None</span>))</span><br><span class="line"></span><br><span class="line">          <span class="keyword">val</span> serializedTaskEndReason = &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">              ser.serialize(<span class="keyword">new</span> <span class="type">ExceptionFailure</span>(t, accUpdates).withAccums(accums))</span><br><span class="line">            &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">              <span class="keyword">case</span> _: <span class="type">NotSerializableException</span> =&gt;</span><br><span class="line">                <span class="comment">// t is not serializable so just send the stacktrace</span></span><br><span class="line">                ser.serialize(<span class="keyword">new</span> <span class="type">ExceptionFailure</span>(t, accUpdates, <span class="literal">false</span>).withAccums(accums))</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">          setTaskFinishedAndClearInterruptStatus()</span><br><span class="line">          execBackend.statusUpdate(taskId, <span class="type">TaskState</span>.<span class="type">FAILED</span>, serializedTaskEndReason)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          logInfo(<span class="string">&quot;Not reporting error to driver during JVM shutdown.&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Don&#x27;t forcibly exit unless the exception was inherently fatal, to avoid</span></span><br><span class="line">        <span class="comment">// stopping other tasks unnecessarily.</span></span><br><span class="line">        <span class="keyword">if</span> (!t.isInstanceOf[<span class="type">SparkOutOfMemoryError</span>] &amp;&amp; <span class="type">Utils</span>.isFatalError(t)) &#123;</span><br><span class="line">          uncaughtExceptionHandler.uncaughtException(<span class="type">Thread</span>.currentThread(), t)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      runningTasks.remove(taskId)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="function"><span class="keyword">def</span> <span class="title">hasFetchFailure</span></span>: <span class="type">Boolean</span> = &#123;</span><br><span class="line">    task != <span class="literal">null</span> &amp;&amp; task.context != <span class="literal">null</span> &amp;&amp; task.context.fetchFailed.isDefined</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
　　我们可以看到，在这个方法里的catch里根据killed task或者failed
task的不同结果做了不同的处理，并且更新了State，killed
task的reason里是不包含<code>accumUpdates</code>的，只有failed
task里最后的一种处理情况<code>Throwable</code>里的<code>serializedTaskEndReason</code>是包含<code>accumUpdates</code>的。</p>
<h1 id="conclusion">Conclusion</h1>
<p>　　本文从History Server开始，通过阅读源码理解了为啥有的failed
task里scheduler delay等于duration的问题，它其实并不是真的scheduler
delay，通过阅读源码我也加深了对Spark的理解~</p>

      
    </div>
    
  </div>
  
    
    <div class="copyright">
        <p><span>本文标题:</span><a href="/blog/2018/10/14/Spark%E9%87%8C%E6%9C%89%E5%85%B3History-Server%E7%9A%84scheduler-delay%E7%9B%B8%E5%85%B3%E6%BA%90%E7%A0%81%E7%9A%84%E4%B8%80%E6%AC%A1%E8%B0%83%E7%A0%94/">Spark里有关History Server的scheduler delay相关源码的一次调研</a></p>
        <p><span>文章作者:</span><a href="/" title="回到主页"></a></p>
        <p><span>发布时间:</span>2018-10-14, 11:53:38</p>
        <p><span>最后更新:</span>2021-03-03, 21:31:06</p>
        <p>
            <span>原始链接:</span><a class="post-url" href="/blog/2018/10/14/Spark%E9%87%8C%E6%9C%89%E5%85%B3History-Server%E7%9A%84scheduler-delay%E7%9B%B8%E5%85%B3%E6%BA%90%E7%A0%81%E7%9A%84%E4%B8%80%E6%AC%A1%E8%B0%83%E7%A0%94/" title="Spark里有关History Server的scheduler delay相关源码的一次调研">http://chengfeng96.com/blog/2018/10/14/Spark%E9%87%8C%E6%9C%89%E5%85%B3History-Server%E7%9A%84scheduler-delay%E7%9B%B8%E5%85%B3%E6%BA%90%E7%A0%81%E7%9A%84%E4%B8%80%E6%AC%A1%E8%B0%83%E7%A0%94/</a>
            <span class="copy-path" data-clipboard-text="原文: http://chengfeng96.com/blog/2018/10/14/Spark%E9%87%8C%E6%9C%89%E5%85%B3History-Server%E7%9A%84scheduler-delay%E7%9B%B8%E5%85%B3%E6%BA%90%E7%A0%81%E7%9A%84%E4%B8%80%E6%AC%A1%E8%B0%83%E7%A0%94/　　作者: " title="点击复制文章链接"><i class="fa fa-clipboard"></i></span>
            <script> var clipboard = new Clipboard('.copy-path'); </script>
        </p>
        <p>
            <span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license noopener" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" title="CC BY-NC-SA 4.0 International" target = "_blank">"署名-非商用-相同方式共享 4.0"</a> 转载请保留原文链接及作者。
        </p>
    </div>



    <nav id="article-nav">
        
            <div id="article-nav-newer" class="article-nav-title">
                <a href="/blog/2018/10/15/%E6%B5%85%E8%B0%88%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8/">
                    Java 并发编程（一）- 浅谈线程安全
                </a>
            </div>
        
        
            <div id="article-nav-older" class="article-nav-title">
                <a href="/blog/2018/10/11/JVM%E4%B8%AD%E7%9A%84%E5%88%86%E6%B4%BE%E6%9C%BA%E5%88%B6/">
                    JVM 学习（十）- 分派机制
                </a>
            </div>
        
    </nav>

  
  
    
    <div style="padding: 0; margin: 20px auto; width: 90%; text-align: center;">
      <br>
      <div>坚持原创技术分享，您的支持将鼓励我继续创作，π（3.14）元就够啦！</div>
      <br>
      <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
        <div class="btn btn-pay">打赏支持</div>
      </button>
      <br>
      <br>
      <div id="QR" style="display: none;">
        
          <div id="wechat" style="display: inline-block;">
            <img id="wechat_qr" src="/img/wechat.jpg" alt=" WeChat Pay"/>
            <p>微信打赏</p>
          </div>
        
        
          <div id="alipay" style="display: inline-block">
            <img id="alipay_qr" src="/img/alipay.jpg" alt=" Alipay"/>
            <p>支付宝打赏</p>
          </div>
        
        <br>
        <br>
      </div>
    </div>

  
</article>

    <div id="toc" class="toc-article">
        <strong class="toc-title">文章目录</strong>
        
            <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%BC%95%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">引言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#task-state"><span class="toc-number">2.</span> <span class="toc-text">Task State</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#duration"><span class="toc-number">3.</span> <span class="toc-text">duration</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#scheduler-delay"><span class="toc-number">4.</span> <span class="toc-text">Scheduler delay</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#eventlog"><span class="toc-number">5.</span> <span class="toc-text">eventlog</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#accumulatbles"><span class="toc-number">5.1.</span> <span class="toc-text">Accumulatbles</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#taskmetrics"><span class="toc-number">5.2.</span> <span class="toc-text">TaskMetrics</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#sparklistenertaskend"><span class="toc-number">6.</span> <span class="toc-text">SparkListenerTaskEnd</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#appstatuslistener"><span class="toc-number">6.1.</span> <span class="toc-text">AppStatusListener</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#dagschuduler"><span class="toc-number">7.</span> <span class="toc-text">DAGSchuduler</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#tasksetmanager"><span class="toc-number">8.</span> <span class="toc-text">TaskSetManager</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#handlesuccessfultask"><span class="toc-number">8.1.</span> <span class="toc-text">handleSuccessfulTask</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#handlefailedtask"><span class="toc-number">8.2.</span> <span class="toc-text">handleFailedTask</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#executor"><span class="toc-number">9.</span> <span class="toc-text">Executor</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#conclusion"><span class="toc-number">10.</span> <span class="toc-text">Conclusion</span></a></li></ol>
        
    </div>
    <style>
        .left-col .switch-btn,
        .left-col .switch-area {
            display: none;
        }
        .toc-level-3 i,
        .toc-level-3 ol {
            display: none !important;
        }
    </style>

    <input type="button" id="tocButton" value="隐藏目录"  title="点击按钮隐藏或者显示文章目录">

    <script>
        yiliaConfig.toc = ["隐藏目录", "显示目录", !!"false"];
    </script>



    
<div class="share">
    
        <div class="bdsharebuttonbox">
            <a href="#" class="fa fa-twitter bds_twi" data-cmd="twi" title="分享到推特"></a>
            <a href="#" class="fa fa-weibo bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
            <a href="#" class="fa fa-qq bds_sqq" data-cmd="sqq" title="分享给 QQ 好友"></a>
            <a href="#" class="fa fa-files-o bds_copy" data-cmd="copy" title="复制网址"></a>
            <a href="#" class="fa fa fa-envelope-o bds_mail" data-cmd="mail" title="通过邮件分享"></a>
            <a href="#" class="fa fa-weixin bds_weixin" data-cmd="weixin" title="生成文章二维码"></a>
            <a href="#" class="fa fa-share-alt bds_more" data-cmd="more"></i></a>
        </div>
        <script>
            window._bd_share_config={
                "common":{"bdSnsKey":{},"bdText":"Spark里有关History Server的scheduler delay相关源码的一次调研　| 零一人生　","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"24"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
        </script>
    

    
</div>







    
        <section id="comments">
    <style> aside.comment-bar { margin: auto 30px; }</style>
    <div id="disqus_thread"></div>
    <script>
        var disqus_config = function(){
            this.page.url = 'http://chengfeng96.com/blog/2018/10/14/Spark%E9%87%8C%E6%9C%89%E5%85%B3History-Server%E7%9A%84scheduler-delay%E7%9B%B8%E5%85%B3%E6%BA%90%E7%A0%81%E7%9A%84%E4%B8%80%E6%AC%A1%E8%B0%83%E7%A0%94/';
            this.page.identifier = 'blog/2018/10/14/Spark里有关History-Server的scheduler-delay相关源码的一次调研/';
        };
        var loadComment = function(){
            var d = document, s = d.createElement('script');
            s.src = '//HelloHazzaCheng.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        }
    </script>
    
    <script> loadComment(); </script>

</section>


    




    <div class="scroll" id="post-nav-button">
        
            <a href="/blog/2018/10/15/%E6%B5%85%E8%B0%88%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8/" title="上一篇: Java 并发编程（一）- 浅谈线程安全">
                <i class="fa fa-angle-left"></i>
            </a>
        

        <a title="文章列表"><i class="fa fa-bars"></i><i class="fa fa-times"></i></a>

        
            <a href="/blog/2018/10/11/JVM%E4%B8%AD%E7%9A%84%E5%88%86%E6%B4%BE%E6%9C%BA%E5%88%B6/" title="下一篇: JVM 学习（十）- 分派机制">
                <i class="fa fa-angle-right"></i>
            </a>
        
    </div>

    <ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/blog/2021/11/21/NAS-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E4%BA%8C%E5%8D%81%EF%BC%89-PC-DARTS/">NAS 学习笔记（二十）- PC-DARTS</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2021/11/17/NAS-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E5%8D%81%E4%B9%9D%EF%BC%89-ProxylessNAS/">NAS 学习笔记（十九）- ProxylessNAS</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2021/04/06/NAS-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E5%8D%81%E5%85%AB%EF%BC%89-DARTS-PT/">NAS 学习笔记（十八）- DARTS+PT</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2020/12/04/NAS-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E5%8D%81%E4%B8%83%EF%BC%89-SNAS/">NAS 学习笔记（十七）- SNAS</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2020/11/09/NAS-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E5%8D%81%E5%85%AD%EF%BC%89-NoisyDARTS/">NAS 学习笔记（十六）- NoisyDARTS</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2020/11/06/NAS-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E5%8D%81%E4%BA%94%EF%BC%89-P-DARTS/">NAS 学习笔记（十五）- P-DARTS</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2020/07/27/NAS-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E5%8D%81%E5%9B%9B%EF%BC%89-GDBT-NAS/">NAS 学习笔记（十四）- GDBT-NAS</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2020/07/24/NAS-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E5%8D%81%E4%B8%89%EF%BC%89-NASP/">NAS 学习笔记（十三）- NASP</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2020/07/18/NAS-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E5%8D%81%E4%BA%8C%EF%BC%89-SemiNAS/">NAS 学习笔记（十二）- SemiNAS</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2020/07/16/NAS-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E5%8D%81%E4%B8%80%EF%BC%89-GreedyNAS/">NAS 学习笔记（十一）- GreedyNAS</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2020/07/13/NAS-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E5%8D%81%EF%BC%89-Fair-DARTS/">NAS 学习笔记（十）- Fair DARTS</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2020/07/11/NAS-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B9%9D%EF%BC%89-FairNAS/">NAS 学习笔记（九）- FairNAS</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2020/07/09/NAS-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E5%85%AB%EF%BC%89-SPOS/">NAS 学习笔记（八）- SPOS</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2020/06/23/NAS-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%83%EF%BC%89-NAO/">NAS 学习笔记（七）- NAO</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2020/06/16/XGBoost-%E5%92%8C-Lightgbm-%E7%AC%94%E8%AE%B0/">XGBoost 和 Lightgbm 笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2020/02/28/%E5%BC%BA%E5%8C%96%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E5%85%AB%EF%BC%89-%E8%BF%9E%E7%BB%AD%E7%A9%BA%E9%97%B4%E7%9A%84%E7%A1%AE%E5%AE%9A%E6%80%A7%E7%AD%96%E7%95%A5/">强化学习笔记（八）- 连续空间的确定性策略</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2020/02/24/%E5%BC%BA%E5%8C%96%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%83%EF%BC%89-%E8%B5%84%E6%A0%BC%E8%BF%B9/">强化学习笔记（七）- 资格迹</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2020/02/21/%E5%BC%BA%E5%8C%96%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E5%85%AD%EF%BC%89-%E7%AD%96%E7%95%A5%E6%A2%AF%E5%BA%A6/">强化学习笔记（六）- 策略梯度</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2020/02/19/%E5%BC%BA%E5%8C%96%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E4%BA%94%EF%BC%89-%E5%87%BD%E6%95%B0%E8%BF%91%E4%BC%BC%E6%96%B9%E6%B3%95/">强化学习笔记（五）- 函数近似方法</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2020/02/16/%E5%BC%BA%E5%8C%96%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E5%9B%9B%EF%BC%89-%E6%97%B6%E5%BA%8F%E5%B7%AE%E5%88%86%E5%AD%A6%E4%B9%A0/">强化学习笔记（四）- 时序差分学习</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2020/02/15/%E5%BC%BA%E5%8C%96%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%89%EF%BC%89-%E8%92%99%E7%89%B9%E5%8D%A1%E7%BD%97%E6%96%B9%E6%B3%95/">强化学习笔记（三）- 蒙特卡罗方法</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2020/02/14/%E5%BC%BA%E5%8C%96%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E4%BA%8C%EF%BC%89-%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92%E6%96%B9%E6%B3%95/">强化学习笔记（二）- 动态规划方法</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2020/02/11/%E5%BC%BA%E5%8C%96%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%80%EF%BC%89-Markov-%E5%86%B3%E7%AD%96%E8%BF%87%E7%A8%8B%E6%A8%A1%E5%9E%8B/">强化学习笔记（一）- Markov 决策过程模型</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2019/12/03/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%9F%BA%E7%A1%80/">机器学习基础笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2019/12/02/NAS-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E5%85%AD%EF%BC%89-Evolution-NAS/">NAS 学习笔记（六）- Evolution NAS</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2019/11/30/NAS-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E4%BA%94%EF%BC%89-DARTS/">NAS 学习笔记（五）- DARTS</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2019/11/28/NAS-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E5%9B%9B%EF%BC%89-One-Shot-Architecture-Search/">NAS 学习笔记（四）- One-Shot Architecture Search</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2019/11/27/NAS-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%89%EF%BC%89-ENAS/">NAS 学习笔记（三）- ENAS</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2019/11/26/NAS-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E4%BA%8C%EF%BC%89-SMASH/">NAS 学习笔记（二）- SMASH</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2019/11/26/NAS-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%80%EF%BC%89-NASNet/">NAS 学习笔记（一）- NASNet</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2019/11/19/BOHB-%E7%AC%94%E8%AE%B0/">AutoML HPO 学习笔记（五）- BOHB</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2019/11/18/Hyeperband-%E7%AC%94%E8%AE%B0/">AutoML HPO 学习笔记（四）- Hyeperband</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2019/11/15/SMAC-%E7%AC%94%E8%AE%B0/">AutoML HPO 学习笔记（三）- SMAC</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2019/11/13/Hyperopt-%E5%92%8C-TPE-%E7%AC%94%E8%AE%B0/">AutoML HPO 学习笔记（二）- Hyperopt 和 TPE</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2019/11/06/Ensemble-Selection-%E7%AC%94%E8%AE%B0/">Ensemble Selection 笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2019/09/08/%E8%B4%9D%E5%8F%B6%E6%96%AF%E4%BC%98%E5%8C%96%E7%AC%94%E8%AE%B0/">AutoML HPO 学习笔记（一）- 贝叶斯优化</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2019/07/26/%E8%AF%BB%E3%80%8A%E8%87%AA%E7%A7%81%E7%9A%84%E5%9F%BA%E5%9B%A0%E3%80%8B-%E7%88%B6%E6%AF%8D%E4%B8%BA%E5%95%A5%E6%80%BB%E6%98%AF%E6%97%A0%E7%A7%81%E7%9A%84/">读《自私的基因》--父母为啥总是无私的</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2019/06/20/%E9%9A%90%E9%A9%AC%E5%B0%94%E5%8F%AF%E5%A4%AB%E6%A8%A1%E5%9E%8B%E7%AC%94%E8%AE%B0/">机器学习基础（十三）- 隐马尔可夫模型笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2019/06/08/%E5%BC%BA%E5%8C%96%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">机器学习基础（十二）- 强化学习笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2019/05/26/%E5%8D%8A%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">机器学习基础（十一）- 半监督学习笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2019/05/21/%E7%89%B9%E5%BE%81%E9%80%89%E6%8B%A9%E7%AC%94%E8%AE%B0/">机器学习基础（十）- 特征选择笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2019/05/19/%E5%A4%9A%E7%BB%B4%E7%BC%A9%E6%94%BEMDS%E9%99%8D%E7%BB%B4%E6%96%B9%E6%B3%95/">机器学习基础（九）- 多维缩放笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2019/05/17/%E8%81%9A%E7%B1%BB%E7%AC%94%E8%AE%B0/">机器学习基础（八）- 聚类笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2019/05/13/%E9%9B%86%E6%88%90%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">机器学习基础（七）- 集成学习笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2019/05/04/%E8%B4%9D%E5%8F%B6%E6%96%AF%E5%88%86%E7%B1%BB%E5%99%A8%E7%AC%94%E8%AE%B0/">机器学习基础（十四）- 贝叶斯分类器笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2019/04/28/%E9%A9%AC%E5%B0%94%E5%8F%AF%E5%A4%AB%E9%93%BE%E7%AC%94%E8%AE%B0/">马尔可夫链笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2019/04/25/%E4%BC%AF%E5%8A%AA%E5%88%A9%E8%BF%87%E7%A8%8B%E5%92%8C%E6%B3%8A%E6%9D%BE%E8%BF%87%E7%A8%8B%E7%AC%94%E8%AE%B0/">伯努利过程和泊松过程笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2019/04/21/%E7%BB%8F%E5%85%B8%E7%BB%9F%E8%AE%A1%E6%8E%A8%E6%96%AD%E7%AC%94%E8%AE%B0/">经典统计推断笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2019/04/18/SVM%E7%AC%94%E8%AE%B0/">机器学习基础（六）- SVM 笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2019/04/11/%E8%AF%BB%E3%80%8A%E8%8F%8A%E4%B8%8E%E5%88%80%E3%80%8B-%E6%9C%89%E7%82%B9%E7%9F%9B%E7%9B%BE%E7%9A%84%E6%97%A5%E6%9C%AC%E4%BA%BA/">读《菊与刀》--有点矛盾的日本人</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2019/04/10/BP%E7%AE%97%E6%B3%95%E7%9A%84%E6%8E%A8%E5%AF%BC/">机器学习基础（五）- BP 算法推导</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2019/04/10/%E6%9E%81%E9%99%90%E7%90%86%E8%AE%BA%E7%AC%94%E8%AE%B0/">极限理论笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2019/04/06/%E5%9F%BA%E4%BA%8E%E8%B4%9D%E5%8F%B6%E6%96%AF%E6%96%B9%E6%B3%95%E7%9A%84%E5%B8%B8%E8%A7%81%E4%BC%B0%E8%AE%A1%E6%96%B9%E6%B3%95/">基于贝叶斯方法的常见估计方法</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2019/04/05/%E5%86%B3%E7%AD%96%E6%A0%91%EF%BC%88Decision-Tree%EF%BC%89%E6%B5%85%E8%B0%88/">机器学习基础（四）- 决策树（Decision Tree）笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2019/03/20/Spark-Shuffle%E8%B0%83%E7%A0%94%E7%AC%94%E8%AE%B0/">Spark Shuffle调研笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2019/03/18/%E8%AF%BB%E3%80%8A%E6%9E%AA%E7%82%AE%E3%80%81%E7%97%85%E8%8F%8C%E4%B8%8E%E9%92%A2%E9%93%81%E3%80%8B-%E9%83%BD%E6%98%AF%E8%80%81%E5%A4%A9%E7%88%B7%E8%B5%8F%E7%9A%84%E9%A5%AD/">读《枪炮、病菌与钢铁》--都是老天爷赏的饭</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2019/03/17/%E5%B8%B8%E8%A7%81%E8%BF%9E%E7%BB%AD%E9%9A%8F%E6%9C%BA%E5%8F%98%E9%87%8F%E7%9A%84%E6%A6%82%E7%8E%87%E5%AF%86%E5%BA%A6%E5%87%BD%E6%95%B0%EF%BC%8C%E5%9D%87%E5%80%BC%E5%92%8C%E6%96%B9%E5%B7%AE/">常见连续随机变量的概率密度函数，均值和方差</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2019/03/14/%E4%B8%BB%E6%88%90%E5%88%86%E5%88%86%E6%9E%90%EF%BC%88Principle-Component-Analysis-PCA%EF%BC%89%E6%B5%85%E8%B0%88/">机器学习基础（三）- 主成分分析（Principle Component Analysis, PCA）笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2019/03/06/%E5%B8%B8%E8%A7%81%E7%A6%BB%E6%95%A3%E9%9A%8F%E6%9C%BA%E5%8F%98%E9%87%8F%E7%9A%84%E5%88%86%E5%B8%83%E5%88%97%EF%BC%8C%E5%9D%87%E5%80%BC%E5%92%8C%E6%96%B9%E5%B7%AE/">常见离散随机变量的分布列，均值和方差</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2019/02/25/%E4%B8%80%E4%BA%9B%E6%9C%89%E8%B6%A3%E7%9A%84%E6%A6%82%E7%8E%87%E9%97%AE%E9%A2%98/">一些有趣的概率问题</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2019/02/23/%E8%AF%BB%E3%80%8A%E8%8D%92%E8%AF%9E%E5%8C%BB%E5%AD%A6%E5%8F%B2%E3%80%8B--%E5%8C%BB%E5%AD%A6%E7%9A%84%E8%BF%9B%E6%AD%A5/">读《荒诞医学史》--医学的进步</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2019/02/16/%E8%AF%BB%E3%80%8A%E6%B8%85%E6%95%99%E5%BE%92%E7%9A%84%E7%A4%BC%E7%89%A9%E3%80%8B--%E5%B7%A5%E7%A8%8B%E5%B8%88%E6%96%87%E5%8C%96%E6%98%AF%E6%B8%85%E6%95%99%E5%BE%92%E7%9A%84%E7%B2%BE%E7%A5%9E%E5%90%97/">读《清教徒的礼物》--工程师文化是清教徒的精神吗</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2019/02/11/%E8%AF%BB%E3%80%8A%E7%A9%B7%E6%9F%A5%E7%90%86%E5%AE%9D%E5%85%B8%E3%80%8B--%E8%B7%A8%E5%AD%A6%E7%A7%91%E7%9A%84%E7%9F%A5%E8%AF%86/">读《穷查理宝典》--跨学科的知识</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2019/02/04/%E8%AF%BB%E3%80%8A%E5%B9%B3%E9%9D%A2%E5%9B%BD%E3%80%8B--%E5%9B%9B%E7%BB%B4%E4%B8%96%E7%95%8C%E7%9A%84%E2%80%9C%E4%BA%BA%E4%BB%AC%E2%80%9D%E5%A6%82%E4%BD%95%E7%9C%8B%E5%BE%85%E6%88%91%E4%BB%AC%E5%91%A2/">读《平面国》--四维世界的“人们”如何看待我们呢</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2019/02/02/%E5%AF%B9%E4%BA%8E%E6%A2%AF%E5%BA%A6%E7%9A%84%E7%90%86%E8%A7%A3/">对于梯度的理解</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2019/02/01/%E8%AF%BB%E3%80%8A5%E5%88%86%E9%92%9F%E5%95%86%E5%AD%A6%E9%99%A2%E2%80%A2%E5%95%86%E4%B8%9A%E7%AF%87%E3%80%8B--%E5%AD%A6%E7%82%B9%E5%95%86%E4%B8%9A%E5%A5%97%E8%B7%AF/">读《5分钟商学院•商业篇》--学点商业套路</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2019/01/31/Yarn%E5%9F%BA%E6%9C%AC%E6%9E%B6%E6%9E%84/">Yarn 基本架构</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2019/01/31/%E8%AF%BB%E3%80%8A%E4%BA%BA%E7%B1%BB%E7%AE%80%E5%8F%B2%E3%80%8B--%E6%99%BA%E4%BA%BA%E7%9A%84%E8%99%9A%E6%9E%84%E7%8E%B0%E5%AE%9E/">读《人类简史》--智人的虚构现实</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2019/01/30/%E4%B8%80%E4%BA%9BHadoop%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98%E7%9A%84%E6%96%B9%E6%B3%95/">一些 Hadoop 性能调优的方法</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2019/01/30/%E7%BA%BF%E6%80%A7%E4%BB%A3%E6%95%B0%E4%B9%8B%E5%A5%87%E5%BC%82%E5%80%BC%E5%88%86%E8%A7%A3%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8/">线性代数之奇异值分解及其应用</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2019/01/29/Hadoop-MapReduce%E4%B8%ADTask%E7%9A%84%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B/">Hadoop MapReduce中Task的执行流程</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2019/01/27/Hadoop%E7%9A%84%E4%BB%BB%E5%8A%A1%E6%8E%A8%E6%B5%8B%E6%89%A7%E8%A1%8C%E7%AE%97%E6%B3%95/">Hadoop的任务推测执行算法</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2019/01/25/%E4%B8%BASpark-SQL%E6%B7%BB%E5%8A%A0%E5%8E%9F%E7%94%9F%E8%87%AA%E5%AE%9A%E4%B9%89%E8%AF%AD%E6%B3%95/">为Spark SQL添加原生自定义语法</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2019/01/19/Hadoop%20MRv1%E5%9F%BA%E6%9C%AC%E6%9E%B6%E6%9E%84/">Hadoop MRv1基本架构</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2019/01/18/%E8%AF%BB%E3%80%8A%E6%97%A0%E6%95%8C%E8%88%B0%E9%98%9F%E3%80%8B--%E7%9B%B8%E4%BF%A1%E2%80%9C%E5%A5%87%E8%BF%B9%E2%80%9D%E7%9A%84%E2%80%9C%E6%97%A0%E6%95%8C%E2%80%9D%E8%88%B0%E9%98%9F/">读《无敌舰队》--相信“奇迹”的“无敌”舰队</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2019/01/17/%E8%AF%BB%E3%80%8A%E8%96%9B%E5%85%86%E4%B8%B0%E7%BB%8F%E6%B5%8E%E5%AD%A6%E8%AE%B2%E4%B9%89%E3%80%8B--%E4%BA%BA%E4%BA%BA%E9%83%BD%E5%BA%94%E8%AF%A5%E5%AD%A6%E7%82%B9%E7%BB%8F%E6%B5%8E%E5%AD%A6/">读《薛兆丰经济学讲义》--人人都应该学点经济学</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2019/01/05/%E8%AF%BB%E3%80%8A%E5%BE%AE%E8%A7%82%E5%8A%A8%E6%9C%BA%E4%B8%8E%E5%AE%8F%E8%A7%82%E8%A1%8C%E4%B8%BA%E3%80%8B--%E4%BA%BA%E4%BB%A5%E7%BE%A4%E5%88%86%EF%BC%8C%E4%BA%92%E7%9B%B8%E4%BE%9D%E8%B5%96/">读《微观动机与宏观行为》--人以群分，互相依赖</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/12/29/%E8%AF%BB%E3%80%8A%E5%A6%82%E4%BD%95%E6%89%8D%E8%83%BD%E4%B8%8D%E7%84%A6%E8%99%91%E3%80%8B--%E4%B8%93%E6%B3%A8%E6%88%98%E8%83%9C%E7%84%A6%E8%99%91/">读《如何才能不焦虑》--专注战胜焦虑</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/12/22/%E7%BA%BF%E6%80%A7%E5%88%A4%E5%88%AB%E5%88%86%E6%9E%90%EF%BC%88Linear-Discriminant-Analysis%EF%BC%89%E6%B5%85%E8%B0%88/">机器学习基础（二）- 线性判别分析（Linear Discriminant Analysis）笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/12/21/%E8%AF%BB%E3%80%8A%E4%BA%B2%E5%AF%86%E5%85%B3%E7%B3%BB%E3%80%8B--%E4%BA%B2%E5%AF%86%E5%85%B3%E7%B3%BB%E7%9A%84%E5%A5%97%E8%B7%AF/">读《亲密关系》--亲密关系的套路</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/12/15/%E5%AF%B9%E6%95%B0%E5%87%A0%E7%8E%87%E5%9B%9E%E5%BD%92%EF%BC%88Logistic-Regression%EF%BC%89%E6%B5%85%E8%B0%88/">机器学习基础（一）- 对数几率回归（Logistic Regression）笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/12/07/%E8%AF%BB%E3%80%8A%E5%8D%8E%E6%9D%89%E8%AE%B2%E9%80%8F%E5%AD%99%E5%AD%90%E5%85%B5%E6%B3%95%E3%80%8B--%E4%BB%A5%E5%A5%87%EF%BC%88ji%EF%BC%89%E8%83%9C/">读《华杉讲透孙子兵法》--以奇(ji)胜</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/11/30/Hadoop%E5%92%8CSpark%E6%A0%B9%E6%8D%AElog4j%E8%87%AA%E5%AE%9A%E4%B9%89%E6%97%A5%E5%BF%97%E8%BE%93%E5%87%BA/">Hadoop和Spark根据log4j自定义日志输出</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/11/27/%E8%AF%BB%E3%80%8A%E6%B0%B8%E6%81%92%E7%9A%84%E8%BE%B9%E7%BC%98%E3%80%8B--%E5%B8%9D%E7%8E%8B%E6%81%AF%E4%BA%89/">读《永恒的边缘》--帝王息争</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/11/25/HDFS%E9%87%8C%E7%9A%84Hedged-Read%E6%BA%90%E7%A0%81%E4%BB%A5%E5%8F%8A%E5%B1%80%E9%99%90%E6%80%A7%E5%88%86%E6%9E%90/">HDFS里的Hedged Read源码以及局限性分析</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/11/22/HDFS%E9%87%8Cread-operation%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90%E4%BB%A5%E5%8F%8A%E8%AF%BB%E6%85%A2%E8%8A%82%E7%82%B9%E9%97%AE%E9%A2%98%E6%8E%A2%E7%A9%B6/">HDFS里read operation源码解析以及读慢节点问题探究</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/11/16/Java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E4%B9%8BJava%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B/">Java 并发编程（十四）- 内存模型</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/11/15/Java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E4%B9%8B%E9%9D%9E%E9%98%BB%E5%A1%9E%E5%90%8C%E6%AD%A5%E6%9C%BA%E5%88%B6/">Java 并发编程（十三）- 非阻塞同步机制</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/11/13/Java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E4%B9%8BAQS/">Java 并发编程（十二）- AQS</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/11/12/Java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E4%B9%8B%E6%98%BE%E7%A4%BA%E9%94%81/">Java 并发编程（十一）- 显示锁</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/11/09/Java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E4%B9%8B%E6%80%A7%E8%83%BD%E4%B8%8E%E5%8F%AF%E4%BC%B8%E7%BC%A9%E6%80%A7/">Java 并发编程（五）- 构建高效且可伸缩的结果缓存</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/11/08/Java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E4%B9%8B%E9%81%BF%E5%85%8D%E6%B4%BB%E8%B7%83%E6%80%A7%E7%9A%84%E5%8D%B1%E9%99%A9/">Java 并发编程（九）- 避免活跃性的危险</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/11/06/Java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E4%B9%8B%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%9A%84%E4%BD%BF%E7%94%A8/">Java 并发编程（八）- 线程池的使用</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/11/04/Java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E4%B9%8B%E5%8F%96%E6%B6%88%E4%B8%8E%E5%85%B3%E9%97%AD/">Java 并发编程（七）- 取消与关闭</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/11/01/Java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E4%B9%8BExecutor/">Java 并发编程（六）- Executor</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/10/24/Java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E7%A4%BA%E4%BE%8B%E4%B9%8B%E6%9E%84%E5%BB%BA%E9%AB%98%E6%95%88%E4%B8%94%E5%8F%AF%E4%BC%B8%E7%BC%A9%E7%9A%84%E7%BB%93%E6%9E%9C%E7%BC%93%E5%AD%98/">Java 并发编程（五）- 构建高效且可伸缩的结果缓存</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/10/24/Java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E4%B9%8B%E5%9F%BA%E7%A1%80%E6%9E%84%E5%BB%BA%E6%A8%A1%E5%9D%97/">Java 并发编程（四）- 基础构建模块</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/10/22/Spark%E9%87%8CHistroy-Server%E4%B8%A2task%EF%BC%8Cjob%E5%92%8CStage%E9%97%AE%E9%A2%98%E8%B0%83%E7%A0%94/">Spark里Histroy Server丢task，job和Stage问题调研</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/10/22/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F%E5%92%8C%E5%8F%91%E5%B8%83-%E8%AE%A2%E9%98%85%E6%A8%A1%E5%BC%8F/">设计模式之观察者模式和发布-订阅模式</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/10/21/%E8%AF%BB%E3%80%8A%E6%BC%AB%E6%AD%A5%E5%8D%8E%E5%B0%94%E8%A1%97%E3%80%8B--%E5%9C%A8%E9%9A%8F%E6%9C%BA%E4%B8%AD%E6%BC%AB%E6%AD%A5%EF%BC%8C%E5%9C%A8%E9%9A%8F%E6%9C%BA%E4%B8%AD%E7%A8%B3%E5%AE%9A/">读《漫步华尔街》--在随机中漫步，在随机中稳定</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/10/21/Java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E4%B9%8B%E5%AF%B9%E8%B1%A1%E7%9A%84%E7%BB%84%E5%90%88/">Java 并发编程（三）- 对象的组合</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/10/18/Java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E4%B9%8B%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%85%B1%E4%BA%AB/">Java 并发编程（二）- 对象的共享</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/10/15/%E6%B5%85%E8%B0%88%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8/">Java 并发编程（一）- 浅谈线程安全</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/10/14/Spark%E9%87%8C%E6%9C%89%E5%85%B3History-Server%E7%9A%84scheduler-delay%E7%9B%B8%E5%85%B3%E6%BA%90%E7%A0%81%E7%9A%84%E4%B8%80%E6%AC%A1%E8%B0%83%E7%A0%94/">Spark里有关History Server的scheduler delay相关源码的一次调研</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/10/11/JVM%E4%B8%AD%E7%9A%84%E5%88%86%E6%B4%BE%E6%9C%BA%E5%88%B6/">JVM 学习（十）- 分派机制</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/10/10/JVM%E7%B1%BB%E5%8A%A0%E8%BD%BD%E6%9C%BA%E5%88%B6/">JVM 学习（九）- 类加载机制</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/09/26/%E8%AF%BB%E3%80%8A%E4%B8%96%E7%95%8C%E7%9A%84%E5%87%9B%E5%86%AC%E3%80%8B--%E5%B9%B3%E6%B0%91%E7%9A%84%E6%88%98%E4%BA%89/">读《世界的凛冬》--平民的战争</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/08/05/%E8%B7%B3%E8%A1%A8%E7%AE%80%E6%98%93%E5%AE%9E%E7%8E%B0/">跳表简易实现</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/08/05/%E8%AF%BB%E3%80%8A%E5%B7%A8%E4%BA%BA%E7%9A%84%E9%99%A8%E8%90%BD%E3%80%8B--%E5%B9%B3%E6%B0%91%E7%9A%84%E5%B4%9B%E8%B5%B7/">读《巨人的陨落》--平民的崛起</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/08/04/LSM%E8%B0%83%E7%A0%94%E7%AC%94%E8%AE%B0/">LSM调研</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/07/29/B%E6%A0%91%E5%92%8CB-%E6%A0%91/">B树和B+树</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/07/28/Mysql%E4%B8%AD%E7%9A%84%E7%B4%A2%E5%BC%95/">Mysql中的索引</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/07/19/BigTable%E8%B0%83%E7%A0%94%E7%AC%94%E8%AE%B0/">BigTable调研笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/06/19/%E8%AF%BB%E3%80%8A%E6%94%B9%E5%8F%98%E5%BF%83%E7%90%86%E5%AD%A6%E7%9A%8440%E9%A1%B9%E7%A0%94%E7%A9%B6%E3%80%8B--%E5%88%9D%E6%8E%A2%E5%BF%83%E7%90%86%E5%AD%A6/">读《改变心理学的40项研究》--初探心理学</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/06/13/%E6%9C%80%E5%A4%A7%E4%BA%8C%E5%88%86%E5%9B%BE%E5%8C%B9%E9%85%8D/">最大二分图匹配</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/06/12/%E8%8E%8E%E5%A3%AB%E6%AF%94%E4%BA%9A%E5%9B%BE%E4%B8%8E%E5%9B%BE%E6%95%B0%E6%8D%AE%E5%BA%93/">莎士比亚图与图数据库</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/06/12/%E6%9C%80%E5%B0%8F%E8%B4%B9%E7%94%A8%E6%9C%80%E5%A4%A7%E6%B5%81%E9%97%AE%E9%A2%98/">最小费用最大流问题</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/06/10/%E5%A2%9E%E5%B9%BF%E8%B7%AF%E5%AE%9A%E7%90%86%E5%92%8CEdmonds-Karp%E7%AE%97%E6%B3%95/">增广路定理和Edmonds-Karp算法</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/05/27/Go%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0%E4%B9%8B%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/">GO 学习笔记（九）- 单元测试</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/05/26/%E5%88%A9%E7%94%A8BFS%EF%BC%8CDFS%EF%BC%8CA-%E8%A7%A3%E5%86%B3%E5%85%AB%E6%95%B0%E7%A0%81%E9%9A%BE%E9%A2%98/">利用BFS，DFS，A*算法解决八数码难题</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/05/24/Go%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0%E4%B9%8B%E5%8F%8D%E5%B0%84/">GO 学习笔记（八）- 反射</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/05/17/Go%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0%E4%B9%8B%E5%B9%B6%E5%8F%91/">GO 学习笔记（七）- 并发</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/05/14/Go%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0%E4%B9%8B%E6%8E%A5%E5%8F%A3/">GO 学习笔记（六）- 接口</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/05/13/Go%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0%E4%B9%8B%E6%96%B9%E6%B3%95/">GO 学习笔记（五）- 方法</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/05/11/Linux%E4%B8%8B%E9%81%BF%E5%85%8Drm%E8%AF%AF%E5%88%A0/">Linux下避免rm误删</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/05/06/Go%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0%E4%B9%8B%E6%95%B0%E6%8D%AE/">GO 学习笔记（四）- 数据</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/05/04/%E5%88%86%E5%B8%83%E5%BC%8F%E8%87%AA%E5%A2%9EID%E7%AE%97%E6%B3%95SnowFlake/">分布式自增ID算法SnowFlake</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/05/04/JVM%E8%B0%83%E4%BC%98%E6%A1%88%E4%BE%8B/">JVM 学习（八）- 调优案例</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/04/11/JVM%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E4%B8%8E%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86%E5%B7%A5%E5%85%B7/">JVM 学习（七）- 性能监控与故障处理工具</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/04/09/%E4%BD%8D%E8%BF%90%E7%AE%97%E6%8A%80%E5%B7%A7%E5%B0%8F%E7%BB%93/">位运算技巧小结</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/04/08/JVM%E4%B8%AD%E7%9A%84%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D%E4%B8%8E%E5%9B%9E%E6%94%B6%E7%AD%96%E7%95%A5/">JVM 学习（六）- 内存分配与回收策略</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/04/08/Go%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0%E4%B9%8B%E5%87%BD%E6%95%B0/">GO 学习笔记（三）- 函数</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/04/08/Go%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0%E4%B9%8B%E8%A1%A8%E8%BE%BE%E5%BC%8F/">GO 学习笔记（二）- 表达式</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/04/08/Go%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0%E4%B9%8B%E5%8F%98%E9%87%8F/">GO 学习笔记（一）- 变量</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/04/07/JVM%E4%B8%AD%E7%9A%84%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8/">JVM 学习（五）- 垃圾收集器</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/04/06/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F/">设计模式之策略模式</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/04/05/JVM%E4%B8%AD%E7%9A%84GC%E7%AE%97%E6%B3%95/">JVM 学习（四）- GC 算法</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/04/05/JVM%E4%B8%AD%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%AD%98%E6%B4%BB%E5%88%A4%E6%96%AD/">JVM 学习（三）- 对象的存活判断</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/04/04/JVM%E4%B8%AD%E5%AF%B9%E8%B1%A1%E7%9A%84%E8%AE%BF%E9%97%AE%E5%AE%9A%E4%BD%8D/">JVM 学习（二）- 对象的访问定位</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/04/03/JVM%E4%B8%AD%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%86%85%E5%AD%98%E5%B8%83%E5%B1%80/">JVM 学习（一）- 对象的内存布局</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/03/24/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F%E4%B8%8B%E7%9A%84%E5%85%B1%E8%AF%86%E7%AE%97%E6%B3%95%E8%B0%83%E7%A0%94%E7%AC%94%E8%AE%B0/">分布式系统下的共识算法调研笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/03/18/%E5%8C%BA%E5%9D%97%E9%93%BE%E7%AE%80%E5%8D%95%E5%8E%9F%E7%90%86%E5%8F%8APython%E5%AE%9E%E7%8E%B0%E7%AE%80%E5%8D%95%E7%9A%84%E5%8C%BA%E5%9D%97%E9%93%BE/">区块链简单原理及Python实现简单的区块链</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/03/15/Scala%E9%87%8C%E7%9A%84%E5%9E%8B%E5%8F%98/">Scala学习笔记（十一）- Scala里的型变(Variance)</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/03/15/%E2%80%9C%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E7%AE%80%E5%8D%95%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F%EF%BC%8C%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8F%EF%BC%8C%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F%E2%80%9D/">策略模式之简单工厂模式，工厂方法模式，抽象工厂模式</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/02/25/%E5%B8%B8%E8%A7%81%E7%9A%84%E6%8E%92%E5%BA%8F%E6%96%B9%E6%B3%95%E5%AE%9E%E7%8E%B0/">常见的排序算法实现</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/02/22/Johnson%E7%AE%97%E6%B3%95/">Johnson算法</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/02/20/Floyd-Warshall%E7%AE%97%E6%B3%95/">Floyd-Warshall算法</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/02/17/%E6%9C%80%E7%9F%AD%E8%B7%AF%E5%BE%84%E5%92%8C%E7%9F%A9%E9%98%B5%E4%B9%98%E6%B3%95/">最短路径和矩阵乘法</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/02/14/SPFA%E7%AE%97%E6%B3%95/">SPFA算法</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/02/13/Dijkstra%E7%AE%97%E6%B3%95/">Dijkstra算法</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/02/12/Bellman-Ford%E7%AE%97%E6%B3%95/">Bellman-Ford算法</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/02/10/Prim%E7%AE%97%E6%B3%95/">Prim算法</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/02/10/Kruskal%E7%AE%97%E6%B3%95/">Kruskal算法</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/02/09/%E6%B5%85%E8%B0%88%E7%9F%A9%E9%98%B5%E5%BF%AB%E9%80%9F%E5%B9%82/">浅谈矩阵快速幂</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/01/20/Java%E4%B8%AD%E7%94%A8Deque%E6%8E%A5%E5%8F%A3%E4%BB%A3%E6%9B%BFStack%E6%8E%A5%E5%8F%A3%E5%AE%8C%E6%88%90%E6%A0%88%E5%8A%9F%E8%83%BD/">Java中用Deque接口代替Stack接口完成栈功能</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/01/19/Docker%E4%B8%AD%E7%9A%84%E9%95%9C%E5%83%8F/">Docker 学习笔记（三）- Docker中的镜像</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2017/12/24/%E8%AF%BB%E3%80%8A%E6%9E%81%E7%AE%80%E5%AE%87%E5%AE%99%E5%8F%B2%E3%80%8B--%E6%B8%BA%E5%B0%8F%E7%9A%84%E6%88%91%E4%BB%AC%EF%BC%8C%E6%97%A0%E9%99%90%E7%9A%84%E6%80%9D%E7%BB%B4/">读《极简宇宙史》--渺小的我们，无限的思维</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2017/11/30/Docker%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/">Docker 学习笔记（二）- Docker基础命令</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2017/11/28/%E6%9C%80%E5%A4%A7%E5%AD%90%E6%95%B0%E7%BB%84%E9%97%AE%E9%A2%98-The-maximum-subarray-problem/">最大子数组问题(The maximum-subarray problem)</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2017/11/23/Docker%E5%88%9D%E4%BD%93%E9%AA%8C/">Docker 学习笔记（一）- Docker初体验</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2017/11/12/%E5%88%A9%E7%94%A8Morris-Traversal%E6%96%B9%E6%B3%95%E9%81%8D%E5%8E%86%E4%BA%8C%E5%8F%89%E6%A0%91/">利用Morris Traversal方法遍历二叉树</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2017/09/11/%E5%88%A9%E7%94%A8%E7%BA%BF%E6%AE%B5%E6%A0%91%E8%A7%A3%E5%86%B3%E5%8C%BA%E9%97%B4%E6%9C%80%E5%80%BC%E6%9F%A5%E8%AF%A2-RMQ-%E9%97%AE%E9%A2%98/">利用线段树和ST算法解决区间最值查询(RMQ)问题</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2017/09/09/%E7%BA%BF%E6%AE%B5%E6%A0%91%E5%B0%8F%E8%AE%B0/">线段树小记</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2017/08/15/%E8%B4%AA%E5%BF%83%E7%AE%97%E6%B3%95%E4%B8%8E%E8%B5%AB%E5%A4%AB%E6%9B%BC%E7%BC%96%E7%A0%81-Huffman-Code/">贪心算法与赫夫曼编码(Huffman Code)</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2017/08/14/Java%E9%87%8C%E7%9A%84%E5%BA%8F%E5%88%97%E5%8C%96%E5%8F%8A%E5%BA%8F%E5%88%97%E5%8C%96%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F/">Java里的序列化及序列化代理模式</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2017/08/14/Scala%E9%87%8C%E7%9A%84%E9%9A%90%E5%BC%8F%E7%B1%BB%E5%9E%8B%E7%BA%A6%E6%9D%9F-Implicit-Type-Bounds/">Scala学习笔记（十）- Scala里的隐式类型约束(Implicit Type Bounds)</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2017/08/11/%E5%88%A9%E7%94%A8%E8%B4%AA%E5%BF%83%E7%AE%97%E6%B3%95%E8%A7%A3%E5%86%B3%E6%B4%BB%E5%8A%A8%E9%80%89%E6%8B%A9%E9%97%AE%E9%A2%98/">利用贪心算法解决活动选择问题</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2017/08/09/%E5%88%A9%E7%94%A8%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92%E6%9E%84%E9%80%A0%E9%9C%8D%E5%A4%AB%E6%9B%BC%E6%A0%91-Huffman-Tree/">利用动态规划构造霍夫曼树(Huffman Tree)</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2017/08/05/Scala%E9%87%8C%E7%9A%84%E5%AD%98%E5%9C%A8%E7%B1%BB%E5%9E%8B/">Scala学习笔记（九）- Scala里的存在类型</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2017/08/04/%E5%88%A9%E7%94%A8%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92%E8%A7%A3%E5%86%B3%E6%9C%80%E9%95%BF%E5%85%AC%E5%85%B1%E5%AD%90%E5%BA%8F%E5%88%97-LCS-%E9%97%AE%E9%A2%98/">利用动态规划解决最长公共子序列(LCS)问题</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2017/08/02/Scala%E4%B8%AD%E7%9A%84%E7%BB%93%E6%9E%84%E5%8C%96%E7%B1%BB%E5%9E%8B/">Scala学习笔记（八）- Scala中的结构化类型(Structural Type)</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2017/07/29/%E6%B5%85%E8%B0%88Java%E4%B8%AD%E7%9A%84%E6%9E%9A%E4%B8%BE%E7%B1%BB%E5%9E%8B/">浅谈Java中的枚举类型</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2017/07/27/Scala%E4%B8%AD%E7%9A%84%E8%B7%AF%E5%BE%84%E4%BE%9D%E8%B5%96%E7%B1%BB%E5%9E%8B%E5%92%8C%E7%B1%BB%E5%9E%8B%E6%B3%A8%E5%85%A5/">Scala学习笔记（七）- Scala中的路径依赖类型(Path-dependent Type)和类型注入(Type Projection)</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2017/07/27/%E5%88%A9%E7%94%A8%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92%E8%A7%A3%E5%86%B3%E7%9F%A9%E9%98%B5%E9%93%BE%E4%B9%98%E6%B3%95%E9%97%AE%E9%A2%98/">利用动态规划解决矩阵链乘法问题</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2017/07/26/Scala%E4%B8%AD%E7%9A%84%E9%9A%90%E5%BC%8F%E8%BD%AC%E6%8D%A2%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%A0%94/">Scala学习笔记（六）- Scala中的隐式转换系统</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2017/07/22/%E5%88%A9%E7%94%A8%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92%E8%A7%A3%E5%86%B3%E9%92%A2%E6%9D%A1%E5%88%87%E5%89%B2%E9%97%AE%E9%A2%98/">利用动态规划解决钢条切割问题</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2017/07/09/Scala%E4%B8%AD%E7%9A%84%EF%BC%82%E8%87%B4%E5%91%BD%E9%92%BB%E7%9F%B3%E9%97%AE%E9%A2%98%EF%BC%82/">Scala学习笔记（五）- Scala中的＂致命钻石问题＂</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2017/07/08/Scala%E4%B8%AD%E5%91%BD%E5%90%8D%E5%8F%82%E6%95%B0%E7%9A%84%E4%B8%80%E4%B8%AA%E5%B0%8F%E5%9D%91%EF%BC%88%E6%88%AA%E8%87%B3Scala2-12-2%EF%BC%89/">Scala学习笔记（四）- Scala中命名参数的一个小坑（截至Scala2.12.2）</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2017/07/07/%E5%B0%BE%E9%80%92%E5%BD%92%E8%B0%83%E7%A0%94%E7%AC%94%E8%AE%B0/">尾递归调研笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2017/07/03/Java%E4%B8%AD%E6%B6%88%E9%99%A4%E8%BF%87%E6%9C%9F%E7%9A%84%E5%AF%B9%E8%B1%A1%E5%BC%95%E7%94%A8/">Java中消除过期的对象引用</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2017/06/25/%E5%9C%A8vim%E4%B8%AD%E4%BF%9D%E5%AD%98%E6%AD%A3%E5%9C%A8%E7%BC%96%E8%BE%91%E7%9A%84%E6%96%87%E4%BB%B6%E8%80%8C%E4%B8%8D%E9%9C%80%E8%A6%81%E5%BF%85%E8%A6%81%E7%9A%84%E6%9D%83%E9%99%90/">在vim中保存正在编辑的文件而不需要必要的权限</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2017/06/19/Java%E4%B8%AD%E6%9E%84%E9%80%A0%E5%99%A8%E5%92%8C%E5%8D%95%E4%BE%8B%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%88%9B%E5%BB%BA/">Java中构造器和单例对象的创建</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2017/06/18/Java%E4%B8%AD%E9%81%BF%E5%85%8D%E5%88%9B%E5%BB%BA%E4%B8%8D%E5%BF%85%E8%A6%81%E5%AF%B9%E8%B1%A1%E7%9A%84%E6%96%B9%E6%B3%95/">Java中避免创建不必要对象的方法</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2017/06/08/Scala%E4%B8%AD%E5%AF%B9%E8%B1%A1%E7%9B%B8%E7%AD%89%E6%80%A7%E5%B0%8F%E8%AE%B0/">Scala学习笔记（三）- Scala中对象相等性</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2017/05/24/Scala%E7%9A%84%E4%BC%A0%E5%80%BC%E5%92%8C%E4%BC%A0%E5%90%8D%E5%87%BD%E6%95%B0%E5%B0%8F%E8%AE%B0/">Scala学习笔记（二）- Scala的传值和传名函数</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2017/04/25/%E9%80%9A%E7%94%A8%E5%90%8E%E7%BC%80%E6%A0%91%E5%B9%B6%E8%A1%8C%E5%8C%96%E6%9E%84%E5%BB%BA%E7%AE%97%E6%B3%95%E6%80%9D%E8%B7%AF/">通用后缀树并行化构建算法思路</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2017/04/04/yum%E5%AE%89%E8%A3%85CDH-Hadoop-HA%E6%A8%A1%E5%BC%8F/">yum 安装 CDH Hadoop (HA模式)</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2017/01/03/Scala%E4%B8%AD%E7%9A%84%E4%B8%80%E4%BA%9B%E8%AF%AD%E6%B3%95%E7%B3%96%E5%92%8C%E7%89%B9%E6%80%A7/">Scala学习笔记（一）- Scala的一些语法糖和特性</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2016/11/22/KMP%E7%AE%97%E6%B3%95%E5%B0%8F%E7%BB%93/">KMP算法小结</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2016/07/30/Cpp%E4%B8%ADchar-%EF%BC%8Cconst-char-%EF%BC%8Cstring%E7%9A%84%E7%9B%B8%E4%BA%92%E8%BD%AC%E6%8D%A2/">C++ 中char*，const char*，string的相互转换</a></li></ul>




    <script>
        
    </script>

</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                <i class="fa fa-copyright"></i> 
                2017-2022 Hazza Cheng
            </div>
        </div>
        
            <div class="visit">
                
                    <span id="busuanzi_container_site_uv">
                      您是第 <span id="busuanzi_value_site_uv"></span> 位小伙伴
                    </span>
                
                
                    <span>| </span>
                
                
                    <span id="busuanzi_container_site_pv">
                        本站总访问量 <span id="busuanzi_value_site_pv"></span> 次
                    </span>
                
                <span>| </span>
                <span class="post-count">  已经写了 610.5k 字啦</span>
            </div>
        
        </br>
        <span id="timeDate">载入天数...</span><span id="times">载入时分秒...</span>
        <script>
            var now = new Date(); 
            function createtime(){ var grt= new Date("04/02/2017 11:02:49");//此处修改你的建站时间或者网站上线时间 
            now.setTime(now.getTime()+250); 
            days = (now - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days); 
            hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours); 
            if(String(hnum).length ==1 ){hnum = "0" + hnum;} minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum); 
            mnum = Math.floor(minutes); if(String(mnum).length ==1 ){mnum = "0" + mnum;} 
            seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum); 
            snum = Math.round(seconds); if(String(snum).length ==1 ){snum = "0" + snum;} 
            document.getElementById("timeDate").innerHTML = "本站已安全运行 "+dnum+" 天 "; 
            document.getElementById("times").innerHTML = hnum + " 小时 " + mnum + " 分 " + snum + " 秒"; } 
            setInterval("createtime()",250);
        </script>
    </div>
</footer>

    </div>
    
    
<script src="/js/GithubRepoWidget.js"></script>


<script data-main="/js/main.js" src="//cdn.bootcss.com/require.js/2.2.0/require.min.js"></script>

    <script>
        $(document).ready(function() {
            var iPad = window.navigator.userAgent.indexOf('iPad');
            if (iPad > -1 || $(".left-col").css("display") === "none") {
                var bgColorList = ["#9db3f4", "#414141", "#e5a859", "#f5dfc6", "#c084a0", "#847e72", "#cd8390", "#996731"];
                var bgColor = Math.ceil(Math.random() * (bgColorList.length - 1));
                $("body").css({"background-color": bgColorList[bgColor], "background-size": "cover"});
            }
            else {
                var backgroundnum = 5;
                var backgroundimg = "url(/background/bg-x.jpg)".replace(/x/gi, Math.ceil(Math.random() * backgroundnum));
                $("body").css({"background": backgroundimg, "background-attachment": "fixed", "background-size": "cover"});
            }
        })
    </script>





    <script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


<div class="scroll" id="scroll">
    <a href="#" title="返回顶部"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments" onclick="load$hide();" title="查看评论"><i class="fa fa-comments-o"></i></a>
    <a href="#footer" title="转到底部"><i class="fa fa-arrow-down"></i></a>
</div>
<script>
    // Open in New Window
    
        $("a[target=_blank]").removeAttr("target");
    
</script>

    <script>
        var originTitle = document.title;
        var titleTime;
        document.addEventListener("visibilitychange", function() {
            if (document.hidden) {
                document.title = "(つェ⊂) 我藏好了哦~ " + originTitle;
                clearTimeout(titleTime);
            }
            else {
                document.title = "(*´∇｀*) 被你发现啦~ " + originTitle;
                titleTime = setTimeout(function() {
                    document.title = originTitle;
                }, 2000);
            }
        })
    </script>

<script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js">
</script>

  </div>
</body>
</html>